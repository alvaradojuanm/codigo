{"createdAt":"2025-07-16T18:38:46.243Z","updatedAt":"2025-07-16T18:40:49.848Z","id":"vM1Zkn2VCrWrBaeQ","name":"Agente de Cita Clinica","active":false,"isArchived":false,"nodes":[{"parameters":{"updates":["messages"],"options":{}},"type":"n8n-nodes-base.whatsAppTrigger","typeVersion":1,"position":[-1520,32],"id":"9d99ac3f-1441-42d4-9bbf-71df80b4ee4b","name":"WhatsApp Trigger","webhookId":"webhook-id-1"},{"parameters":{"promptType":"define","text":"={{ $('Redis1').item.json.messages.join(\", \") }}\n\n","options":{"systemMessage":"=Eres un asistente virtual llamado Sofia\n\nEstas hablando con:  {{ $('WhatsApp Trigger').first().json.contacts[0].profile.name }}\n\nLa fecha y hora actual es: {{ $now.format('yyyy-MM-dd  HH:mm') }}\n\nhorarios de atención:\n{{ $json.content }}\n\nHerramientas de gestión de calendario\n\n- \"Cambiar evento\": Usa esta herramienta para cambiar de fecha un evento, se necesita la fecha actual del evento a cambiar y la fecha nueva, si no se tiene se pregunta al usuario.\n\n- \"Crear evento\": Usa esta herramienta para programar nuevas citas. \n\n- \"Cancelar evento\": Usa esta herramienta para cancelar una cita existente cuando el cliente lo solicite.\n\n- \"Disponibilidad\": Usa esta herramienta para obtener la disponibilidad de horario en un rango de horarios.\n\n\n\nReglas\n - Para cualquier uso de herramienta considera que el calendario esta en la zona horaria: {{ $now.toFormat(\"ZZ\") }}. \n\n- Busca el tipo de tratamiento dentro de la información proporcianda y trata de ajustar el tiempo de la sesión, si no lo encuentras asume que sera de una hora.\n\n- Asume siempre que la cita sera solo entre el cliente y la clinica. \n\n - Para generar la cita debes de tener nombre y mail.\n\n - Description: lo puedes asumir de la conversación.\n\n - Si no se especifica fecha/hora, pregunta al cliente por sus opciones preferidas.\n\n - Si el usuario no epecifica año asume que es para el año: {{ $now.format('yyyy') }}.\n\n - Si te hablan de la siguiente semana entoces calcula la fecha exacta:\n\nEjemplo: \nFecha actual 13-jun\nFecha solicitada: siguiente semana lunes\nOk ya he recervado para el dia 16 de jun\n\n - Asume que es para el mes: {{ $now.format('LLLL') }}. \n\n- Si te dan una fecha sin mes puedes en el pasado puedes asumir que es para el siguiente mes. \nEjemplo: \nFecha actual 13-jun\nFecha solicitada: Para el lunes 10\nTenemos dispoibilidad para Jul 10 me confimar si es correcta la fecha para agendarte la cita.\n\n\n\n\n"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.9,"position":[976,-96],"id":"32e59af2-12de-4677-be2b-50dbdc27b4b7","name":"AI Agent"},{"parameters":{"sessionIdType":"customKey","sessionKey":"={{ $('WhatsApp Trigger').item.json.metadata.phone_number_id }}","contextWindowLength":20},"type":"@n8n/n8n-nodes-langchain.memoryBufferWindow","typeVersion":1.3,"position":[928,240],"id":"0aee6f6c-a7ae-4e9f-961f-573ca908232c","name":"Simple Memory"},{"parameters":{"url":"={{ $json.url }}","authentication":"predefinedCredentialType","nodeCredentialType":"whatsAppApi","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-832,-48],"id":"40d36e7a-bbab-4e7f-87ba-60f808a71a52","name":"Download Image"},{"parameters":{"resource":"image","operation":"analyze","modelId":{"__rl":true,"value":"gpt-4o-mini","mode":"list","cachedResultName":"GPT-4O-MINI"},"text":"=Describe la imagen en detalle. \n\nEsta es el caption de la imagen para contexto: \n{{ $('WhatsApp Trigger').first().json.messages[0].image.caption || \"Sin caption\" }}","inputType":"base64","options":{}},"type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":1.8,"position":[-672,-48],"id":"cee7fcdd-21ee-4134-b2e8-c0379e0861d0","name":"Analyze Image"},{"parameters":{"url":"={{ $json.url }}","authentication":"predefinedCredentialType","nodeCredentialType":"whatsAppApi","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-832,-288],"id":"c3fc8017-32ea-4585-9600-c95a8399c83d","name":"Download Audio"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"condition-id-1","leftValue":"={{ $('WhatsApp Trigger').first().json.messages[0].audio }}","rightValue":"","operator":{"type":"object","operation":"exists","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[1584,-96],"id":"38a37494-cdf5-4e80-960f-661fd997f1ed","name":"If"},{"parameters":{"resource":"audio","input":"={{ $('AI Agent').item.json.output }}","voice":"shimmer","options":{"response_format":"opus"}},"type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":1.8,"position":[1856,-208],"id":"9fa89152-e692-4b34-9ea8-1a5e5579ca14","name":"Generate Audio"},{"parameters":{"operation":"send","phoneNumberId":"phone-number-id","recipientPhoneNumber":"={{ $('WhatsApp Trigger').first().json.contacts[0].wa_id }}","messageType":"audio","mediaPath":"useMedian8n","additionalFields":{}},"type":"n8n-nodes-base.whatsApp","typeVersion":1,"position":[2016,-208],"id":"5e9a4139-fa3a-4a8e-be21-8ab159d4dc30","name":"Respond with Audio","webhookId":"webhook-id-2"},{"parameters":{"operation":"send","phoneNumberId":"phone-number-id","recipientPhoneNumber":"={{ $('WhatsApp Trigger').item.json.messages[0].from }}","textBody":"={{ $json.output }}","additionalFields":{}},"type":"n8n-nodes-base.whatsApp","typeVersion":1,"position":[1856,16],"id":"4f6ca44f-7ea8-4b64-8e77-26606e41fe67","name":"Respond with Text","webhookId":"webhook-id-1"},{"parameters":{"content":"## Audio","height":200,"width":800},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-1104,-320],"id":"d0257c35-49b0-4754-a645-67a1b4919189","name":"Sticky Note"},{"parameters":{"content":"## Imagen y Text","height":220,"width":800,"color":4},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-1104,-96],"id":"fd32c132-f1c2-46f1-9c05-ed833f96cb58","name":"Sticky Note1"},{"parameters":{"model":{"__rl":true,"value":"gpt-4.1-mini","mode":"list","cachedResultName":"gpt-4.1-mini"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[816,144],"id":"ad84da85-e819-42ea-a46d-49f9f1b18a36","name":"OpenAI Chat Model"},{"parameters":{"content":"## Solo Text","width":800,"color":6},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-1104,144],"id":"1a4efd0d-fbba-4b51-8bff-c0cb0e668b80","name":"Sticky Note2"},{"parameters":{"content":"## Entrada","height":840,"width":440,"color":7},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-1584,-320],"id":"a8513b1a-94e7-44d7-9e43-663a1125ceec","name":"Sticky Note3"},{"parameters":{"content":"## Respuesta","height":856,"width":700,"color":5},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[1520,-320],"id":"47477260-6007-4b98-9a2e-f21a6bad43d6","name":"Sticky Note5"},{"parameters":{"resource":"media","operation":"mediaUrlGet","mediaGetId":"={{ $('WhatsApp Trigger').item.json.messages[0].audio.id }}"},"type":"n8n-nodes-base.whatsApp","typeVersion":1,"position":[-992,-288],"id":"bee82034-3282-47b8-9a2c-db09b8ea1374","name":"Audio URL","webhookId":"webhook-id-3"},{"parameters":{"resource":"media","operation":"mediaUrlGet","mediaGetId":"={{ $('WhatsApp Trigger').first().json.messages[0].image.id }}"},"type":"n8n-nodes-base.whatsApp","typeVersion":1,"position":[-992,-48],"id":"f7185277-4234-4315-9ec5-ba9a44b87a46","name":"Image URL","webhookId":"webhook-id-4"},{"parameters":{"assignments":{"assignments":[{"id":"assignment-id-1","name":"text","value":"={{ $json.text }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-512,-288],"id":"deb7531a-160d-4c86-b1f2-56b9571f3cb6","name":"Text"},{"parameters":{"assignments":{"assignments":[{"id":"assignment-id-2","name":"text","value":"=El usuario proporcionó la siguiente imagen y texto.\n\nDescripción de la Imagen:\n{{ $json.content }}\n\nMensaje del usuario: \n{{ $('WhatsApp Trigger').first().json.messages[0].image.caption || \"Sin caption\" }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-512,-48],"id":"2dfea132-ef2b-4065-a2dc-e579668f5f44","name":"Image + Text"},{"parameters":{"assignments":{"assignments":[{"id":"assignment-id-3","name":"text","value":"={{ $('WhatsApp Trigger').item.json.messages[0].text.body }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-512,160],"id":"3819a431-12ee-4dab-8fc6-d1c3a4d2621b","name":"Text Only"},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"condition-id-2","leftValue":"={{ $json.messages[0].audio }}","rightValue":"","operator":{"type":"object","operation":"exists","singleValue":true}}],"combinator":"and"},"renameOutput":true,"outputKey":"Voice"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"condition-id-3","leftValue":"={{ $json.messages[0].image }}","rightValue":"","operator":{"type":"object","operation":"exists","singleValue":true}}],"combinator":"and"},"renameOutput":true,"outputKey":"Image"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"leftValue":"={{ $json.messages[0].text.body }}","rightValue":"","operator":{"type":"string","operation":"exists","singleValue":true},"id":"condition-id-4"}],"combinator":"and"},"renameOutput":true,"outputKey":"Text"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"condition-id-5","leftValue":"={{ $json.messages[0].video }}","rightValue":"","operator":{"type":"object","operation":"exists","singleValue":true}}],"combinator":"and"}}]},"options":{}},"type":"n8n-nodes-base.switch","typeVersion":3.2,"position":[-1312,16],"id":"32e9c577-3191-4680-a6fd-f96155fd4307","name":"Input"},{"parameters":{"resource":"audio","operation":"transcribe","options":{}},"type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":1.8,"position":[-672,-288],"id":"91359b06-50b0-44a5-a252-4f89ac81778e","name":"Transcribe"},{"parameters":{"content":"## Video","height":228,"width":800,"color":6},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-1104,336],"id":"09a111c5-4b1a-4902-b25a-94fba1e255ef","name":"Sticky Note6"},{"parameters":{"resource":"media","operation":"mediaUrlGet","mediaGetId":"={{ $json.messages[0].video.id }}"},"type":"n8n-nodes-base.whatsApp","typeVersion":1,"position":[-1072,384],"id":"af8e3466-0583-4713-a00e-b54d9a0b98bf","name":"WhatsApp Business Cloud6","webhookId":"webhook-id-5"},{"parameters":{"url":"={{ $json.url }}","authentication":"predefinedCredentialType","nodeCredentialType":"whatsAppApi","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-912,384],"id":"8b215b3f-69b3-4d2c-9bce-9c16730e9430","name":"HTTP Request3"},{"parameters":{"operation":"binaryToPropery","options":{}},"type":"n8n-nodes-base.extractFromFile","typeVersion":1,"position":[-752,384],"id":"f6b090cd-8fe4-4d67-a9ef-88aec6af3bb5","name":"Extract from File"},{"parameters":{"method":"POST","url":"https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent","authentication":"predefinedCredentialType","nodeCredentialType":"googlePalmApi","sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"contents\": [\n    {\n      \"parts\": [\n        {\n          \"inline_data\": {\n            \"mime_type\": \"{{ $('HTTP Request3').item.json.mime_type}}\",\n            \"data\": \"{{ $json.data }}\"\n          }\n        },\n        {\n          \"text\": \"Describe el contenido de este video.\"\n        }\n      ]\n    }\n  ]\n}\n","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-592,384],"id":"36989bb4-f1ac-4a8c-b256-6f977e6ae8d1","name":"HTTP Request4","disabled":true},{"parameters":{"assignments":{"assignments":[{"id":"assignment-id-4","name":"text","value":"={{ $json.candidates[0].content.parts[0].text }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-448,384],"id":"dd9614d7-db29-40ea-a9d9-c40bdf40ccee","name":"Edit Fields3"},{"parameters":{"content":"## Redis","height":872,"width":940},"type":"n8n-nodes-base.stickyNote","position":[-240,-320],"typeVersion":1,"id":"5b0dcfaa-962b-4967-a664-f10ca9c6c787","name":"Sticky Note7"},{"parameters":{"operation":"push","list":"={{ $('WhatsApp Trigger').item.json.metadata.phone_number_id }}","messageData":"={{ $json.text }}","tail":true},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[-208,0],"id":"61fd55f0-6d95-4ae6-9b2c-5ad4237838b7","name":"Redis"},{"parameters":{"amount":1},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-48,0],"id":"d3a40a3f-d735-4d5c-a016-cc875836232d","name":"Wait","webhookId":"webhook-id-6"},{"parameters":{"operation":"get","propertyName":"messages","key":"={{ $('WhatsApp Trigger').item.json.metadata.phone_number_id + \"\" }}","options":{}},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[128,0],"id":"ac9d485d-b0da-4ed8-a9db-f42c947632ab","name":"Redis1"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"condition-id-6","leftValue":"={{ $json.messages.last() }}","rightValue":"={{ $('Redis').item.json.text }}","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[288,0],"id":"d10a5bbb-ec58-4279-b311-0c04c368e440","name":"If1"},{"parameters":{},"type":"n8n-nodes-base.noOp","typeVersion":1,"position":[496,96],"id":"c5b0d2a3-8ac3-4453-8d01-107ae7ffa899","name":"No Operation, do nothing"},{"parameters":{"operation":"delete","key":"={{ $('WhatsApp Trigger').item.json.metadata.phone_number_id + \"\" }}"},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[496,-96],"id":"177b3c41-13da-4b61-ab9d-5c8bc3f3f9d5","name":"Redis2"},{"parameters":{"description":"Usa esta herramienta si el usuario quiere cancelar una cita","workflowId":{"__rl":true,"value":"workflow-id-2","mode":"list","cachedResultName":"Cancelar evento"},"workflowInputs":{"mappingMode":"defineBelow","value":{"fecha y hora cancelar":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('fecha_y_hora_cancelar', ``, 'string') }}","telefono":"={{ $('WhatsApp Trigger').item.json.messages[0].from }}"},"matchingColumns":[],"schema":[{"id":"fecha y hora cancelar","displayName":"fecha y hora cancelar","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false},{"id":"telefono","displayName":"telefono","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2.2,"position":[1296,224],"id":"4c3c1bb2-3d00-47b7-a6a2-27dbec65e630","name":"Cancelar evento"},{"parameters":{"description":"Usa esta herramienta si quieres crear un nuevo evento","workflowId":{"__rl":true,"value":"workflow-id-3","mode":"list","cachedResultName":"crear evento"},"workflowInputs":{"mappingMode":"defineBelow","value":{"fecha y hora evento":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('fecha_y_hora_evento', ``, 'string') }}","telefono":"={{ $('WhatsApp Trigger').item.json.messages[0].from }}","nombre":"={{ $('WhatsApp Trigger').item.json.contacts[0].profile.name }}","description":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('description', ``, 'string') }}","mail":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('mail', `Correo del usuario`, 'string') }}"},"matchingColumns":[],"schema":[{"id":"fecha y hora evento","displayName":"fecha y hora evento","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false},{"id":"telefono","displayName":"telefono","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false},{"id":"nombre","displayName":"nombre","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false},{"id":"description","displayName":"description","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false},{"id":"mail","displayName":"mail","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2.2,"position":[1040,304],"id":"7f15fd43-f109-4fe0-9b0e-298326dc9ac1","name":"Crear evento"},{"parameters":{"description":"Usa esta esta herramienta para modificiar un evento en el calendario, se necesita fecha del evento, fecha nueva ","workflowId":{"__rl":true,"value":"workflow-id-4","mode":"list","cachedResultName":"cambiar evento"},"workflowInputs":{"mappingMode":"defineBelow","value":{"fecha y hora actual":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('fecha_y_hora_actual', ``, 'string') }}","fecha y hora nueva":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('fecha_y_hora_nueva', ``, 'string') }}","telefono":"={{ $('WhatsApp Trigger').item.json.messages[0].from }}","nombre":"={{ $('WhatsApp Trigger').item.json.contacts[0].profile.name }}"},"matchingColumns":[],"schema":[{"id":"fecha y hora actual","displayName":"fecha y hora actual","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false},{"id":"fecha y hora nueva","displayName":"fecha y hora nueva","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false},{"id":"telefono","displayName":"telefono","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false},{"id":"nombre","displayName":"nombre","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2.2,"position":[1184,304],"id":"d1aef4cb-2c1e-445c-a3ad-b52b5fbf299c","name":"Cambiar evento"},{"parameters":{"description":"Usa esta herramineta para revisar la disponibilidad en una fecha y horario","workflowId":{"__rl":true,"value":"workflow-id-5","mode":"list","cachedResultName":"Disponibilidad"},"workflowInputs":{"mappingMode":"defineBelow","value":{"fecha hora":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('fecha_hora', ``, 'string') }}"},"matchingColumns":[],"schema":[{"id":"fecha hora","displayName":"fecha hora","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2.2,"position":[1360,96],"id":"129f9b58-d542-439b-8e35-ba08c7bdcd7b","name":"Disponibilidad"},{"parameters":{"operation":"get","documentURL":"https://docs.google.com/document/d/Steve | Automatización IA/edit"},"type":"n8n-nodes-base.googleDocs","typeVersion":2,"position":[784,-96],"id":"c73ab793-4c42-488d-b3b8-e608ae07812f","name":"Horarios"},{"parameters":{"content":"## Agente","height":856,"width":740,"color":3},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[736,-320],"id":"ac590835-c657-4cf8-87c2-d46fe7b4bae3","name":"Sticky Note4"},{"parameters":{"inputSource":"jsonExample","jsonExample":"{\n  \"fecha hora\": \"fehca hora\"\n}"},"id":"ea534cfd-b4df-47ae-bd65-500b72992d28","typeVersion":1.1,"name":"When Executed by Another Workflow","type":"n8n-nodes-base.executeWorkflowTrigger","position":[-1424,1040]},{"parameters":{"promptType":"define","text":"=Quiero alternativas para esta fecha y hora: {{ $('When Executed by Another Workflow').item.json['fecha hora'] }}","options":{"systemMessage":"=Eres un asistente encargado de proporcionar horarios alternativos a un horario de cita que no esta disponible para el mismo solicitado.\n\nHorarios de atención son: \n{{ $json.content }}\n\nHerramientas: \nGet Events: Usa esta herramientas para obtener todas las citas y devuelve los espacios disponibles. \n\nFormato de respuesta:\nNo ha disponibilidad para la fecha 19 de junio de 2025, a las 12:00. Sin embargo, te puedo ofrecer estos horarios alternativos para el mismo día:\n\n•⁠  ⁠9:00 a.m. a 10:00 a.m.\n•⁠  ⁠10:00 a.m. a 11:00 a.m.\n•⁠  ⁠11:00 a.m. a 12:00 p.m.\n•⁠  ⁠3:30 p.m. a 4:30 p.m.\n•⁠  ⁠4:30 p.m. a 5:30 p.m.\n•⁠  ⁠5:30 p.m. a 6:30 p.m.\n"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2,"position":[-464,1088],"id":"2ebb3ab6-7131-40ee-9c28-5c66b9b98a22","name":"AI Agent1"},{"parameters":{"model":{"__rl":true,"value":"gpt-4.1-mini","mode":"list","cachedResultName":"gpt-4.1-mini"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[-480,1280],"id":"13908be4-ac41-4f8a-b818-2fcca71883ee","name":"OpenAI Chat Model1"},{"parameters":{"resource":"calendar","calendar":{"__rl":true,"value":"steve-automatizacion-ia@group.calendar.google.com","mode":"list","cachedResultName":"Steve | Automatización IA"},"timeMin":"={{ $('When Executed by Another Workflow').item.json['fecha hora'] }}","timeMax":"={{ new Date($(\"When Executed by Another Workflow\").item.json[\"fecha hora\"]).plus(1, 'hour') }}\n","options":{}},"type":"n8n-nodes-base.googleCalendar","typeVersion":1.3,"position":[-1104,864],"id":"9e18822b-0f69-47ff-a6a1-4c445d51dbc8","name":"Availability"},{"parameters":{"operation":"get","documentURL":"https://docs.google.com/document/d/Steve | Automatización IA/edit"},"type":"n8n-nodes-base.googleDocs","typeVersion":2,"position":[-768,1088],"id":"5cc634f0-bcea-4446-a460-cfb9519914e6","name":"Google Docs"},{"parameters":{"operation":"getAll","calendar":{"__rl":true,"value":"steve-automatizacion-ia@group.calendar.google.com","mode":"list","cachedResultName":"Steve | Automatización IA"},"limit":10,"timeMin":"={{ $json[\"fecha hora\"].split(\"T\")[0] + \"T00:00:00.000-07:00\" }}","timeMax":"={{ $json[\"fecha hora\"].split(\"T\")[0] + \"T23:59:59.999-07:00\" }}","options":{}},"type":"n8n-nodes-base.googleCalendarTool","typeVersion":1.3,"position":[-256,1280],"id":"918cb1a2-d650-43be-9f71-32a0eea4a1f2","name":"Google Calendar1"},{"parameters":{"assignments":{"assignments":[{"id":"assignment-id-1","name":"response","value":"Horario disponible ","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-432,832],"id":"f44235fa-5dac-49a9-b37b-f0ec864569b3","name":"Response"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"condition-id-1","leftValue":"={{ $json.available }}","rightValue":"","operator":{"type":"boolean","operation":"true","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-768,848],"id":"88d1cfed-3f45-4d5d-a191-a8eda1587834","name":"If2"},{"parameters":{"calendar":{"__rl":true,"value":"steve-automatizacion-ia@group.calendar.google.com","mode":"list","cachedResultName":"Steve | Automatización IA"},"start":"={{ $('When Executed by Another Workflow').item.json['fecha y hora evento'] }}","end":"={{ new Date($(\"When Executed by Another Workflow\").item.json[\"fecha y hora evento\"]).plus(1, 'hour') }}","additionalFields":{"attendees":["={{ $('When Executed by Another Workflow').item.json.mail }}"],"description":"={{ $('When Executed by Another Workflow').item.json.description }}","summary":"={{ $('When Executed by Another Workflow').item.json.telefono }} - {{ $('When Executed by Another Workflow').item.json.nombre }}"}},"type":"n8n-nodes-base.googleCalendar","typeVersion":1.3,"position":[960,848],"id":"39e27e30-e075-44c2-9db4-5fd5f8884504","name":"Create event"},{"parameters":{"assignments":{"assignments":[{"id":"assignment-id-2","name":"response","value":"La fecha fecha del evento debe de ser de hoy a un máximo de 6 meses","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[432,1184],"id":"f616aff4-99b4-4372-9981-e4e5cb67a296","name":"Edit Fields1"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"condition-id-1","leftValue":"={{ $json.available }}","rightValue":"","operator":{"type":"boolean","operation":"true","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[672,928],"id":"aeb68845-1b22-47b2-a180-df28b3e20d0f","name":"If3"},{"parameters":{"promptType":"define","text":"=Quiero alternativas para esta fecha y hora: {{ $('When Executed by Another Workflow').item.json['fecha y hora evento'] }}","options":{"systemMessage":"=Eres un asistente encargado de proporcionar horarios alternativos a un horario de cita que no esta disponible para el mismo solicitado.\n\nHorarios de atención son: \n{{ $json.content }}\n\nHerramientas: \nGet Events: Usa esta herramientas para obtener todas las citas y devuelve los espacios disponibles. \n\nFormato de respuesta:\nNo ha disponibilidad para la fecha 19 de junio de 2025, a las 12:00. Sin embargo, te puedo ofrecer estos horarios alternativos para el mismo día:\n\n•⁠  ⁠9:00 a.m. a 10:00 a.m.\n•⁠  ⁠10:00 a.m. a 11:00 a.m.\n•⁠  ⁠11:00 a.m. a 12:00 p.m.\n•⁠  ⁠3:30 p.m. a 4:30 p.m.\n•⁠  ⁠4:30 p.m. a 5:30 p.m.\n•⁠  ⁠5:30 p.m. a 6:30 p.m.\n"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2,"position":[1296,1104],"id":"11474659-93cf-4733-92ad-317f6f9720bf","name":"AI Agent2"},{"parameters":{"model":{"__rl":true,"value":"gpt-4.1-mini","mode":"list","cachedResultName":"gpt-4.1-mini"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[1280,1312],"id":"286ec6e3-d2f9-4587-b7d5-dc672fa93ca4","name":"OpenAI Chat Model2"},{"parameters":{"resource":"calendar","calendar":{"__rl":true,"value":"steve-automatizacion-ia@group.calendar.google.com","mode":"list","cachedResultName":"Steve | Automatización IA"},"timeMin":"={{ $('When Executed by Another Workflow').item.json['fecha y hora evento'] }}","timeMax":"={{ new Date($(\"When Executed by Another Workflow\").item.json[\"fecha y hora evento\"]).plus(1, 'hour') }}\n","options":{}},"type":"n8n-nodes-base.googleCalendar","typeVersion":1.3,"position":[432,928],"id":"da9a660e-a8aa-44d0-a745-4f76ebf1b528","name":"Availability1"},{"parameters":{"assignments":{"assignments":[{"id":"assignment-id-1","name":"response","value":"Se creo el evento con éxtio","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[1216,848],"id":"f39673cc-2d05-44d5-b2e4-d6dc76fe6dc4","name":"Response1"},{"parameters":{"operation":"get","documentURL":"https://docs.google.com/document/d/Steve | Automatización IA/edit"},"type":"n8n-nodes-base.googleDocs","typeVersion":2,"position":[992,1104],"id":"1ddf5fe3-73eb-4ee0-8269-1f76d7920e04","name":"Google Docs1"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"condition-id-2","leftValue":"={{ new Date($json['fecha y hora evento']) > new Date() && new Date($json['fecha y hora evento']) <= new Date(new Date().setMonth(new Date().getMonth() + 6)) }}","rightValue":"","operator":{"type":"boolean","operation":"true","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[128,1056],"id":"e818c404-ca53-4b4a-8e95-2724915442e4","name":"If4"},{"parameters":{"operation":"getAll","calendar":{"__rl":true,"value":"steve-automatizacion-ia@group.calendar.google.com","mode":"list","cachedResultName":"Steve | Automatización IA"},"limit":10,"timeMin":"={{ $json[\"fecha y hora evento\"].split(\"T\")[0] + \"T00:00:00.000-07:00\" }}","timeMax":"={{ $json[\"fecha y hora evento\"].split(\"T\")[0] + \"T23:59:59.999-07:00\" }}","options":{}},"type":"n8n-nodes-base.googleCalendarTool","typeVersion":1.3,"position":[1504,1312],"id":"35ed9ccd-c785-4dab-af56-9c371e4bd536","name":"Google Calendar"},{"parameters":{"content":"## Respuesta","height":840,"width":1596,"color":5},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-1616,608],"id":"0506b8b2-add3-4b88-a4ea-eceb543078e0","name":"Sticky Note8"},{"parameters":{"content":"## Respuesta","height":840,"width":1676,"color":5},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[32,624],"id":"1ad920b2-089e-4b43-b316-bc84f3e47dc0","name":"Sticky Note9"},{"parameters":{"assignments":{"assignments":[{"id":"0e0def3a-64d7-441a-b779-bdd09c672ae3","name":"response","value":"El usuario no tiene citas registradas en el horario proporcionado.","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[2320,1040],"id":"2414811f-ddaf-499b-baf7-8482e2188c55","name":"Edit Fields"},{"parameters":{"operation":"delete","calendar":{"__rl":true,"value":"calendar_id_001","mode":"list","cachedResultName":"Steve | Automatización IA"},"eventId":"={{ $('get event').item.json.id }}","options":{}},"type":"n8n-nodes-base.googleCalendar","typeVersion":1.3,"position":[2320,848],"id":"aa56cdee-234e-44aa-83fe-e37c92dbb74d","name":"Google Calendar3"},{"parameters":{"operation":"getAll","calendar":{"__rl":true,"value":"calendar_id_001","mode":"list","cachedResultName":"Steve | Automatización IA"},"limit":1,"timeMin":"={{ $json['fecha y hora cancelar'] }}","timeMax":"={{ new Date($(\"When Executed by Another Workflow\").item.json[\"fecha y hora cancelar\"]).plus(1, 'hour') }}","options":{}},"type":"n8n-nodes-base.googleCalendar","typeVersion":1.3,"position":[1872,880],"id":"01b78abe-863e-4317-a458-f2145b479002","name":"get event","alwaysOutputData":true},{"parameters":{"assignments":{"assignments":[{"id":"0e0def3a-64d7-441a-b779-bdd09c672ae3","name":"response","value":"Se cancelo la cita con exito","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[2576,848],"id":"c514bf99-d6b7-46a9-bfe7-900270140488","name":"Edit Fields2"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"loose","version":2},"conditions":[{"id":"9a920cc4-f043-45b1-8a5e-ca9021b30dd7","leftValue":"={{ $json.summary }}","rightValue":"={{ $('When Executed by Another Workflow').item.json.telefono }}","operator":{"type":"string","operation":"contains"}}],"combinator":"and"},"looseTypeValidation":true,"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[2096,880],"id":"61870711-23ca-42d5-b5f9-0dbadac18e9b","name":"If5"},{"parameters":{"content":"## Respuesta","height":840,"width":1036,"color":5},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[1792,624],"id":"1321b449-c3ae-438d-a532-1d82257cc20c","name":"Sticky Note10"},{"parameters":{"operation":"getAll","calendar":{"__rl":true,"value":"calendar_id_001","mode":"list","cachedResultName":"Steve | Automatización IA"},"limit":10,"timeMin":"={{ $('When Executed by Another Workflow').item.json['fecha y hora nueva'].split(\"T\")[0] + \"T00:00:00.000-07:00\" }}","timeMax":"={{ $('When Executed by Another Workflow').item.json['fecha y hora nueva'].split(\"T\")[0] + \"T23:59:59.999-07:00\" }}","options":{}},"type":"n8n-nodes-base.googleCalendarTool","typeVersion":1.3,"position":[-96,2192],"id":"499f6655-c82e-48c2-81ea-537b9260902c","name":"Google Calendar4"},{"parameters":{"calendar":{"__rl":true,"value":"calendar_id_001","mode":"list","cachedResultName":"Steve | Automatización IA"},"start":"={{ $('When Executed by Another Workflow').item.json['fecha y hora nueva'] }}","end":"={{ new Date($(\"When Executed by Another Workflow\").item.json[\"fecha y hora nueva\"]).plus(1, 'hour') }}","additionalFields":{"attendees":["={{ $('get event1').item.json.attendees[0].email }}"],"description":"={{ $('get event1').item.json.description }}","summary":"=🟠 - {{ $('When Executed by Another Workflow').item.json.telefono }} - {{ $('When Executed by Another Workflow').item.json.nombre }}"}},"type":"n8n-nodes-base.googleCalendar","typeVersion":1.3,"position":[-464,1600],"id":"0f132b33-66fd-4f5b-bc4e-93e2ea0a8390","name":"Create an event"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"loose","version":2},"conditions":[{"id":"9a920cc4-f043-45b1-8a5e-ca9021b30dd7","leftValue":"={{ $json.summary }}","rightValue":"={{ $('When Executed by Another Workflow').item.json.telefono }}","operator":{"type":"string","operation":"contains"}}],"combinator":"and"},"looseTypeValidation":true,"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-1184,1760],"id":"651c68f2-8233-4677-bc50-9f8dce367679","name":"If6"},{"parameters":{"assignments":{"assignments":[{"id":"0e0def3a-64d7-441a-b779-bdd09c672ae3","name":"response","value":"El usuario no tiene citas registradas en el horario proporcionado.","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-960,1920],"id":"b240da4c-411f-4645-8a7c-75dd93e7b66c","name":"Edit Fields4"},{"parameters":{"resource":"calendar","calendar":{"__rl":true,"value":"calendar_id_001","mode":"list","cachedResultName":"Steve | Automatización IA"},"timeMin":"={{ $('When Executed by Another Workflow').item.json['fecha y hora nueva'] }}","timeMax":"={{ new Date($(\"When Executed by Another Workflow\").item.json[\"fecha y hora nueva\"]).plus(1, 'hour') }}\n","options":{}},"type":"n8n-nodes-base.googleCalendar","typeVersion":1.3,"position":[-960,1680],"id":"bb2b841f-895c-430d-aa2e-217df9159fa1","name":"Google Calendar2"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"f857f98d-5c4f-455d-80b1-3d4652559e4c","leftValue":"={{ $json.available }}","rightValue":"","operator":{"type":"boolean","operation":"true","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-736,1680],"id":"3357e179-a552-443d-82ee-1a12347c5a45","name":"If7"},{"parameters":{"operation":"delete","calendar":{"__rl":true,"value":"calendar_id_001","mode":"list","cachedResultName":"Steve | Automatización IA"},"eventId":"={{ $('get event1').item.json.id }}","options":{}},"type":"n8n-nodes-base.googleCalendar","typeVersion":1.3,"position":[-240,1600],"id":"877779fb-a3f0-4477-8b28-5ea81ab7296b","name":"Google Calendar5"},{"parameters":{"operation":"getAll","calendar":{"__rl":true,"value":"calendar_id_001","mode":"list","cachedResultName":"Steve | Automatización IA"},"limit":1,"timeMin":"={{ $json['fecha y hora actual'] }}","timeMax":"={{ new Date($(\"When Executed by Another Workflow\").item.json[\"fecha y hora actual\"]).plus(1, 'hour') }}","options":{}},"type":"n8n-nodes-base.googleCalendar","typeVersion":1.3,"position":[-1408,1760],"id":"688b4f65-685a-4cb0-b2e4-effff037877e","name":"get event1","alwaysOutputData":true},{"parameters":{"assignments":{"assignments":[{"id":"0e0def3a-64d7-441a-b779-bdd09c672ae3","name":"response","value":"Se hizo el cambio con exito","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[0,1600],"id":"ea2a7ef7-aec6-466b-a4d9-6e98b21ea5f2","name":"Edit Fields5"},{"parameters":{"promptType":"define","text":"=Quiero alternativas para esta fecha y hora: {{ $('When Executed by Another Workflow').item.json['fecha y hora nueva'] }}. \n\nLas alternativas las quiero para el mismo día: ","options":{"systemMessage":"Eres un asistente encargado de proporcionar horarios alternativos a un horario de cita que no esta disponible para el mismo día solicitado.\n\nHorarios de atención son: \n{{ $json.content }}\n\nHerramientas: \nGet Events: Usa esta herramientas para obtener todas las citas y devuelve los espacios disponibles.\n\nFormato de respuesta:\nNo ha disponibilidad para la fecha 19 de junio de 2025, a las 12:00. Sin embargo, te puedo ofrecer estos horarios alternativos para el mismo día:\n\n•⁠  ⁠9:00 a.m. a 10:00 a.m.\n•⁠  ⁠10:00 a.m. a 11:00 a.m.\n•⁠  ⁠11:00 a.m. a 12:00 p.m.\n•⁠  ⁠3:30 p.m. a 4:30 p.m.\n•⁠  ⁠4:30 p.m. a 5:30 p.m.\n•⁠  ⁠5:30 p.m. a 6:30 p.m.\n"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2,"position":[-288,1984],"id":"b712d3a2-523c-4b6b-bb1d-963f67ad2e09","name":"AI Agent3"},{"parameters":{"model":{"__rl":true,"value":"gpt-4.1-mini","mode":"list","cachedResultName":"gpt-4.1-mini"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[-304,2192],"id":"930b9813-e437-4142-b580-6cfda2cce2cc","name":"OpenAI Chat Model3"},{"parameters":{"operation":"get","documentURL":"https://docs.google.com/document/d/generic_document_id_001/edit"},"type":"n8n-nodes-base.googleDocs","typeVersion":2,"position":[-480,1984],"id":"22003265-9f85-4b53-b690-b5a8a4d07885","name":"Google Docs2"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"a99eceb4-53d4-4698-88b8-d9418e72645f","leftValue":"={{ new Date($json['fecha y hora nueva']) > new Date() && new Date($json['fecha y hora nueva']) <= new Date(new Date().setMonth(new Date().getMonth() + 6)) }}","rightValue":"","operator":{"type":"boolean","operation":"true","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-1616,1792],"id":"f3e75a3c-74d8-4639-b3d8-02c79ffe3cbb","name":"If8"},{"parameters":{"assignments":{"assignments":[{"id":"0e0def3a-64d7-441a-b779-bdd09c672ae3","name":"response","value":"La fecha fecha del evento debe de ser de hoy a un máximo de 6 meses","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-1408,1984],"id":"68e58cb7-9b14-4f42-8dc7-5b7df68f9609","name":"Edit Fields6"},{"parameters":{"content":"## Respuesta","height":840,"width":1884,"color":5},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-1632,1488],"id":"13268a39-ae6c-4346-885f-9d9f15065d91","name":"Sticky Note11"},{"parameters":{"promptType":"define","text":"={{ $json.messages[0].text.body }} ","options":{"systemMessage":"=Fecha y hora actual: {{ $now }}\n\n\n\nClaro, aquí tienes el texto que proporcionaste, organizado en formato Markdown para mayor claridad.\n\nDescripción General\nEres un asistente de calendario. Tus tareas incluyen crear, consultar y eliminar eventos en el calendario del usuario.\n\nHerramientas\nCreate Event with Attendee: Usa esta herramienta para crear eventos con participantes.\nCreate Event: Usa esta herramienta para eventos individuales.\nGet Events: Usa esta herramienta para obtener los horarios del calendario cuando se solicite.\nDelete Event: Usa esta herramienta para eliminar un evento. Primero, debes usar Get Events para obtener el ID del evento a eliminar.\nUpdate Event: Usa esta herramienta para modificar un evento. Primero, debes usar Get Events para obtener el ID del evento a actualizar.\n\n\nReglas\nSi no se indica la duración de un evento, asume que durará una hora.\nSi no se te indica asume que la sesión sera para el año: {{ $now.format('yyyy') }}"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.7,"position":[816,1664],"id":"8f73dd23-8091-41ea-b93d-613665528f81","name":"Calendar Agent"},{"parameters":{"calendar":{"__rl":true,"value":"calendar-id@group.calendar.google.com","mode":"list","cachedResultName":"Test Calendar"},"start":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Start', ``, 'string') }}","end":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('End', ``, 'string') }}","additionalFields":{"summary":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Summary', ``, 'string') }}"}},"type":"n8n-nodes-base.googleCalendarTool","typeVersion":1.3,"position":[1280,1872],"id":"3acc6a25-b563-4014-9863-4c79f492830c","name":"Create Event"},{"parameters":{"calendar":{"__rl":true,"value":"calendar-id@group.calendar.google.com","mode":"list","cachedResultName":"Test Calendar"},"start":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Start', ``, 'string') }}","end":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('End', ``, 'string') }}","additionalFields":{"attendees":["={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Attendees', ``, 'string') }}"],"summary":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Summary', ``, 'string') }}"}},"type":"n8n-nodes-base.googleCalendarTool","typeVersion":1.3,"position":[784,1952],"id":"0f0fc713-e309-4856-8e2e-37391e2725c3","name":"Create Event with Attendee"},{"parameters":{"operation":"update","calendar":{"__rl":true,"value":"calendar-id@group.calendar.google.com","mode":"list","cachedResultName":"Test Calendar"},"eventId":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Event_ID', ``, 'string') }}","updateFields":{"end":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('End', ``, 'string') }}","start":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Start', ``, 'string') }}"}},"type":"n8n-nodes-base.googleCalendarTool","typeVersion":1.3,"position":[1056,2048],"id":"cc1ac880-3012-4e11-bc5e-68b360eb3c33","name":"Update Event"},{"parameters":{"operation":"getAll","calendar":{"__rl":true,"value":"calendar-id@group.calendar.google.com","mode":"list","cachedResultName":"Test Calendar"},"returnAll":true,"timeMin":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('After', `12:01 AM of the day the user requested`, 'string') }}","timeMax":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Before', `11:59 PM of the day the user requested`, 'string') }}","options":{}},"type":"n8n-nodes-base.googleCalendarTool","typeVersion":1.3,"position":[1184,1968],"id":"eabe437c-d791-4d5b-af1e-476f29534a96","name":"Get Events"},{"parameters":{"operation":"delete","calendar":{"__rl":true,"value":"calendar-id@group.calendar.google.com","mode":"list","cachedResultName":"Test Calendar"},"eventId":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Event_ID', ``, 'string') }}","options":{}},"type":"n8n-nodes-base.googleCalendarTool","typeVersion":1.3,"position":[928,2032],"id":"b8308357-7cc4-487a-b8a6-ec3320625a0b","name":"Delete Event"},{"parameters":{"model":{"__rl":true,"value":"gpt-4.1-mini","mode":"list","cachedResultName":"gpt-4.1-mini"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[656,1872],"id":"10a68be5-48de-418f-bcef-f087fd2347ca","name":"4.1 mini"},{"parameters":{"operation":"send","phoneNumberId":"phone-number-id","recipientPhoneNumber":"={{ $('WhatsApp Trigger1').item.json.messages[0].from }}","textBody":"={{ $json.output }}","additionalFields":{}},"type":"n8n-nodes-base.whatsApp","typeVersion":1,"position":[1424,1664],"id":"5b9a0f68-fa12-4603-ac74-91697bd9a662","name":"Respond with Text1","webhookId":"webhook-id-1"},{"parameters":{"updates":["messages"],"options":{}},"type":"n8n-nodes-base.whatsAppTrigger","typeVersion":1,"position":[496,1664],"id":"cb1f5058-f35a-4c3e-ad35-50583d66295d","name":"WhatsApp Trigger1","webhookId":"webhook-id-2"},{"parameters":{"content":"## Respuesta","height":840,"width":1404,"color":5},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[320,1488],"id":"ddafd053-057c-4f1b-829d-21293945257a","name":"Sticky Note12"}],"connections":{"WhatsApp Trigger":{"main":[[{"node":"Input","type":"main","index":0}]]},"Simple Memory":{"ai_memory":[[{"node":"AI Agent","type":"ai_memory","index":0}]]},"AI Agent":{"main":[[{"node":"If","type":"main","index":0}]]},"Download Image":{"main":[[{"node":"Analyze Image","type":"main","index":0}]]},"Analyze Image":{"main":[[{"node":"Image + Text","type":"main","index":0}]]},"Download Audio":{"main":[[{"node":"Transcribe","type":"main","index":0}]]},"If":{"main":[[{"node":"Generate Audio","type":"main","index":0}],[{"node":"Respond with Text","type":"main","index":0}]]},"Generate Audio":{"main":[[{"node":"Respond with Audio","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"Audio URL":{"main":[[{"node":"Download Audio","type":"main","index":0}]]},"Image URL":{"main":[[{"node":"Download Image","type":"main","index":0}]]},"Text":{"main":[[{"node":"Redis","type":"main","index":0}]]},"Image + Text":{"main":[[{"node":"Redis","type":"main","index":0}]]},"Text Only":{"main":[[{"node":"Redis","type":"main","index":0}]]},"Input":{"main":[[{"node":"Audio URL","type":"main","index":0}],[{"node":"Image URL","type":"main","index":0}],[{"node":"Text Only","type":"main","index":0}],[{"node":"WhatsApp Business Cloud6","type":"main","index":0}]]},"Transcribe":{"main":[[{"node":"Text","type":"main","index":0}]]},"WhatsApp Business Cloud6":{"main":[[{"node":"HTTP Request3","type":"main","index":0}]]},"HTTP Request3":{"main":[[{"node":"Extract from File","type":"main","index":0}]]},"Extract from File":{"main":[[{"node":"HTTP Request4","type":"main","index":0}]]},"HTTP Request4":{"main":[[{"node":"Edit Fields3","type":"main","index":0}]]},"Edit Fields3":{"main":[[{"node":"Redis","type":"main","index":0}]]},"Redis":{"main":[[{"node":"Wait","type":"main","index":0}]]},"Wait":{"main":[[{"node":"Redis1","type":"main","index":0}]]},"Redis1":{"main":[[{"node":"If1","type":"main","index":0}]]},"If1":{"main":[[{"node":"Redis2","type":"main","index":0}],[{"node":"No Operation, do nothing","type":"main","index":0}]]},"Redis2":{"main":[[{"node":"Horarios","type":"main","index":0}]]},"Crear evento":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"Cancelar evento":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"Cambiar evento":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"Disponibilidad":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"Horarios":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"When Executed by Another Workflow":{"main":[[{"node":"Availability","type":"main","index":0}]]},"OpenAI Chat Model1":{"ai_languageModel":[[{"node":"AI Agent1","type":"ai_languageModel","index":0}]]},"Availability":{"main":[[{"node":"If2","type":"main","index":0}]]},"Google Docs":{"main":[[{"node":"AI Agent1","type":"main","index":0}]]},"Google Calendar1":{"ai_tool":[[{"node":"AI Agent1","type":"ai_tool","index":0}]]},"If2":{"main":[[{"node":"Response","type":"main","index":0}],[{"node":"Google Docs","type":"main","index":0}]]},"Create event":{"main":[[{"node":"Response1","type":"main","index":0}]]},"If3":{"main":[[{"node":"Create event","type":"main","index":0}],[{"node":"Google Docs1","type":"main","index":0}]]},"OpenAI Chat Model2":{"ai_languageModel":[[{"node":"AI Agent2","type":"ai_languageModel","index":0}]]},"Availability1":{"main":[[{"node":"If3","type":"main","index":0}]]},"Google Docs1":{"main":[[{"node":"AI Agent2","type":"main","index":0}]]},"If4":{"main":[[{"node":"Availability1","type":"main","index":0}],[{"node":"Edit Fields1","type":"main","index":0}]]},"Google Calendar":{"ai_tool":[[{"node":"AI Agent2","type":"ai_tool","index":0}]]},"Google Calendar3":{"main":[[{"node":"Edit Fields2","type":"main","index":0}]]},"get event":{"main":[[{"node":"If5","type":"main","index":0}]]},"If5":{"main":[[{"node":"Google Calendar3","type":"main","index":0}],[{"node":"Edit Fields","type":"main","index":0}]]},"Google Calendar4":{"ai_tool":[[{"node":"AI Agent3","type":"ai_tool","index":0}]]},"Create an event":{"main":[[{"node":"Google Calendar5","type":"main","index":0}]]},"If6":{"main":[[{"node":"Google Calendar2","type":"main","index":0}],[{"node":"Edit Fields4","type":"main","index":0}]]},"Google Calendar2":{"main":[[{"node":"If7","type":"main","index":0}]]},"If7":{"main":[[{"node":"Create an event","type":"main","index":0}],[{"node":"Google Docs2","type":"main","index":0}]]},"Google Calendar5":{"main":[[{"node":"Edit Fields5","type":"main","index":0}]]},"get event1":{"main":[[{"node":"If6","type":"main","index":0}]]},"OpenAI Chat Model3":{"ai_languageModel":[[{"node":"AI Agent3","type":"ai_languageModel","index":0}]]},"Google Docs2":{"main":[[{"node":"AI Agent3","type":"main","index":0}]]},"If8":{"main":[[{"node":"get event1","type":"main","index":0}],[{"node":"Edit Fields6","type":"main","index":0}]]},"Create Event":{"ai_tool":[[{"node":"Calendar Agent","type":"ai_tool","index":0}]]},"Create Event with Attendee":{"ai_tool":[[{"node":"Calendar Agent","type":"ai_tool","index":0}]]},"Update Event":{"ai_tool":[[{"node":"Calendar Agent","type":"ai_tool","index":0}]]},"Get Events":{"ai_tool":[[{"node":"Calendar Agent","type":"ai_tool","index":0}]]},"Delete Event":{"ai_tool":[[{"node":"Calendar Agent","type":"ai_tool","index":0}]]},"Calendar Agent":{"main":[[{"node":"Respond with Text1","type":"main","index":0}]]},"4.1 mini":{"ai_languageModel":[[{"node":"Calendar Agent","type":"ai_languageModel","index":0}]]},"WhatsApp Trigger1":{"main":[[{"node":"Calendar Agent","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":null,"pinData":{},"versionId":"375d9af6-6846-4bf1-9259-1d7a50f192ec","triggerCount":0,"shared":[{"createdAt":"2025-07-16T18:38:46.243Z","updatedAt":"2025-07-16T18:38:46.243Z","role":"workflow:owner","workflowId":"vM1Zkn2VCrWrBaeQ","projectId":"n4vHSDQygtGMKCrV"}],"tags":[]}