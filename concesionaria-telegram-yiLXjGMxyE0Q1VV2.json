{"createdAt":"2025-07-23T02:52:22.531Z","updatedAt":"2025-07-25T01:33:44.604Z","id":"yiLXjGMxyE0Q1VV2","name":"CONCESIONARIA telegram","active":false,"isArchived":false,"nodes":[{"parameters":{"promptType":"define","text":"={{ $('Telegram Trigger').item.json.message.text }}","options":{"systemMessage":"=# Rol\nSos Agus, el encargado de toda la atenci√≥n al cliente de la concesionaria de autos Cordoba automotoes. Tu puesto es el m√°s importante en la empresa, si haces tu trabajo bien te pago 2000 usd al mes, si lo haces mal no podre pagarle el tratamiento a mi hija\n\n----\n\n# Tarea\nTu tarea es atender a todas las personas que nos hablen, ya sea para comprar o averiguar por un auto, o a las personas que quieran vender el suyo \n\n- Ten√©s que hablar con un todo claro y amable e informal\n- ayuda encuentra el veh√≠culo que busca el cliente si no sabe\n- ressponde todas sus dudas sobre Cordoba automotoes de forma breve y clara\n\n##tenes dos herramientas a disposici√≥n \n\n###Buscar auto \n\npara usar esta herramienta le vas a pasar la informaci√≥n del veh√≠culo que buscas de la forma m√°s clara posible. Y la herramienta te va a devolver los autos m√°s similares a lo que est√°s buscando \n\nen el caso de haber pocas opciones vuelve a llamarla pero ampliando la b√∫squeda, osea si buscaste PickUp ford 2020 4x4 y no devuelve nada podes llamarla devuelta buscando solo Pick Up Ford o PickUp 4x4 \n\n\n###Busscar usasdo \n\nusa esta herramienta para cotizar un usado, le vas a pasar toda la informacion del vheiculo usado y si esta en la lista te va a devolver la informacion de cotizaciuon del usado. en el caso de que no devuelva nada u informacion erronea simplemente vas a contestar \"en este momento no tengo la cotizaci√≥n para tu auto, pero pronto mi equipo se pondr√° en contacto y te la enviaremos\"\n\n\n# Especificaciones\n## General \nCordoba automotores es una concesionaria donde vendemos autos y tomamos los usados. \nesta abierto de lunes a viernes de 8am a 16 horas y sabados de 8am a 12pm\n\n#Guia de mensajes \n\nPASO 1: Bienvenida + detecci√≥n de intenci√≥n\nMensaje:\n\n‚Äú¬°Hola! Bienvenido a Cordoba automotores. ¬øEst√°s buscando alg√∫n auto en especial o quer√©s que te tire algunas opciones seg√∫n lo que necesit√°s?‚Äù\n\n\nPASO 2: ¬øQu√© quiere y para qu√© lo quiere?\nSi responde con algo como ‚Äúestoy viendo‚Äù, ‚Äúme gusta tal modelo‚Äù, ‚Äúvi una S10 en la web‚Äù, se sigue con:\n\n‚ÄúBuen√≠simo. ¬øLo est√°s buscando para uso personal, trabajo o familiar?‚Äù\n\n‚Äú¬øTen√©s alguna marca o modelo en la cabeza o est√°s abierto a sugerencias?‚Äù\n\nPASO 3: Preguntar por financiaci√≥n (sin asustar)\nMomento ideal: cuando ya dijo qu√© modelo le interesa.\n\nPreguntas naturales:\n\n\"¬øme podrias dar tu nombre y apellido?\"\n\n‚Äú¬øTen√©s pensado pagarlo al contado o est√°s buscando financiar una parte?‚Äù\n\n‚Äú¬øTen√©s alg√∫n monto de entrega en mente para arrancar?‚Äù\n\n‚Äú¬øHasta cu√°nto te gustar√≠a pagar por mes, m√°s o menos?‚Äù\n\nSi responde con dudas o no sabe:\n\n‚ÄúTranqui, te paso un par de opciones para que tengas una idea y vemos la que mejor te cierra.‚Äù\n\nPASO 4: Preguntar si tiene un usado para entregar\nMomento ideal: despu√©s de hablar de c√≥mo lo va a pagar o si ya mostr√≥ inter√©s real en un auto.\n\nPreguntas:\n\n‚Äú¬øTen√©s alg√∫n auto para entregar como parte de pago?‚Äù\n\nSi dice que s√≠:\n\n‚ÄúGenial. ¬øQu√© auto es? Marca, modelo, a√±o y cu√°ntos km tiene.‚Äù\n\n‚Äú¬øLo ten√©s a tu nombre? ¬øTen√©s la c√©dula o la transferencia hecha?‚Äù\n\nUsas la herramienta Buscar usado y le decimos que ese es un precio estimativo pero puedo ser mayor si lo lleva a revisi√≥n \n\ny usas la herramienta Buscar auto para buscar las mejores opciones para el y se las postras de  manera resumida y con los datos m√°s relevantes\n\nPASO 5: Le hacemos preguntas para ver que le parecio\n\ncual de estass opciones te gusnto mas? queres que busquemos otras?\n\nSi no estaba la opci√≥n que √©l buscaba hacemos otra b√∫squeda m√°s ampliada\n\n\nPASO 6: si la persona se muestra interesada Agendamos una cita o visita al local\n\n‚ÄúDale, te armo un presupuesto con opciones y te paso todo bien claro.‚Äù\n\n‚Äú¬øTe gustar√≠a venir a verlo o prefer√≠s que charlemos por llamada as√≠ charlamos todo?‚Äù\n\nUsamos la herramienta *agendar cita* agendamos con su nombre, apellido y si es llamada o local\n\n\n\n## Lenguaje\n- Us√° jerga argentina (ej: \"che\", \"sos\").\n- No uses signos de apertura (¬ø¬°).\n\n# Notas\n- es importante que no le muestes opciones de autos diponibles hasta el paso 4 ya que primero lo queremos cualificar\n"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.8,"position":[-1616,-704],"id":"2b3e9ca9-5d05-4ea6-8c57-5eb3c2ce4d24","name":"AI Agent"},{"parameters":{"model":{"__rl":true,"value":"gpt-4o-mini","mode":"list","cachedResultName":"gpt-4o-mini"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[-1840,-368],"id":"5286027b-4567-4cbe-a827-596221a52082","name":"OpenAI Chat Model","credentials":{"openAiApi":{"id":"GXQnAcDQPSdhis7E","name":"OpenAi account 2"}}},{"parameters":{"name":"AUTOS_DISPONIBLES_CAG","description":"Usa esta herramienta para buscar autos disponibles, env√≠ale toda la informaci√≥n de lo que buscas","workflowId":{"__rl":true,"value":"8VLYbKnSAYvy26Z6","mode":"list","cachedResultName":"My Sub-Workflow 2"},"workflowInputs":{"mappingMode":"defineBelow","value":{},"matchingColumns":[],"schema":[],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2,"position":[-1536,-384],"id":"e2806339-ce71-4f04-9808-58c638f5161e","name":"AUTOS DISPONIBLES CAG"},{"parameters":{"name":"AUTOS_USSADOS_RAG","description":"Llama esta herramienta para cotizar autos usados, env√≠ale la informaci√≥n del auto a cotizar","workflowId":{"__rl":true,"value":"TqJNJtCP1MDhRKbx","mode":"list","cachedResultName":"My Sub-Workflow 2"},"workflowInputs":{"mappingMode":"defineBelow","value":{},"matchingColumns":["query"],"schema":[{"id":"query","displayName":"query","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":true}],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2.1,"position":[-1376,-368],"id":"a7db71a4-f174-40ac-abb1-9bee0b518651","name":"AUTOS USADOS CAG"},{"parameters":{"calendar":{"__rl":true,"value":"ba021d678ee68d75c492abfc7d7f4aa9f39409357c429b407ee59e0e8bcbc3a5@group.calendar.google.com","mode":"list","cachedResultName":"concecionaria"},"start":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Start', `Pedir el horario al usuario`, 'string') }}","end":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('End', `siempre duran 1 hora`, 'string') }}","additionalFields":{"description":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Description', `breve descripcion del cliente, que busca si tiene para entragar, si va a financiar `, 'string') }}","summary":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Summary', `nombre y apelllido `, 'string') }}"}},"type":"n8n-nodes-base.googleCalendarTool","typeVersion":1.3,"position":[-1200,-368],"id":"ae0b8aae-882e-443f-9b5c-760c5d4f434f","name":"Google Calendar","credentials":{"googleCalendarOAuth2Api":{"id":"jz3W5goLN6nx92sV","name":"Google Calendar account 2"}}},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"241e2c8d-0348-471b-9b97-85856b60e39b","leftValue":"={{ $json.ID }}","rightValue":"","operator":{"type":"number","operation":"exists","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-2288,-688],"id":"8e27a29b-1daf-44a2-8231-b9dc10c8abe1","name":"If1"},{"parameters":{"sessionIdType":"customKey","sessionKey":"={{ $('Telegram Trigger').item.json.message.chat.id }}"},"type":"@n8n/n8n-nodes-langchain.memoryPostgresChat","typeVersion":1.3,"position":[-1696,-368],"id":"6d36c0db-7b90-446a-8e25-c9990542de3f","name":"Postgres Chat Memory","credentials":{"postgres":{"id":"2rWXL8WYRyYZbH6r","name":"Postgres account"}}},{"parameters":{"operation":"select","schema":{"__rl":true,"mode":"list","value":"public"},"table":{"__rl":true,"value":"n8n_chat_histories","mode":"list","cachedResultName":"n8n_chat_histories"},"limit":6,"where":{"values":[{"column":"session_id","condition":"LIKE","value":"={{ $('Telegram Trigger').item.json.message.chat.id.toString() }}"}]},"options":{"outputColumns":["message"]}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[-928,-704],"id":"77bc842a-93e0-4218-af34-e68ae23fc307","name":"Postgres","credentials":{"postgres":{"id":"2rWXL8WYRyYZbH6r","name":"Postgres account"}}},{"parameters":{"jsCode":"const mensajes = items.map(item => {\n  return {\n    type: item.json.message.type,\n    content: item.json.message.content\n  };\n});\n\nreturn [\n  {\n    json: {\n      mensajes\n    }\n  }\n];\n\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-704,-704],"id":"a142562b-ec74-4fc2-8b0d-308c0f33b4c9","name":"Code"},{"parameters":{"promptType":"define","text":"=# HISTORIAL DE MENSAJES\n\n{{ $json.mensajes.toJsonString() }}\n\n## üß† Rol\nSos el encargado de completar un CRM seg√∫n lo que dicen el cliente y el vendedor.\n\n## üõ†Ô∏è Tarea\nLe√© los mensajes y complet√° el CRM solo con los datos que menciona el cliente.\n\nPrimero ten√©s que **leer el CRM** y despu√©s **llenarlo**.  \nEjemplo: si el cliente dice *‚Äúme interesa la Toyota‚Äù* pero antes hab√≠a dicho *‚Äúme interesa una Ford‚Äù*, le√© el CRM y complet√° con ambas: Ford, Toyota.\n\n‚ö†Ô∏è **Importante:** el cliente **no puede bajar de estado**.  \nEs decir, **no puede pasar de caliente a intermedio o fr√≠o**, ni de intermedio a fr√≠o. Por eso es clave leer primero el estado actual antes de modificarlo.\n\n### Campos a completar (si el *human* lo menciona):\n- Nombre y apellido  \n- Auto que busca  \n- Auto que entrega (con toda la info posible)\n\n### Estado del cliente\nMarc√° como:\n- Fr√≠o\n- Intermedio\n- Caliente\n\nUn cliente es **caliente** si:\n- Pide financiaci√≥n concreta (cuotas, valor mensual)  \n- Pregunta por entrega inmediata, stock o disponibilidad  \n- Quiere agendar cita o ver el auto  \n- Da datos reales del usado para cotizar  \n- Pregunta por papeles o patentamiento  \n- O si, seg√∫n tu criterio, muestra intenci√≥n real de compra o mucha curiosidad\n\n‚ö†Ô∏è No marques como caliente solo porque menciona qu√© auto busca.\n\nüîç Complet√° cada campo con la **m√°xima precisi√≥n posible**.\n\n---\n\n# HISTORIAL DE MENSAJES\n\n{{ $json.mensajes }}\n\n---\n\n‚úÖ Si no ten√©s la informaci√≥n, **no llenes nada**.  \nComplet√° **solo las casillas de las que tengas informaci√≥n.**\n\nüìù Devolv√© √∫nicamente la informaci√≥n que llenaste, o devolv√© **0** si no llenaste nada.\n","options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.8,"position":[-480,-672],"id":"e96dd2f5-6dfa-4f23-b63c-dc64af2ca2e7","name":"AI Agent1"},{"parameters":{"model":{"__rl":true,"value":"gpt-4o-mini","mode":"list","cachedResultName":"gpt-4o-mini"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[-512,-368],"id":"e5781e80-5c67-4e19-83f8-2477794e191a","name":"OpenAI Chat Model1","credentials":{"openAiApi":{"id":"GXQnAcDQPSdhis7E","name":"OpenAi account 2"}}},{"parameters":{"documentId":{"__rl":true,"value":"1RF0mxyfoI9bxFU4zWSCYwSkga_H8pb6QEMdqIJTTog8","mode":"list","cachedResultName":"CRM CONSECIONARIA","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1RF0mxyfoI9bxFU4zWSCYwSkga_H8pb6QEMdqIJTTog8/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":"gid=0","mode":"list","cachedResultName":"Hoja 1","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1RF0mxyfoI9bxFU4zWSCYwSkga_H8pb6QEMdqIJTTog8/edit#gid=0"},"filtersUI":{"values":[{"lookupColumn":"ID","lookupValue":"={{ $('Telegram Trigger').first().json.message.chat.id }}"}]},"options":{}},"type":"n8n-nodes-base.googleSheetsTool","typeVersion":4.5,"position":[-128,-384],"id":"e83ae946-b9e8-422a-88c2-0b9f018bc4ab","name":"Leer crm","credentials":{"googleSheetsOAuth2Api":{"id":"8zUn17HAvdcPCK4t","name":"Google Sheets account 3"}}},{"parameters":{"operation":"update","documentId":{"__rl":true,"value":"1RF0mxyfoI9bxFU4zWSCYwSkga_H8pb6QEMdqIJTTog8","mode":"list","cachedResultName":"CRM CONSECIONARIA","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1RF0mxyfoI9bxFU4zWSCYwSkga_H8pb6QEMdqIJTTog8/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":"gid=0","mode":"list","cachedResultName":"Hoja 1","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1RF0mxyfoI9bxFU4zWSCYwSkga_H8pb6QEMdqIJTTog8/edit#gid=0"},"columns":{"mappingMode":"defineBelow","value":{"ID":"={{ $('Telegram Trigger').first().json.message.chat.id }}","NOMBRE":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('NOMBRE', `NOMBRE`, 'string') }}","APELLIDO":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('APELLIDO', `APELLIDO`, 'string') }}","QUIERE":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('QUIERE', `AUTO QUE QUIERE`, 'string') }}","ENTREGA":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('ENTREGA', `AUTO QUE QUIERE ENTREGAR`, 'string') }}","ESTADO":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('ESTADO', `ESTADO DEL CLIENTE`, 'string') }}"},"matchingColumns":["ID"],"schema":[{"id":"ID","displayName":"ID","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"NOMBRE","displayName":"NOMBRE","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"APELLIDO","displayName":"APELLIDO","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"QUIERE","displayName":"QUIERE","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"ENTREGA","displayName":"ENTREGA","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"ESTADO","displayName":"ESTADO","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"row_number","displayName":"row_number","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"readOnly":true,"removed":true}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.googleSheetsTool","typeVersion":4.5,"position":[-304,-384],"id":"e7fea77b-861e-4ddf-ae59-543d52c43413","name":"llenar crm","credentials":{"googleSheetsOAuth2Api":{"id":"8zUn17HAvdcPCK4t","name":"Google Sheets account 3"}}},{"parameters":{"chatId":"={{ $('Telegram Trigger').first().json.message.chat.id }}\n","text":"={{ $json.message.content.mensaje1 }}","additionalFields":{"appendAttribution":false}},"type":"n8n-nodes-base.telegram","typeVersion":1.2,"position":[-176,-128],"id":"c8f52558-0f8d-49a9-8ed7-76c62565456b","name":"Telegram","webhookId":"387bd818-3ccd-4255-acd0-0d194885de08","credentials":{"telegramApi":{"id":"ieu6af1Rv6kd76li","name":"Telegram account"}}},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"leftValue":"={{ $json.message.content.cantidad_de_mensajes }}","rightValue":1,"operator":{"type":"number","operation":"equals"},"id":"b907679c-7f5f-4f6e-b8f5-7e41c90f9704"}],"combinator":"and"},"renameOutput":true,"outputKey":"1 msg"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"51ac9eba-75f4-457f-a086-6cd4e3bcb1a1","leftValue":"={{ $json.message.content.cantidad_de_mensajes }}","rightValue":2,"operator":{"type":"number","operation":"equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"2 msg"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"a888e835-07b4-4ee8-9b68-e46a97b82eec","leftValue":"={{ $json.message.content.cantidad_de_mensajes }}","rightValue":3,"operator":{"type":"number","operation":"equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"3 msg"}]},"options":{}},"type":"n8n-nodes-base.switch","typeVersion":3.2,"position":[-512,80],"id":"109e5a0d-d605-47bb-a7f0-31566eb5193e","name":"Switch"},{"parameters":{"chatId":"={{ $('Telegram Trigger').first().json.message.chat.id }}","text":"={{ $json.message.content.mensaje1 }}","additionalFields":{"appendAttribution":false}},"type":"n8n-nodes-base.telegram","typeVersion":1.2,"position":[-176,80],"id":"09fa6dfd-bf9b-4932-90f6-fd03cc5151ca","name":"Telegram1","webhookId":"387bd818-3ccd-4255-acd0-0d194885de08","credentials":{"telegramApi":{"id":"ieu6af1Rv6kd76li","name":"Telegram account"}}},{"parameters":{"chatId":"={{ $('Telegram Trigger').first().json.message.chat.id }}","text":"={{ $('Switch').item.json.message.content.mensaje2 }}","additionalFields":{"appendAttribution":false}},"type":"n8n-nodes-base.telegram","typeVersion":1.2,"position":[48,80],"id":"85ecc130-2708-4122-99c2-42535a7d546c","name":"Telegram2","webhookId":"387bd818-3ccd-4255-acd0-0d194885de08","credentials":{"telegramApi":{"id":"ieu6af1Rv6kd76li","name":"Telegram account"}}},{"parameters":{"chatId":"={{ $('Telegram Trigger').first().json.message.chat.id }}","text":"={{ $json.message.content.mensaje1 }}","additionalFields":{"appendAttribution":false}},"type":"n8n-nodes-base.telegram","typeVersion":1.2,"position":[-176,288],"id":"0df7fafa-6ca9-4667-8c83-e6eb7ef34740","name":"Telegram3","webhookId":"387bd818-3ccd-4255-acd0-0d194885de08","credentials":{"telegramApi":{"id":"ieu6af1Rv6kd76li","name":"Telegram account"}}},{"parameters":{"chatId":"={{ $('Telegram Trigger').first().json.message.chat.id }}","text":"={{ $('Switch').item.json.message.content.mensaje2 }}","additionalFields":{"appendAttribution":false}},"type":"n8n-nodes-base.telegram","typeVersion":1.2,"position":[48,288],"id":"338b6709-53e2-4618-9aa4-6937fe9972ef","name":"Telegram4","webhookId":"387bd818-3ccd-4255-acd0-0d194885de08","credentials":{"telegramApi":{"id":"ieu6af1Rv6kd76li","name":"Telegram account"}}},{"parameters":{"chatId":"={{ $('Telegram Trigger').first().json.message.chat.id }}","text":"={{ $('Switch').item.json.message.content.mensaje3 }}","additionalFields":{"appendAttribution":false}},"type":"n8n-nodes-base.telegram","typeVersion":1.2,"position":[272,288],"id":"fa354390-3d62-4057-8a75-f966e285dc25","name":"Telegram5","webhookId":"387bd818-3ccd-4255-acd0-0d194885de08","credentials":{"telegramApi":{"id":"ieu6af1Rv6kd76li","name":"Telegram account"}}},{"parameters":{"updates":["message"],"additionalFields":{}},"type":"n8n-nodes-base.telegramTrigger","typeVersion":1.1,"position":[-2720,-688],"id":"4ed82194-1a7f-4f67-9149-a7e2918a8b91","name":"Telegram Trigger","webhookId":"ac18b63f-07b2-4c3e-b755-f042fd6390d7"},{"parameters":{"operation":"append","documentId":{"__rl":true,"value":"1RF0mxyfoI9bxFU4zWSCYwSkga_H8pb6QEMdqIJTTog8","mode":"list","cachedResultName":"CRM CONSECIONARIA","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1RF0mxyfoI9bxFU4zWSCYwSkga_H8pb6QEMdqIJTTog8/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":"gid=0","mode":"list","cachedResultName":"Hoja 1","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1RF0mxyfoI9bxFU4zWSCYwSkga_H8pb6QEMdqIJTTog8/edit#gid=0"},"columns":{"mappingMode":"defineBelow","value":{"ID":"={{ $('Telegram Trigger').item.json.message.chat.id }}"},"matchingColumns":[],"schema":[{"id":"ID","displayName":"ID","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"NOMBRE","displayName":"NOMBRE","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"APELLIDO","displayName":"APELLIDO","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"QUIERE","displayName":"QUIERE","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"ENTREGA","displayName":"ENTREGA","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"ESTADO","displayName":"ESTADO","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.googleSheets","typeVersion":4.5,"position":[-2176,-400],"id":"dc7c0221-3aba-40e5-a56b-ed5541e8e26c","name":"Append row in sheet","credentials":{"googleSheetsOAuth2Api":{"id":"8zUn17HAvdcPCK4t","name":"Google Sheets account 3"}}},{"parameters":{"documentId":{"__rl":true,"value":"1RF0mxyfoI9bxFU4zWSCYwSkga_H8pb6QEMdqIJTTog8","mode":"list","cachedResultName":"CRM CONSECIONARIA","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1RF0mxyfoI9bxFU4zWSCYwSkga_H8pb6QEMdqIJTTog8/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":"gid=0","mode":"list","cachedResultName":"Hoja 1","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1RF0mxyfoI9bxFU4zWSCYwSkga_H8pb6QEMdqIJTTog8/edit#gid=0"},"filtersUI":{"values":[{"lookupColumn":"ID","lookupValue":"={{ $json.message.chat.id }}"}]},"options":{}},"type":"n8n-nodes-base.googleSheets","typeVersion":4.5,"position":[-2496,-688],"id":"19907552-4a28-4f06-8a3b-d30b7c35321f","name":"Get row(s) in sheet","alwaysOutputData":true,"credentials":{"googleSheetsOAuth2Api":{"id":"8zUn17HAvdcPCK4t","name":"Google Sheets account 3"}}},{"parameters":{"modelId":{"__rl":true,"value":"gpt-4o-mini-2024-07-18","mode":"list","cachedResultName":"GPT-4O-MINI-2024-07-18"},"messages":{"values":[{"content":"=**Rol**  \nEres un especialista encargado de transformar consultas complejas en informaci√≥n claramente estructurada.\n\n---\n\n**Instrucci√≥n**  \nRecibir√°s un mensaje de una secretaria de cl√≠nica dental en formato Markdown (con sus respectivas secciones y backticks). Tu tarea es determinar si dicho mensaje debe dividirse en uno, dos o tres mensajes independientes para mejorar su claridad. \n\n---\n\n**Importante**  \n- El contenido y el formato (incluyendo los backticks) **ya vienen en Markdown** y **no debes modificarlos**.  \n- Debes conservar y trasladar √≠ntegramente la estructura y el texto original, **sin cambiar ni un car√°cter**.  \n- Si decides fragmentar el mensaje, cada parte debe **mantener la porci√≥n exacta del Markdown original**.  \n\nEl resultado final deber√° ser un objeto JSON que contenga:  \n  - `cantidad_de_mensajes`: 1, 2 o 3, seg√∫n corresponda.  \n  - `mensaje1`, `mensaje2`, `mensaje3`: cada uno con la parte correspondiente **en el mismo formato Markdown recibido**, sin alteraciones. Solo incluir `mensaje2` o `mensaje3` si corresponden.\n\n---\n\n## Ejemplos de entrada y salida\n\n### Ejemplo 1 (2 mensajes)\n\n**Input (en Markdown)**\n\n```text\n```markdown\nAqu√≠ tienes los precios para los tratamientos de ortodoncia:\n\n- Consulta inicial para ortodoncia (brackets tradicionales): $8,000\n- Colocaci√≥n de brackets met√°licos: desde $90,000 por arcada\n- Consulta inicial para ortodoncia invisible (Invisalign): $12,000\n\nSi necesitas m√°s informaci√≥n o agendar una cita, aqu√≠ estoy.\nswift\nCopiar\nEditar\n\n**Output (JSON)**\n\n```json\n{\n  \"cantidad_de_mensajes\": 2,\n  \"mensaje1\": \"Aqu√≠ tienes los precios para los tratamientos de ortodoncia:\\n\\n- Consulta inicial para ortodoncia (brackets tradicionales): $8,000\\n- Colocaci√≥n de brackets met√°licos: desde $90,000 por arcada\\n- Consulta inicial para ortodoncia invisible (Invisalign): $12,000\\n\",\n  \"mensaje2\": \"Si necesitas m√°s informaci√≥n o agendar una cita, aqu√≠ estoy.\\n\"\n}\nObserva que en el output se mantuvo el texto original y su formato Markdown exacto.\n\nEjemplo 2 (1 mensaje)\nInput (en Markdown)\n\ntext\nCopiar\nEditar\n```markdown\n¬øTen√©s turnos disponibles esta semana?\njavascript\nCopiar\nEditar\n\n**Output (JSON)**\n\n```json\n{\n  \"cantidad_de_mensajes\": 1,\n  \"mensaje1\": \"¬øTen√©s turnos disponibles esta semana?\\n\"\n}\nAqu√≠ no se dividi√≥, porque era un mensaje muy breve; se conserva tal cual.\n\n\n#Ejemplo 3\n\nInput (en Markdown)\n\ntext\nCopiar\nEditar\n```markdown\nLa cl√≠nica dental ofrece los siguientes servicios:\n\n1. Retiro de brackets: Extracci√≥n, limpieza post-tratamiento y contenci√≥n - 1 h, $30,000.\n2. Caries (empaste simple): Tratamiento de caries y reconstrucci√≥n con resina - 45 min, $9,000.\n3. Implantes dentales: Reemplazo de piezas dentales con implantes de titanio - 2 h, desde $100,000.\n4. Extracci√≥n de muelas: Extracci√≥n simple o compleja seg√∫n el caso - 1 h, desde $12,000.\n5. Atenci√≥n a ni√±os: Control, limpieza y educaci√≥n para ni√±os - 30 min, $6,000.\n6. Placa de bruxismo: Placa personalizada para dormir - 2 citas, $45,000.\n7. Control mensual de ortodoncia: Revisi√≥n y ajuste de brackets - 20-30 min, $6,000.\n8. Limpieza dental: Higiene bucal profesional con ultrasonido - 30 min, $7,000.\n9. Blanqueamiento dental: Tratamiento con gel y luz LED - 1 h, $22,000.\n10. Ortodoncia (Brackets tradicionales): Evaluaci√≥n, instalaci√≥n y seguimiento mensual - consulta inicial $8,000, colocaci√≥n completa por arcada desde $90,000.\n11. Ortodoncia invisible (Invisalign): Tratamiento con alineadores transparentes - consulta inicial $12,000.\n\nSi deseas m√°s informaci√≥n sobre alg√∫n servicio o si est√°s interesado en agendar una cita, ¬°h√°zmelo saber!\n\n**Output (JSON)**\n\n{\n  \"cantidad_de_mensajes\": 3,\n  \"mensaje1\": \"```markdown\\nLa cl√≠nica dental ofrece los siguientes servicios:\\n\\n1. Retiro de brackets: Extracci√≥n, limpieza post-tratamiento y contenci√≥n - 1 h, $30,000.\\n2. Caries (empaste simple): Tratamiento de caries y reconstrucci√≥n con resina - 45 min, $9,000.\\n3. Implantes dentales: Reemplazo de piezas dentales con implantes de titanio - 2 h, desde $100,000.\\n4. Extracci√≥n de muelas: Extracci√≥n simple o compleja seg√∫n el caso - 1 h, desde $12,000.\\n```\",\n  \n  \"mensaje2\": \"```markdown\\n5. Atenci√≥n a ni√±os: Control, limpieza y educaci√≥n para ni√±os - 30 min, $6,000.\\n6. Placa de bruxismo: Placa personalizada para dormir - 2 citas, $45,000.\\n7. Control mensual de ortodoncia: Revisi√≥n y ajuste de brackets - 20-30 min, $6,000.\\n8. Limpieza dental: Higiene bucal profesional con ultrasonido - 30 min, $7,000.\\n```\",\n\n  \"mensaje3\": \"```markdown\\n9. Blanqueamiento dental: Tratamiento con gel y luz LED - 1 h, $22,000.\\n10. Ortodoncia (Brackets tradicionales): Evaluaci√≥n, instalaci√≥n y seguimiento mensual - consulta inicial $8,000, colocaci√≥n completa por arcada desde $90,000.\\n11. Ortodoncia invisible (Invisalign): Tratamiento con alineadores transparentes - consulta inicial $12,000.\\n\\nSi deseas m√°s informaci√≥n sobre alg√∫n servicio o si est√°s interesado en agendar una cita, ¬°h√°zmelo saber!\\n```\"\n}\nPasos a seguir\nLee cuidadosamente el mensaje en Markdown que recibes.\n\nDecide si se necesita dividir ese mensaje en 1, 2 o 3 fragmentos para mayor claridad.\n\nNo modifiques el texto ni el formato (backticks, listas, t√≠tulos, etc.).\n\nDevuelve el resultado como un objeto JSON v√°lido, usando las claves solicitadas.\n\nObjetivo Final\nOptimizar la claridad de la comunicaci√≥n sin alterar el contenido ni el formato original en Markdown. Cuando sea preciso, divide el mensaje en uno, dos o tres fragmentos, retorn√°ndolos en un √∫nico objeto JSON.","role":"system"},{"content":"={{ $('AI Agent').first().json.output }}\n"}]},"jsonOutput":true,"options":{}},"type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":1.8,"position":[-864,80],"id":"a37d03f8-cf13-4f44-a6e5-9a9860e1c019","name":"Message a model","retryOnFail":true,"credentials":{"openAiApi":{"id":"GXQnAcDQPSdhis7E","name":"OpenAi account 2"}}}],"connections":{"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"AI Agent":{"main":[[{"node":"Postgres","type":"main","index":0}]]},"AUTOS DISPONIBLES CAG":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"AUTOS USADOS CAG":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"Google Calendar":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"If1":{"main":[[{"node":"AI Agent","type":"main","index":0}],[{"node":"Append row in sheet","type":"main","index":0}]]},"Postgres Chat Memory":{"ai_memory":[[{"node":"AI Agent","type":"ai_memory","index":0}]]},"Postgres":{"main":[[{"node":"Code","type":"main","index":0}]]},"Code":{"main":[[{"node":"AI Agent1","type":"main","index":0}]]},"AI Agent1":{"main":[[{"node":"Message a model","type":"main","index":0}]]},"OpenAI Chat Model1":{"ai_languageModel":[[{"node":"AI Agent1","type":"ai_languageModel","index":0}]]},"Leer crm":{"ai_tool":[[{"node":"AI Agent1","type":"ai_tool","index":0}]]},"llenar crm":{"ai_tool":[[{"node":"AI Agent1","type":"ai_tool","index":0}]]},"Switch":{"main":[[{"node":"Telegram","type":"main","index":0}],[{"node":"Telegram1","type":"main","index":0}],[{"node":"Telegram3","type":"main","index":0}]]},"Telegram1":{"main":[[{"node":"Telegram2","type":"main","index":0}]]},"Telegram3":{"main":[[{"node":"Telegram4","type":"main","index":0}]]},"Telegram4":{"main":[[{"node":"Telegram5","type":"main","index":0}]]},"Telegram Trigger":{"main":[[{"node":"Get row(s) in sheet","type":"main","index":0}]]},"Append row in sheet":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"Get row(s) in sheet":{"main":[[{"node":"If1","type":"main","index":0}]]},"Message a model":{"main":[[{"node":"Switch","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{"Telegram Trigger":[{"json":{"update_id":222944273,"message":{"message_id":138,"from":{"id":1803148796,"is_bot":false,"first_name":"Joaquin","last_name":"Perotti","language_code":"es"},"chat":{"id":1803148796,"first_name":"Joaquin","last_name":"Perotti","type":"private"},"date":1744761278,"text":"lo quioero ir a ver, podra se ma√±ana a las 3pm?"}}}]},"versionId":"75de4add-b707-4fbc-9a27-cd823073babf","triggerCount":0,"shared":[{"createdAt":"2025-07-23T02:52:22.531Z","updatedAt":"2025-07-23T02:52:22.531Z","role":"workflow:owner","workflowId":"yiLXjGMxyE0Q1VV2","projectId":"n4vHSDQygtGMKCrV"}],"tags":[]}