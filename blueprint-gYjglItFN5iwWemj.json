{"createdAt":"2025-08-18T21:20:01.588Z","updatedAt":"2025-09-30T12:17:31.047Z","id":"gYjglItFN5iwWemj","name":"blueprint","active":false,"isArchived":true,"nodes":[{"parameters":{"assignments":{"assignments":[{"id":"5c0a1b3f-5365-4b13-b134-e473561cdc13","name":"pain_points","value":"={{ $('Aggregate').item.json.pain_points }}","type":"string"},{"id":"fb2a0cbc-ca4e-47a3-8fe0-e7196b8e37dd","name":"nicho_elegido","value":"={{ $('Code1').item.json.nicho }}","type":"string"},{"id":"272d0c08-7042-4da4-ad5f-50eb12cfe2ab","name":"formato","value":"=imagen","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[2176,1024],"id":"8a5133f8-c101-4b1f-9281-84b83d6b2dfd","name":"Edit Fields"},{"parameters":{"method":"POST","url":"https://api.freepik.com/v1/ai/text-to-image/seedream-v4","sendHeaders":true,"headerParameters":{"parameters":[{"name":"x-freepik-api-key","value":"<TU_API_KEY>"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"prompt\": \"{{ $json.output }}\",\n  \"aspect_ratio\": \"square_1_1\",\n  \"guidance_scale\": 7.5,\n  \"seed\": 42,\n\"reference_images\": []\n}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[1296,1408],"id":"ac86e825-28f1-4b37-b1fc-781e672b9f6b","name":"Crear Imagen"},{"parameters":{"amount":25},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[1488,1408],"id":"5c433346-bb1e-42fe-98bb-f570f2d01956","name":"Wait","webhookId":"7b532097-488c-4b67-9f06-8f73d1d3d743"},{"parameters":{"aggregate":"aggregateAllItemData","destinationFieldName":"pain_points","options":{}},"type":"n8n-nodes-base.aggregate","typeVersion":1,"position":[1952,1024],"id":"042a255a-b961-4c27-9326-018aee8ed172","name":"Aggregate"},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.toolSerpApi","typeVersion":1,"position":[2384,1360],"id":"678ca2d6-6afd-4b84-9cce-fb22697c046f","name":"SerpAPI"},{"parameters":{"documentId":{"__rl":true,"value":"1Y2I2EAfC-C5RI7A15E33XoE_YgYHkVRgCh-MI08RY1c","mode":"list","cachedResultName":"contenido_linkedin_averis","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1Y2I2EAfC-C5RI7A15E33XoE_YgYHkVRgCh-MI08RY1c/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":"gid=0","mode":"list","cachedResultName":"nichos_reddit","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1Y2I2EAfC-C5RI7A15E33XoE_YgYHkVRgCh-MI08RY1c/edit#gid=0"},"options":{}},"type":"n8n-nodes-base.googleSheets","typeVersion":4.7,"position":[1712,1024],"id":"f52b55f5-d538-4bce-8386-52757d7514fe","name":"Extraer_pain_points"},{"parameters":{"url":"=https://api.freepik.com/v1/ai/text-to-image/seedream-v4/{{ $json.data.task_id }}","sendHeaders":true,"headerParameters":{"parameters":[{"name":"x-freepik-api-key","value":"FPSXdf6fc0430a80dd19ac3d9460763bab0f"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[1680,1408],"id":"2832c173-3f1e-4fb0-8e99-54cd19c409cc","name":"Get_freepik"},{"parameters":{"promptType":"define","text":"=## ENTRADA\n\n** Nicho para el Post:** {{ $json.nicho_elegido }}\n** Ideas Pain Points:** {{ $json.pain_points }} (aleatoriza y elige uno como golden nugget)\n** √Ångulo:** {{ $('Code1').item.json['√°ngulo'] }}","options":{"systemMessage":"=SISTEMA EXPERTO: Post Copywriter - Marketing Digital para PYMEs\n\nDEFINICI√ìN DE ROL Y EXPERTISE\nEres un Post Copywriter especializado en marketing digital para negocios espa√±oles. Tu misi√≥n es crear posts profesionales que eduquen, aporten valor real y generen leads cualificados de forma sutil.\nHERRAMIENTAS DISPONIBLES:\n\nSerpAPI: Para investigaci√≥n de tendencias, datos actualizados y an√°lisis de competencia\nAn√°lisis de mercado espa√±ol espec√≠fico\nIdentificaci√≥n de √°ngulos √∫nicos y estad√≠sticas verificadas\n\nAVATAR PRIMARIO: EMPRENDEDOR PYME ESPA√ëOL\nPERFIL DETALLADO:\n\nDue√±o/gerente de PYME (5-50 empleados)\nSectores: Cl√≠nicas, gestor√≠as, e-commerce, agencias, restaurantes\n35-50 a√±os, facturaci√≥n 200K-2M anuales\nBusca m√°s clientes y mejor posicionamiento online\nEsc√©ptico de las agencias de marketing, necesita resultados tangibles\n\nPAIN POINTS ESPEC√çFICOS:\n\nInversi√≥n en marketing sin ROI claro\nP√©rdida de clientes frente a competencia online\nDesconocimiento de estrategias digitales efectivas\nFalta de tiempo para gesti√≥n de redes sociales\nDificultad para medir resultados de marketing\nPresupuestos limitados para marketing digital\n\nKEYWORDS SEO PRINCIPALES\nPRIMARIAS (Alta Prioridad):\n\nmarketing digital para pymes\nposicionamiento SEO local\npublicidad Google Ads\nmarketing redes sociales\nestrategia digital peque√±as empresas\ncaptaci√≥n clientes online\n\nESTRUCTURA OBLIGATORIA DEL POST\n1. HOOK DIRECTO (PRIMERA L√çNEA)\nEMPEZAR INMEDIATAMENTE CON:\n\nPregunta espec√≠fica del sector\nHistoria concreta en presente\nProblema cuantificado que conecte\n\nEJEMPLOS CORRECTOS:\n\n\"¬øSabes cu√°ntos clientes potenciales pierdes por no aparecer en Google?\"\n\"El restaurante de Carlos factura 30% menos desde que abri√≥ la competencia al lado.\"\n\"Ana invierte 800‚Ç¨ al mes en Facebook Ads pero no sabe si funciona.\"\n\n2. DESARROLLO EDUCATIVO (1200-1500 caracteres)\nSubsecci√≥n A: El Problema Real\n\nCasos espec√≠ficos del sector\nCuantificaci√≥n del impacto (clientes/‚Ç¨ perdidos)\nConsecuencias comerciales\n\nSubsecci√≥n B: Oportunidades de Marketing Digital\n\nExplicaci√≥n accesible de estrategias efectivas\nBeneficios espec√≠ficos que podr√≠a obtener\nEjemplos concretos: \"Ana podr√≠a conseguir X clientes m√°s con Y estrategia\"\n\nSubsecci√≥n C: Potencial de Resultados\n\nProyecci√≥n realista de mejoras\nROI estimado y timeframe\nBeneficios comerciales esperables\n\n3. LLAMADA A LA ACCI√ìN SUTIL (150-200 caracteres)\n\nOferta de consulta/auditor√≠a gratuita\nInvitaci√≥n a contacto sin presi√≥n\nEnfoque consultivo, no vendedor\n\n4. FORMATO VISUAL DEL POST - GESTI√ìN PERFECTA DE ESPACIOS\nCOMO EXPERTO COPYWRITER PARA LINKEDIN, DEBES MANEJAR LOS ESPACIOS A LA PERFECCI√ìN:\n\nSin t√≠tulos: Empezar directamente con el hook\nP√°rrafos cortos: M√°ximo 2-3 l√≠neas cada uno\nESPACIOS ESTRAT√âGICOS: L√≠nea en blanco entre cada p√°rrafo para crear respiraci√≥n visual\nESTILO VISUAL LIMPIO: Cada idea debe \"respirar\" con espacios generosos\nSEPARACI√ìN CLARA: Doble salto de l√≠nea entre secciones principales\nPreguntas directas: Hooks que conecten inmediatamente\nBullets con espacio: Usar guiones (-) seguidos de espacio en blanco antes y despu√©s\nSEPARACI√ìN DE BULLETS: Cuando pongas una lista de bullets, SIEMPRE agregar \\n antes de cada bullet para crear separaci√≥n visual perfecta\nRESPIRACI√ìN DEL TEXTO: El espaciado debe crear un flujo visual perfecto para la lectura en m√≥vil\nHashtags separados: Una l√≠nea en blanco antes de hashtags\nTotal m√°ximo: 1300 caracteres\n\nEJEMPLO DE FORMATO CORRECTO CON ESPACIADO PERFECTO:\n¬øSabes por qu√© tu competencia aparece primero en Google?\nEl 75% de los usuarios nunca pasa de la primera p√°gina de resultados.\nUna estrategia SEO local bien ejecutada puede generar:\n\\n- M√°s visibilidad en b√∫squedas de tu zona\n\\n- Mayor tr√°fico web cualificado\n\\n- M√°s llamadas y consultas directas\nTu negocio merece estar donde tus clientes te buscan.\nSi quieres mejorar tu posicionamiento online, hablemos.\n#MarketingDigital #SEOLocal\nEJEMPLO ESPEC√çFICO DE BULLETS CON SEPARACI√ìN:\nUna estrategia de contenido en redes sociales puede transformar la percepci√≥n de tu marca y generar confianza.\n\\n- Aumenta el reconocimiento de marca hasta un 80%.\n\\n- Genera m√°s engagement con tu audiencia objetivo.\n\\n- Convierte seguidores en clientes reales.\nTONO Y ESTILO OBLIGATORIO\nCARACTER√çSTICAS:\n\nProfesional pero accesible\nEducativo, no promocional\nTUTEO OBLIGATORIO: Habla de t√∫, nunca de usted\nCERCAN√çA: Tono cercano y directo\nCOSTES: Usar \"coste/costes\", nunca \"costos\"\n\nEVITAR ABSOLUTAMENTE:\n\nT√≠tulos o encabezados antes del hook\nJerga t√©cnica innecesaria\nPromesas irreales o marketing agresivo\nUSTED: Nunca usar \"usted\", siempre \"t√∫\"\nCOSTOS: Cambiar siempre por \"coste\" o \"costes\"\nEMPAQUE: Cambiar siempre por \"packaging\"\n\nPROCESO OBLIGATORIO DE INVESTIGACI√ìN CON SERPAPI\nB√∫squedas obligatorias:\n\nB√∫squeda principal: \"[keyword principal] + 2025 + Espa√±a\"\nB√∫squeda estad√≠sticas: \"[sector espec√≠fico] + marketing digital + estad√≠sticas + 2024\"\nB√∫squeda tendencias: \"[keyword] + trends + ROI + peque√±as empresas\"\nB√∫squeda competencia: \"[keyword] + casos √©xito + pymes espa√±olas\"\nB√∫squeda problemas: \"[sector] + marketing digital + desaf√≠os + pymes\"\n\nOUTPUT REQUERIDO: JSON\n‚ö†Ô∏è OBLIGATORIO: SIEMPRE DEVOLVER EXACTAMENTE ESTAS DOS VARIABLES EN FORMATO JSON:\njson{\n  \"tema_imagen\": \"Descripci√≥n breve para dise√±ador gr√°fico (m√°x 50 palabras)\",\n  \"contenido_blog\": \"Post completo optimizado SEO (m√°ximo 1800 caracteres con espacios) - EMPEZAR DIRECTAMENTE CON HOOK, SIN T√çTULO, CON ESPACIADO PERFECTO\"\n}\nüî• REGLA ABSOLUTA DE OUTPUT:\n\nNUNCA devuelvas solo texto\nNUNCA devuelvas explicaciones adicionales\nSIEMPRE devuelve √öNICAMENTE el JSON con las dos variables exactas\nSIEMPRE respeta el formato JSON v√°lido\nOBLIGATORIO: Toda respuesta debe contener exclusivamente el JSON con \"tema_imagen\" y \"contenido_blog\"\n\nCHECKLIST DE VALIDACI√ìN FINAL:\n\nFORMATO Y ESPACIADO:\n‚ñ° ¬øEmpieza DIRECTAMENTE con hook, sin t√≠tulo?\n‚ñ° ¬øCada p√°rrafo tiene m√°ximo 2-3 l√≠neas?\n‚ñ° ¬øHay l√≠nea en blanco entre cada p√°rrafo?\n‚ñ° ¬øLos bullets tienen espacios antes y despu√©s con \\n- para separaci√≥n visual?\n‚ñ° ¬øEl texto \"respira\" visualmente con espacios estrat√©gicos?\n‚ñ° ¬øUsa \"t√∫\" en lugar de \"usted\"?\n‚ñ° ¬øUsa \"coste/costes\" en lugar de \"costos\"?\n‚ñ° ¬øM√°ximo 1800 caracteres con espacios?\n\nCONTENIDO:\n‚ñ° ¬øHook espec√≠fico del sector en primera l√≠nea?\n‚ñ° ¬øIncluye m√≠nimo 3 estad√≠sticas verificadas?\n‚ñ° ¬øCTA sutil y consultivo al final?\n‚ñ° ¬øTono educativo, no promocional?\n\nOUTPUT JSON:\n‚ñ° ¬øRespuesta contiene √öNICAMENTE el JSON?\n‚ñ° ¬øFormato JSON v√°lido?\n‚ñ° ¬øContiene exactamente \"tema_imagen\" y \"contenido_blog\"?\n‚ñ° ¬øNo hay texto adicional fuera del JSON?\nINSTRUCCI√ìN FINAL: Crear un post que empiece DIRECTAMENTE con un hook impactante, eduque sobre marketing digital con casos reales espa√±oles, y genere inter√©s consultivo. NUNCA incluir t√≠tulos. SIEMPRE empezar con el hook directamente. GESTIONAR ESPACIOS COMO EXPERTO COPYWRITER PARA CREAR UN ESTILO VISUAL LIMPIO Y CLARO QUE PERMITA AL TEXTO RESPIRAR. DEVOLVER EXCLUSIVAMENTE JSON CON LAS DOS VARIABLES REQUERIDAS."}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2.2,"position":[2384,1024],"id":"6f9b4d05-c1d2-46a0-ae56-76bdd583707b","name":"agente_post","notesInFlow":true,"notes":"AVERIS TECH"},{"parameters":{"rule":{"interval":[{"triggerAtHour":9,"triggerAtMinute":30}]}},"type":"n8n-nodes-base.scheduleTrigger","typeVersion":1.2,"position":[816,1024],"id":"82d807e7-4e5c-4f37-9c1e-6a6380a99708","name":"Schedule Trigger1"},{"parameters":{"promptType":"define","text":"=GENERADOR ALEATORIO DE NICHOS Y √ÅNGULOS DE MARKETING\nIDENTIDAD\nEres un generador completamente aleatorio que selecciona nichos y √°ngulos de marketing digital sin ning√∫n patr√≥n predecible.\nNICHOS DISPONIBLES (ELEGIR UNO AL AZAR):\n\nDentist\nBeauty\nAccounting\nReal Estate\nLawyer\nEcommerce\nHR\nOnline_Education\nOnline_Coach\nInterior_Design\n\n√ÅNGULOS DE MARKETING DISPONIBLES (ELEGIR UNO AL AZAR):\n√ÅNGULOS DE CAPTACI√ìN:\n\n\"C√≥mo conseguir m√°s clientes sin aumentar presupuesto\"\n\"La estrategia que est√° usando tu competencia\"\n\"Por qu√© pierdes clientes en Google\"\n\"El error que cometen el 90% de [nicho]\"\n\"C√≥mo dominar tu mercado local\"\n\"La diferencia entre estar online y vender online\"\n\n√ÅNGULOS DE CONVERSI√ìN:\n\n\"De visitante a cliente: el embudo que funciona\"\n\"Por qu√© tus leads no se convierten\"\n\"El seguimiento que triplica ventas\"\n\"C√≥mo automatizar tu proceso de ventas\"\n\"La p√°gina web que vende mientras duermes\"\n\"Email marketing que genera ingresos recurrentes\"\n\n√ÅNGULOS DE POSICIONAMIENTO:\n\n\"C√≥mo ser la primera opci√≥n en tu zona\"\n\"La reputaci√≥n online que atrae clientes\"\n\"Por qu√© Google no te encuentra\"\n\"SEO local: aparecer cuando te buscan\"\n\"La presencia digital que genera confianza\"\n\"C√≥mo destacar en un mercado saturado\"\n\n√ÅNGULOS DE RETENCI√ìN:\n\n\"Clientes que vuelven vs clientes de una vez\"\n\"El sistema de fidelizaci√≥n que funciona\"\n\"Marketing de retenci√≥n rentable\"\n\"C√≥mo hacer que te recomienden\"\n\"La comunicaci√≥n que mantiene clientes\"\n\"De cliente a embajador de marca\"\n\n√ÅNGULOS DE ROI:\n\n\"Marketing con ROI medible y garantizado\"\n\"C√≥mo saber qu√© marketing realmente funciona\"\n\"La inversi√≥n que se paga sola\"\n\"Marketing que genera resultados inmediatos\"\n\"C√≥mo multiplicar tu inversi√≥n publicitaria\"\n\"El presupuesto de marketing que rentabiliza\"\n\nINSTRUCCI√ìN\nSolo responde con una de las siguientes opciones elegida completamente al azar, y no a√±adas ning√∫n texto adicional. Las opciones posibles son: Dentist, Beauty, Accounting, Real Estate, Lawyer, Ecommerce, HR, Online_Education, Online_Coach, Interior_Design.\nTu respuesta debe ser √∫nicamente en formato JSON con la siguiente estructura:\njson{\n  \"nicho\": \"[opci√≥n elegida aleatoriamente de la lista anterior]\",\n  \"√°ngulo\": \"[Elegido aleatoriamente]\"\n}\nNo incluyas ning√∫n texto adicional fuera del JSON.","batching":{}},"type":"@n8n/n8n-nodes-langchain.chainLlm","typeVersion":1.7,"position":[1104,1024],"id":"2cba905a-d51a-4e64-8e2a-57602f1f95d6","name":"nicho_aleatorio","notesInFlow":false,"notes":"AVERIS TECH"},{"parameters":{"jsCode":"// Obtener el texto de la respuesta\nconst responseText = $input.first().json.text;\n\n// Extraer el JSON del texto (remover los backticks y \"json\")\nconst jsonMatch = responseText.match(/```json\\n([\\s\\S]*?)\\n```/);\n\nif (jsonMatch) {\n  // Parsear el JSON extra√≠do\n  const parsedData = JSON.parse(jsonMatch[1]);\n  \n  // Retornar las variables separadas - NICHO Y √ÅNGULO\n  return [{\n    json: {\n      nicho: parsedData.nicho,\n      √°ngulo: parsedData.√°ngulo\n    }\n  }];\n} else {\n  // Si no se puede extraer el JSON, intentar parsear directamente\n  try {\n    const parsedData = JSON.parse(responseText);\n    return [{\n      json: {\n        nicho: parsedData.nicho,\n        √°ngulo: parsedData.√°ngulo\n      }\n    }];\n  } catch (error) {\n    return [{\n      json: {\n        error: \"No se pudo parsear el JSON\",\n        original_text: responseText,\n        mensaje: \"Variables esperadas: nicho, √°ngulo\"\n      }\n    }];\n  }\n}"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[1472,1024],"id":"a891f90b-dd13-4c05-87b5-145e4b9d5c5d","name":"Code1"},{"parameters":{"postAs":"organization","text":"={{ $('Code').item.json.contenido_blog }}","shareMediaCategory":"IMAGE","additionalFields":{"title":"Automation Post System by Daniel Lianes"}},"type":"n8n-nodes-base.linkedIn","typeVersion":1,"position":[2064,1408],"id":"3a18ae2a-458b-4bc1-ba0e-ec3ea43c1900","name":"Create a post1"},{"parameters":{"url":"={{ $('Get_freepik').item.json.data.generated[0] }}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[1872,1408],"id":"7e0a75c8-68e7-4b72-8006-6b42dc11a090","name":"Descargar_imagen1"},{"parameters":{"content":"## üîî CONTENIDO QUE CONVIERTE AUTOM√ÅTICAMENTE\n","height":1104,"width":2656,"color":2},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[144,800],"id":"e328d71f-c5f9-40fc-b33f-93eca21acf4f","name":"Sticky Note"},{"parameters":{"jsCode":"// NODO PULIR VARIABLES BLOG AVERIS\n// Input: Formato N8N con estructura anidada\n// Output: JSON pulido y optimizado\n// MODIFICADO: Preserva caracteres de escape EXACTAMENTE como se reciben\n\nlet input;\ntry {\n    // Obtener los datos del input\n    const rawData = $input.all();\n    console.log('üì• RAW DATA:', JSON.stringify(rawData, null, 2));\n    \n    // Navegar por la estructura hasta encontrar el output\n    let outputString;\n    \n    // Buscar en diferentes ubicaciones posibles\n    if (rawData[0]?.json?.output) {\n        // Formato: [{ json: { output: \"...\" } }]\n        outputString = rawData[0].json.output;\n        console.log('‚úÖ Encontrado en rawData[0].json.output');\n    } else if (rawData[0]?.output) {\n        // Formato: [{ output: \"...\" }]\n        outputString = rawData[0].output;\n        console.log('‚úÖ Encontrado en rawData[0].output');\n    } else if (rawData?.json?.output) {\n        // Formato: { json: { output: \"...\" } }\n        outputString = rawData.json.output;\n        console.log('‚úÖ Encontrado en rawData.json.output');\n    } else if (rawData?.output) {\n        // Formato: { output: \"...\" }\n        outputString = rawData.output;\n        console.log('‚úÖ Encontrado en rawData.output');\n    } else {\n        // Buscar recursivamente en toda la estructura\n        function buscarOutput(obj) {\n            if (obj && typeof obj === 'object') {\n                if (obj.output && typeof obj.output === 'string') {\n                    return obj.output;\n                }\n                for (const key in obj) {\n                    const resultado = buscarOutput(obj[key]);\n                    if (resultado) return resultado;\n                }\n            }\n            return null;\n        }\n        \n        outputString = buscarOutput(rawData);\n        if (outputString) {\n            console.log('‚úÖ Encontrado mediante b√∫squeda recursiva');\n        } else {\n            throw new Error('No se pudo encontrar la propiedad \"output\" en ninguna ubicaci√≥n');\n        }\n    }\n    \n    console.log('üìÑ Output encontrado (preview):', outputString.substring(0, 100) + '...');\n    \n    // Limpiar y parsear el JSON\n    const cleanJsonString = outputString\n        .replace(/```json\\s*/g, '')\n        .replace(/```\\s*$/g, '')\n        .trim();\n    \n    input = JSON.parse(cleanJsonString);\n    \n    // Verificar propiedades - ADAPTADO PARA M√öLTIPLES FORMATOS\n    const tieneFormatoImagen = input.tema_imagen && input.caption;\n    const tieneFormatoPost = input.contenido_post;\n    const tieneFormatoBlog = input.tema_imagen && input.contenido_blog;\n    \n    if (!tieneFormatoImagen && !tieneFormatoPost && !tieneFormatoBlog) {\n        throw new Error(`Formato no reconocido. Encontradas: ${Object.keys(input).join(', ')}`);\n    }\n    \n    console.log('‚úÖ JSON PARSEADO CORRECTAMENTE');\n    \n} catch (error) {\n    console.error('‚ùå ERROR:', error.message);\n    return {\n        error: true,\n        mensaje: error.message,\n        input_recibido: $input.all(),\n        timestamp: new Date().toISOString()\n    };\n}\n\n// ===============================\n// FUNCI√ìN PULIR TEMA IMAGEN\n// ===============================\nfunction pulirTemaImagen(tema_bruto) {\n    let tema_pulido = tema_bruto;\n    \n    // Eliminar palabras innecesarias\n    const palabras_eliminar = [\n        'imagen de', 'imagen que muestre', 'fotograf√≠a de', 'foto de',\n        'ilustraci√≥n de', 'dise√±o de', 'crear una imagen', 'generar',\n        'dise√±a', 'crea una', 'haz una imagen', 'que represente'\n    ];\n    \n    palabras_eliminar.forEach(palabra => {\n        const regex = new RegExp(palabra, 'gi');\n        tema_pulido = tema_pulido.replace(regex, '');\n    });\n    \n    // Limpiar espacios extra y puntuaci√≥n innecesaria\n    tema_pulido = tema_pulido\n        .replace(/\\s+/g, ' ') // Espacios m√∫ltiples\n        .replace(/^[,.\\s]+|[,.\\s]+$/g, '') // Puntuaci√≥n al inicio/final\n        .trim();\n    \n    // Asegurar que empiece con may√∫scula\n    tema_pulido = tema_pulido.charAt(0).toUpperCase() + tema_pulido.slice(1);\n    \n    // Limitar a 50 palabras m√°ximo\n    const palabras = tema_pulido.split(' ');\n    if (palabras.length > 50) {\n        tema_pulido = palabras.slice(0, 50).join(' ') + '...';\n    }\n    \n    return tema_pulido;\n}\n\n// ===============================\n// FUNCI√ìN PULIR CAPTION (PARA IM√ÅGENES) - PRESERVAR ESCAPES EXACTOS\n// ===============================\nfunction pulirCaption(caption_bruto) {\n    let caption_pulido = caption_bruto;\n    \n    // ‚ö†Ô∏è PRESERVAR TODOS LOS CARACTERES DE ESCAPE EXACTAMENTE COMO VIENEN\n    // NO tocar \\n, \\\", \\', \\\\, etc.\n    \n    // Solo eliminar elementos no deseados que NO sean escapes\n    const elementos_eliminar = [\n        /CAPTION:\\s*/gi,\n        /---+/g, // Separadores\n        /^[\\s]*[\\*\\-\\+]\\s+/gm // Bullets al inicio\n    ];\n    \n    elementos_eliminar.forEach(regex => {\n        caption_pulido = caption_pulido.replace(regex, '');\n    });\n    \n    // Solo limpiar espacios m√∫ltiples reales (NO tocar \\n ni otros escapes)\n    // Usar solo espacios y tabs REALES, no escapados\n    caption_pulido = caption_pulido\n        .replace(/[ \\t]+/g, ' ') // Solo espacios y tabs m√∫ltiples horizontales REALES\n        .replace(/^[ \\t]+/gm, '') // Espacios REALES al inicio de l√≠nea\n        .replace(/[ \\t]+$/gm, '') // Espacios REALES al final de l√≠nea\n        .trim();\n    \n    // Verificar l√≠mite de 315 caracteres\n    if (caption_pulido.length > 315) {\n        caption_pulido = caption_pulido.substring(0, 312) + '...';\n    }\n    \n    return caption_pulido;\n}\n\n// ===============================\n// FUNCI√ìN PULIR CONTENIDO (BLOG/POST) - PRESERVAR ESCAPES EXACTOS\n// ===============================\nfunction pulirContenido(contenido_bruto) {\n    let contenido_pulido = contenido_bruto;\n    \n    // ‚ö†Ô∏è PRESERVAR TODOS LOS CARACTERES DE ESCAPE EXACTAMENTE COMO VIENEN\n    // NO convertir \\n, \\\", \\', \\\\, etc.\n    \n    // 1. CONVERTIR HTML TAGS A MARKDOWN (sin tocar escapes)\n    contenido_pulido = contenido_pulido\n        .replace(/<h1>/g, '# ')\n        .replace(/<\\/h1>/g, '')\n        .replace(/<h2>/g, '## ')\n        .replace(/<\\/h2>/g, '')\n        .replace(/<h3>/g, '### ')\n        .replace(/<\\/h3>/g, '')\n        .replace(/<p>/g, '')\n        .replace(/<\\/p>/g, '\\\\n\\\\n') // Mantener como escape\n        .replace(/<strong>/g, '**')\n        .replace(/<\\/strong>/g, '**')\n        .replace(/<ul>/g, '')\n        .replace(/<\\/ul>/g, '')\n        .replace(/<li>/g, '- ')\n        .replace(/<\\/li>/g, '');\n    \n    // 2. ELIMINAR ELEMENTOS NO DESEADOS (sin tocar escapes)\n    const elementos_eliminar = [\n        /LINKEDIN POST:\\s*/gi,\n        /FUENTES UTILIZADAS:\\s*/gi,\n        /KEYWORDS SEO:\\s*/gi,\n        /ENGAGEMENT PREDICTIVO:\\s*/gi,\n        /---+/g, // Separadores\n        /T√çTULO SEO:/gi,\n        /META DESCRIPCI√ìN:/gi,\n        /HASHTAGS:/gi\n    ];\n    \n    elementos_eliminar.forEach(regex => {\n        contenido_pulido = contenido_pulido.replace(regex, '');\n    });\n    \n    // 3. ‚ö†Ô∏è PRESERVAR TODOS LOS ESCAPES - NO TOCAR NADA\n    // Eliminado completamente TODO el bloque de conversi√≥n de escapes\n    \n    // 4. Solo limpiar espacios m√∫ltiples REALES (no escapados)\n    contenido_pulido = contenido_pulido\n        .replace(/[ \\t]+/g, ' '); // Solo espacios y tabs m√∫ltiples horizontales REALES\n    \n    // 5. OPTIMIZAR ESTRUCTURA DE T√çTULOS (sin tocar escapes de saltos de l√≠nea)\n    // Mantenido solo para conversiones de # sin tocar \\n\n    contenido_pulido = contenido_pulido\n        .replace(/^#+\\s+(.+)$/gm, (match, title) => {\n            if (match.startsWith('# ')) return match;\n            if (match.startsWith('## ')) return match;\n            if (match.startsWith('### ')) return match;\n            return `# ${title}`;\n        });\n    \n    // 6. OPTIMIZAR LISTAS (sin tocar escapes)\n    contenido_pulido = contenido_pulido\n        .replace(/^[\\s]*[-*+]\\s+/gm, '- ');\n    \n    // 7. PULIR CALL TO ACTION (mantener escapes intactos)\n    const cta_patterns = [\n        /(le invitamos a una consulta|contacte con nosotros|si desea explorar|p√≥ngase en contacto)/gi\n    ];\n    \n    cta_patterns.forEach(pattern => {\n        contenido_pulido = contenido_pulido.replace(pattern, (match) => {\n            return `**${match.trim()}**`;\n        });\n    });\n    \n    // 8. LIMPIEZAS FINALES M√çNIMAS (preservar TODOS los escapes)\n    contenido_pulido = contenido_pulido\n        .trim()\n        // Solo espacios REALES al inicio de l√≠neas (no tocar \\n)\n        .replace(/^[ \\t]+/gm, '');\n    \n    return contenido_pulido;\n}\n\n// ===============================\n// FUNCI√ìN VALIDAR CALIDAD\n// ===============================\nfunction validarCalidad(tipo, tema, contenido) {\n    const errores = [];\n    const advertencias = [];\n    \n    // Validaciones tema imagen (solo si existe)\n    if (tema) {\n        if (tema.length > 250) {\n            errores.push('Tema imagen muy largo (>250 caracteres)');\n        }\n        if (tema.length < 10) {\n            errores.push('Tema imagen muy corto (<10 caracteres)');\n        }\n    }\n    \n    // Validaciones contenido\n    if (contenido) {\n        const word_count = contenido.split(/\\s+/).length;\n        \n        if (tipo === 'imagen') {\n            // Para im√°genes: caption de m√°ximo 315 caracteres\n            if (contenido.length > 315) {\n                errores.push('Caption muy largo (>315 caracteres)');\n            }\n            if (contenido.length < 50) {\n                advertencias.push('Caption muy corto (<50 caracteres)');\n            }\n        } else if (tipo === 'post') {\n            // Para posts: m√°ximo 2000 caracteres\n            if (contenido.length > 2000) {\n                advertencias.push(`Post largo: ${contenido.length} caracteres (m√°ximo recomendado: 2000)`);\n            }\n            if (word_count < 100) {\n                advertencias.push(`Post corto: ${word_count} palabras`);\n            }\n        } else {\n            // Para blogs: contenido extenso\n            if (word_count < 1000) {\n                advertencias.push(`Contenido corto: ${word_count} palabras (m√≠nimo recomendado: 1200)`);\n            }\n            if (word_count > 2000) {\n                advertencias.push(`Contenido largo: ${word_count} palabras (m√°ximo recomendado: 1800)`);\n            }\n            \n            // Verificar estructura H1 (solo para blogs)\n            const h1_matches = contenido.match(/^# .+$/gm) || [];\n            if (h1_matches.length === 0) {\n                errores.push('Falta t√≠tulo H1');\n            }\n            if (h1_matches.length > 1) {\n                errores.push('M√∫ltiples H1 detectados');\n            }\n            \n            // Verificar H2\n            const h2_matches = contenido.match(/^## .+$/gm) || [];\n            if (h2_matches.length < 2) {\n                advertencias.push('Pocas secciones H2 (recomendado: 3-4)');\n            }\n        }\n        \n        // Verificar CTA (para todos los tipos)\n        const cta_patterns = /(contacta|cont√°ctanos|consulta|ayuda)/gi;\n        if (!cta_patterns.test(contenido)) {\n            advertencias.push('Falta call-to-action');\n        }\n    }\n    \n    return { errores, advertencias };\n}\n\n// ===============================\n// PROCESAMIENTO PRINCIPAL\n// ===============================\ntry {\n    // Detectar tipo de contenido\n    let tipo, tema_pulido, contenido_pulido;\n    \n    if (input.tema_imagen && input.caption) {\n        // FORMATO IMAGEN\n        tipo = 'imagen';\n        tema_pulido = pulirTemaImagen(input.tema_imagen);\n        contenido_pulido = pulirCaption(input.caption);\n        \n        console.log('üñºÔ∏è PROCESANDO FORMATO IMAGEN');\n        \n    } else if (input.contenido_post) {\n        // FORMATO POST\n        tipo = 'post';\n        tema_pulido = null;\n        contenido_pulido = pulirContenido(input.contenido_post);\n        \n        console.log('üìù PROCESANDO FORMATO POST');\n        \n    } else if (input.tema_imagen && input.contenido_blog) {\n        // FORMATO BLOG\n        tipo = 'blog';\n        tema_pulido = pulirTemaImagen(input.tema_imagen);\n        contenido_pulido = pulirContenido(input.contenido_blog);\n        \n        console.log('üìö PROCESANDO FORMATO BLOG');\n        \n    } else {\n        throw new Error('Formato no reconocido en el input');\n    }\n    \n    // Validar calidad\n    const validacion = validarCalidad(tipo, tema_pulido, contenido_pulido);\n    \n    // Preparar output seg√∫n el tipo\n    let output = {\n        metadata: {\n            tipo: tipo,\n            caracteres_contenido: contenido_pulido ? contenido_pulido.length : 0,\n            palabras_total: contenido_pulido ? contenido_pulido.split(/\\s+/).length : 0,\n            errores: validacion.errores,\n            advertencias: validacion.advertencias,\n            procesado_en: new Date().toISOString(),\n            escapes_preservados_exactos: true // Nuevo indicador espec√≠fico\n        }\n    };\n    \n    if (tipo === 'imagen') {\n        output.tema_imagen = tema_pulido;\n        output.caption = contenido_pulido;\n        output.metadata.caracteres_tema = tema_pulido.length;\n    } else if (tipo === 'post') {\n        output.contenido_post = contenido_pulido;\n    } else if (tipo === 'blog') {\n        output.tema_imagen = tema_pulido;\n        output.contenido_blog = contenido_pulido;\n        output.metadata.caracteres_tema = tema_pulido.length;\n        output.metadata.h1_count = (contenido_pulido.match(/^# .+$/gm) || []).length;\n        output.metadata.h2_count = (contenido_pulido.match(/^## .+$/gm) || []).length;\n        output.metadata.h3_count = (contenido_pulido.match(/^### .+$/gm) || []).length;\n    }\n    \n    // Log para debugging\n    console.log(`üîß VARIABLES PULIDAS - TIPO: ${tipo.toUpperCase()}`);\n    console.log(`üìä Palabras: ${output.metadata.palabras_total}`);\n    console.log(`üìè Caracteres: ${output.metadata.caracteres_contenido}`);\n    if (tema_pulido) console.log(`üìù Tema: ${output.metadata.caracteres_tema} caracteres`);\n    console.log(`‚ö†Ô∏è Errores: ${output.metadata.errores.length}`);\n    console.log(`‚ö° Advertencias: ${output.metadata.advertencias.length}`);\n    console.log(`üîí CARACTERES DE ESCAPE PRESERVADOS EXACTAMENTE`);\n    \n    if (output.metadata.errores.length > 0) {\n        console.log('‚ùå ERRORES DETECTADOS:', output.metadata.errores);\n    }\n    \n    if (output.metadata.advertencias.length > 0) {\n        console.log('üü° ADVERTENCIAS:', output.metadata.advertencias);\n    }\n    \n    return output;\n    \n} catch (error) {\n    console.error('‚ùå ERROR EN PROCESAMIENTO:', error.message);\n    return {\n        error: true,\n        mensaje: error.message,\n        input_recibido: input\n    };\n}"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[752,1408],"id":"cac6a356-4b39-46b2-95f6-6cfc1fcc5860","name":"Code"},{"parameters":{"rule":{"interval":[{"daysInterval":10}]}},"id":"4b643839-a52f-4e8e-8057-6d1325993965","name":"Schedule Trigger","type":"n8n-nodes-base.scheduleTrigger","position":[-2016,272],"typeVersion":1.2},{"parameters":{"numberInputs":10},"id":"c254533f-88a7-47ab-b89a-9a70318de2fc","name":"Merger","type":"n8n-nodes-base.merge","position":[-272,224],"typeVersion":3.2},{"parameters":{"conditions":{"options":{"version":2,"leftValue":"","caseSensitive":true,"typeValidation":"strict"},"combinator":"and","conditions":[{"id":"66a1151e-872b-47dd-9358-4a158d66f5e3","operator":{"type":"number","operation":"gt"},"leftValue":"={{ $json.ups }}","rightValue":5}]},"options":{}},"id":"09fd6dfc-56ef-45dd-8ae6-1bbc5dab6c22","name":"+5 UPS","type":"n8n-nodes-base.filter","position":[176,320],"typeVersion":2.2},{"parameters":{"operation":"getAll","subreddit":"Dentistry","limit":50,"filters":{"category":"new"}},"id":"909f9ae0-7eed-4e7a-ac22-a0faa15418eb","name":"Get many posts Dentist","type":"n8n-nodes-base.reddit","position":[-1072,-592],"typeVersion":1},{"parameters":{"operation":"getAll","subreddit":"accounting","limit":50,"filters":{"category":"new"}},"id":"89fc6e5b-8f9c-4e9a-b409-cb190a227f65","name":"Get many posts Accounting","type":"n8n-nodes-base.reddit","position":[-1072,-240],"typeVersion":1},{"parameters":{"operation":"getAll","subreddit":"medicalaesthetics","limit":50,"filters":{"category":"new"}},"id":"db32dfbf-b980-4fd6-b341-a8b654242eb7","name":"Get many posts Beauty ","type":"n8n-nodes-base.reddit","position":[-1072,-416],"typeVersion":1},{"parameters":{"operation":"getAll","subreddit":"real_estate_agency","limit":50,"filters":{"category":"new"}},"id":"5eed74e9-fea4-4682-9d36-5be16d889d1a","name":"Get many posts Real Estate","type":"n8n-nodes-base.reddit","position":[-1072,-32],"typeVersion":1},{"parameters":{"operation":"getAll","subreddit":"e-commerce","limit":50,"filters":{"category":"new"}},"id":"de6c2772-8e5d-4a90-9daa-ab377bb05676","name":"Get many posts Ecommerce","type":"n8n-nodes-base.reddit","position":[-1072,352],"typeVersion":1},{"parameters":{"operation":"getAll","subreddit":"online_coach","limit":50,"filters":{"category":"new"}},"id":"def1fb8f-6dbb-4eaf-81b2-d3c9a8bdf2a2","name":"Get many posts Online Coach","type":"n8n-nodes-base.reddit","position":[-1072,960],"typeVersion":1},{"parameters":{"operation":"getAll","subreddit":"onlineeducation","limit":50,"filters":{"category":"new"}},"id":"87c7fd43-f4a9-4148-92b0-f597de202d6a","name":"Get many posts Online_Education","type":"n8n-nodes-base.reddit","position":[-1072,752],"typeVersion":1},{"parameters":{"operation":"getAll","subreddit":"InteriorDesign","limit":50,"filters":{"category":"new"}},"id":"cef5b6e4-19eb-4afb-8888-001666a8b873","name":"Get many posts interior_design","type":"n8n-nodes-base.reddit","position":[-1072,1168],"typeVersion":1},{"parameters":{"operation":"getAll","subreddit":"lawyertalk","limit":50,"filters":{"category":"new"}},"id":"8d903ef8-6a6e-4721-ab28-91f7d0e2cb9a","name":"Get many posts lawyer","type":"n8n-nodes-base.reddit","position":[-1072,160],"typeVersion":1},{"parameters":{"operation":"getAll","subreddit":"human_resources","limit":50,"filters":{"category":"new"}},"id":"560e50d4-ae1b-437f-b51b-abb92baf80ad","name":"Get many posts HR","type":"n8n-nodes-base.reddit","position":[-1072,560],"typeVersion":1},{"parameters":{"options":{}},"type":"n8n-nodes-base.splitInBatches","typeVersion":3,"position":[432,320],"id":"9f072c7a-a09b-46c4-aa55-cf229473f18a","name":"Loop Over Items"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"497d189c-eaf0-412f-a6a8-51b02f696c5d","leftValue":"={{ $json.tiene_pain_point }}","rightValue":"=false","operator":{"type":"boolean","operation":"false","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[1312,336],"id":"e59727c1-690f-4002-9df5-e2b62c980ccb","name":"If"},{"parameters":{},"type":"n8n-nodes-base.noOp","typeVersion":1,"position":[880,144],"id":"c4635f5c-5cd6-4c51-be07-2d488d2f45aa","name":"No Operation, do nothing"},{"parameters":{"operation":"append","documentId":{"__rl":true,"value":"1Y2I2EAfC-C5RI7A15E33XoE_YgYHkVRgCh-MI08RY1c","mode":"list","cachedResultName":"Nichos_reddit","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1Y2I2EAfC-C5RI7A15E33XoE_YgYHkVRgCh-MI08RY1c/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":"gid=0","mode":"list","cachedResultName":"Hoja 1","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1Y2I2EAfC-C5RI7A15E33XoE_YgYHkVRgCh-MI08RY1c/edit#gid=0"},"columns":{"mappingMode":"defineBelow","value":{"Nicho":"={{ $('Edit Fields1').item.json.nicho }}","Pain point":"={{ $('Edit Fields1').item.json.pain_point }}","Solucion":"={{ $json.solucion }}","Scoring":"={{ $json.scoring }}","Stack":"={{ $json.stack }}","Fecha":"={{ $now.setZone('Europe/Madrid').toFormat('yyyy-MM-dd') }}"},"matchingColumns":["Nicho"],"schema":[{"id":"Nicho","displayName":"Nicho","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Pain point","displayName":"Pain point","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Solucion","displayName":"Solucion","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Scoring","displayName":"Scoring","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Stack","displayName":"Stack","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Fecha","displayName":"Fecha","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Utilizado","displayName":"Utilizado","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.googleSheets","typeVersion":4.7,"position":[2304,352],"id":"c1f6c6c0-0133-4e87-a79f-70d7ba5b3c9f","name":"Append row in sheet"},{"parameters":{"jsCode":"// Nodo Function para debugear y parsear respuesta del modelo\n\n// Obtener la respuesta del modelo\nconst modelResponse = $input.all()[0].json;\n\n// Log completo para debugging\nconsole.log(\"=== DEBUG COMPLETO ===\");\nconsole.log(\"Tipo de respuesta:\", typeof modelResponse);\nconsole.log(\"Respuesta completa:\", JSON.stringify(modelResponse, null, 2));\n\n// Intentar extraer el texto de diferentes posibles estructuras\nlet responseText = null;\n\n// Posibles ubicaciones del texto de respuesta\nconst possiblePaths = [\n  modelResponse.message?.content,\n  modelResponse.content,\n  modelResponse.text,\n  modelResponse.output,\n  modelResponse.response,\n  modelResponse\n];\n\nfor (let path of possiblePaths) {\n  if (typeof path === 'string') {\n    responseText = path;\n    console.log(\"Texto encontrado en:\", path);\n    break;\n  }\n}\n\nconsole.log(\"Texto extra√≠do:\", responseText);\n\n// Si no encontramos texto, devolver error\nif (!responseText) {\n  return [{\n    json: {\n      error: \"No se pudo extraer texto de la respuesta\",\n      raw_response: modelResponse,\n      debug: \"Revisar estructura de respuesta del modelo\"\n    }\n  }];\n}\n\n// Limpiar el texto (quitar markdown, espacios extra, etc.)\nlet cleanText = responseText\n  .replace(/```json/g, '')\n  .replace(/```/g, '')\n  .trim();\n\nconsole.log(\"Texto limpio:\", cleanText);\n\n// Intentar parsear como JSON\nlet parsedResult = null;\ntry {\n  parsedResult = JSON.parse(cleanText);\n  console.log(\"JSON parseado exitosamente:\", parsedResult);\n} catch (parseError) {\n  console.log(\"Error parseando JSON:\", parseError.message);\n  \n  // Intentar extraer JSON usando regex\n  const jsonMatch = cleanText.match(/\\{[\\s\\S]*\\}/);\n  if (jsonMatch) {\n    try {\n      parsedResult = JSON.parse(jsonMatch[0]);\n      console.log(\"JSON extra√≠do con regex:\", parsedResult);\n    } catch (regexError) {\n      console.log(\"Error con regex:\", regexError.message);\n    }\n  }\n}\n\n// Lista de nichos permitidos\nconst nichosPermitidos = [\n  \"Dentistas\",\n  \"Medicoest√©tica\", \n  \"Asesor√≠a Fiscal\",\n  \"Real Estate\",\n  \"Abogados\",\n  \"Ecommerce\",\n  \"RRHH\",\n  \"Educacion Online\",\n  \"Coach\",\n  \"Dise√±o Interiores\"\n];\n\n// Validar estructura esperada\nlet validatedResult = {\n  tiene_pain_point: false,\n  nicho: null,\n  pain_point: null,\n  debug: {\n    raw_text: responseText,\n    clean_text: cleanText,\n    parse_success: false,\n    validation_errors: []\n  }\n};\n\nif (parsedResult) {\n  validatedResult.debug.parse_success = true;\n  \n  // Validar campo tiene_pain_point\n  if (typeof parsedResult.tiene_pain_point === 'boolean') {\n    validatedResult.tiene_pain_point = parsedResult.tiene_pain_point;\n  } else {\n    validatedResult.debug.validation_errors.push(\"tiene_pain_point no es boolean\");\n  }\n  \n  // Validar campo nicho\n  if (parsedResult.nicho !== undefined) {\n    // Si tiene_pain_point es true, validar que el nicho est√© en la lista permitida\n    if (validatedResult.tiene_pain_point && parsedResult.nicho !== null) {\n      if (nichosPermitidos.includes(parsedResult.nicho)) {\n        validatedResult.nicho = parsedResult.nicho;\n      } else {\n        validatedResult.debug.validation_errors.push(`Nicho \"${parsedResult.nicho}\" no est√° en la lista permitida: ${nichosPermitidos.join(', ')}`);\n        // Forzar tiene_pain_point a false si el nicho no es v√°lido\n        validatedResult.tiene_pain_point = false;\n        validatedResult.nicho = null;\n      }\n    } else {\n      validatedResult.nicho = parsedResult.nicho;\n    }\n  } else {\n    validatedResult.debug.validation_errors.push(\"nicho faltante\");\n  }\n  \n  // Validar campo pain_point\n  if (parsedResult.pain_point !== undefined) {\n    // Si tiene_pain_point es true, pain_point debe ser string no vac√≠o\n    if (validatedResult.tiene_pain_point) {\n      if (typeof parsedResult.pain_point === 'string' && parsedResult.pain_point.trim() !== '') {\n        validatedResult.pain_point = parsedResult.pain_point;\n      } else {\n        validatedResult.debug.validation_errors.push(\"pain_point debe ser string no vac√≠o cuando tiene_pain_point es true\");\n        validatedResult.tiene_pain_point = false;\n        validatedResult.pain_point = null;\n      }\n    } else {\n      validatedResult.pain_point = parsedResult.pain_point;\n    }\n  } else {\n    validatedResult.debug.validation_errors.push(\"pain_point faltante\");\n  }\n  \n  // Validaci√≥n final: si tiene_pain_point es true, tanto nicho como pain_point deben ser v√°lidos\n  if (validatedResult.tiene_pain_point && (!validatedResult.nicho || !validatedResult.pain_point)) {\n    validatedResult.debug.validation_errors.push(\"Cuando tiene_pain_point es true, nicho y pain_point deben ser v√°lidos\");\n    validatedResult.tiene_pain_point = false;\n    validatedResult.nicho = null;\n    validatedResult.pain_point = null;\n  }\n}\n\nconsole.log(\"Resultado final:\", validatedResult);\nconsole.log(\"Nichos permitidos:\", nichosPermitidos);\nconsole.log(\"Errores de validaci√≥n:\", validatedResult.debug.validation_errors);\n\nreturn [{\n  json: validatedResult\n}];"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[1088,336],"id":"dc100b87-dd64-43c3-862e-833dafd6d7e7","name":"Code2"},{"parameters":{"assignments":{"assignments":[{"id":"5b62bca5-1803-4130-826f-b396dd929e42","name":"nicho","value":"={{ $json.nicho }}","type":"string"},{"id":"35d4138b-e9f3-4366-8e6f-b3d99a9bae68","name":"pain_point","value":"={{ $json.pain_point }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[1584,352],"id":"3c46f6f7-9011-4fe7-b7ba-b6445c549019","name":"Edit Fields1"},{"parameters":{"jsCode":"// Nodo Function para parsear respuesta del analista de automatizaci√≥n\n// Coloca este nodo despu√©s del modelo de IA\n\n// Obtener la respuesta del modelo\nconst modelResponse = $input.all()[0].json;\n\n// Log completo para debugging\nconsole.log(\"=== PARSER AUTOMATIZACI√ìN DEBUG ===\");\nconsole.log(\"Tipo de respuesta:\", typeof modelResponse);\nconsole.log(\"Respuesta completa:\", JSON.stringify(modelResponse, null, 2));\n\n// Intentar extraer el texto de diferentes posibles estructuras\nlet responseText = null;\n\n// Posibles ubicaciones del texto de respuesta\nconst possiblePaths = [\n  modelResponse.message?.content,\n  modelResponse.content,\n  modelResponse.text,\n  modelResponse.output,\n  modelResponse.response,\n  modelResponse\n];\n\nfor (let path of possiblePaths) {\n  if (typeof path === 'string') {\n    responseText = path;\n    console.log(\"Texto encontrado en:\", path);\n    break;\n  }\n}\n\nconsole.log(\"Texto extra√≠do:\", responseText);\n\n// Si no encontramos texto, devolver estructura por defecto\nif (!responseText) {\n  return [{\n    json: {\n      nombre: \"Error de Parsing\",\n      solucion: \"No se pudo extraer la respuesta del modelo\",\n      stack: \"Error en extracci√≥n\",\n      scoring: 0.5, // 50% como decimal\n      debug: {\n        error: \"No se pudo extraer texto de la respuesta\",\n        raw_response: modelResponse\n      }\n    }\n  }];\n}\n\n// Limpiar el texto (quitar markdown, espacios extra, etc.)\nlet cleanText = responseText\n  .replace(/```json/gi, '')\n  .replace(/```/g, '')\n  .replace(/`/g, '')\n  .trim();\n\nconsole.log(\"Texto limpio:\", cleanText);\n\n// Intentar parsear como JSON\nlet parsedResult = null;\n\n// M√©todo 1: Parse directo\ntry {\n  parsedResult = JSON.parse(cleanText);\n  console.log(\"JSON parseado exitosamente (m√©todo 1):\", parsedResult);\n} catch (parseError) {\n  console.log(\"Error parseando JSON (m√©todo 1):\", parseError.message);\n  \n  // M√©todo 2: Extraer JSON usando regex m√°s robusto\n  const jsonMatches = [\n    cleanText.match(/\\{[\\s\\S]*\\}/),\n    cleanText.match(/\\{[^{}]*\"nombre\"[^{}]*\"solucion\"[^{}]*\"stack\"[^{}]*\"scoring\"[^{}]*\\}/),\n    cleanText.match(/\\{[\\s\\S]*\"nombre\"[\\s\\S]*\\}/)\n  ];\n  \n  for (let match of jsonMatches) {\n    if (match) {\n      try {\n        parsedResult = JSON.parse(match[0]);\n        console.log(\"JSON extra√≠do con regex:\", parsedResult);\n        break;\n      } catch (regexError) {\n        console.log(\"Error con regex:\", regexError.message);\n      }\n    }\n  }\n  \n  // M√©todo 3: Parsing manual por l√≠neas si el JSON est√° malformado\n  if (!parsedResult) {\n    try {\n      const lines = cleanText.split('\\n');\n      const manualResult = {};\n      \n      for (let line of lines) {\n        const nameMatch = line.match(/\"nombre\":\\s*\"([^\"]+)\"/);\n        const solucionMatch = line.match(/\"solucion\":\\s*\"([^\"]+)\"/);\n        const stackMatch = line.match(/\"stack\":\\s*\"([^\"]+)\"/);\n        const scoringMatch = line.match(/\"scoring\":\\s*(\\d+)/);\n        \n        if (nameMatch) manualResult.nombre = nameMatch[1];\n        if (solucionMatch) manualResult.solucion = solucionMatch[1];\n        if (stackMatch) manualResult.stack = stackMatch[1];\n        if (scoringMatch) manualResult.scoring = parseInt(scoringMatch[1]);\n      }\n      \n      if (Object.keys(manualResult).length > 0) {\n        parsedResult = manualResult;\n        console.log(\"JSON extra√≠do manualmente:\", parsedResult);\n      }\n    } catch (manualError) {\n      console.log(\"Error en parsing manual:\", manualError.message);\n    }\n  }\n}\n\n// Estructura de resultado por defecto\nlet finalResult = {\n  nombre: \"Automatizaci√≥n No Especificada\",\n  solucion: \"No se pudo determinar la soluci√≥n de automatizaci√≥n\",\n  stack: \"Stack no definido\",\n  scoring: 0.5, // 50% como decimal\n  debug: {\n    raw_text: responseText,\n    clean_text: cleanText,\n    parse_success: false,\n    validation_errors: [],\n    parsing_method: \"default\"\n  }\n};\n\n// Si logramos parsear, validar y limpiar los datos\nif (parsedResult && typeof parsedResult === 'object') {\n  finalResult.debug.parse_success = true;\n  finalResult.debug.parsing_method = \"json_parse\";\n  \n  // Validar y asignar nombre\n  if (typeof parsedResult.nombre === 'string' && parsedResult.nombre.trim() !== '') {\n    finalResult.nombre = parsedResult.nombre.trim();\n  } else {\n    finalResult.debug.validation_errors.push(\"nombre inv√°lido o faltante\");\n  }\n  \n  // Validar y asignar soluci√≥n\n  if (typeof parsedResult.solucion === 'string' && parsedResult.solucion.trim() !== '') {\n    finalResult.solucion = parsedResult.solucion.trim();\n  } else {\n    finalResult.debug.validation_errors.push(\"solucion inv√°lida o faltante\");\n  }\n  \n  // Validar y asignar stack\n  if (typeof parsedResult.stack === 'string' && parsedResult.stack.trim() !== '') {\n    finalResult.stack = parsedResult.stack.trim();\n  } else {\n    finalResult.debug.validation_errors.push(\"stack inv√°lido o faltante\");\n  }\n  \n  // Validar y convertir scoring a decimal (CR√çTICO PARA AIRTABLE)\n  let scoring = null;\n  if (typeof parsedResult.scoring === 'number') {\n    scoring = parsedResult.scoring;\n  } else if (typeof parsedResult.scoring === 'string') {\n    scoring = parseInt(parsedResult.scoring);\n  }\n  \n  if (scoring !== null && !isNaN(scoring) && scoring >= 1 && scoring <= 100) {\n    // CONVERTIR A DECIMAL PARA AIRTABLE (88 -> 0.88)\n    finalResult.scoring = scoring / 100;\n  } else {\n    finalResult.debug.validation_errors.push(\"scoring inv√°lido (debe ser 1-100)\");\n    finalResult.scoring = 0.5; // 50% como decimal\n  }\n}\n\n// Validaciones adicionales y correcciones\nif (finalResult.nombre === \"Automatizaci√≥n No Especificada\" && parsedResult) {\n  const solucionWords = finalResult.solucion.split(' ').slice(0, 4).join(' ');\n  if (solucionWords.length > 0) {\n    finalResult.nombre = solucionWords;\n    finalResult.debug.validation_errors.push(\"nombre generado autom√°ticamente desde soluci√≥n\");\n  }\n}\n\n// Asegurar que scoring est√© en rango decimal v√°lido 0.01-1.00\nif (finalResult.scoring < 0.01) finalResult.scoring = 0.01;\nif (finalResult.scoring > 1.00) finalResult.scoring = 1.00;\n\n// Stack por defecto si est√° vac√≠o\nif (finalResult.stack === \"Stack no definido\" || finalResult.stack === \"\") {\n  finalResult.stack = \"n8n + Airtable + APIs\";\n  finalResult.debug.validation_errors.push(\"stack asignado por defecto\");\n}\n\n// Log final\nconsole.log(\"=== RESULTADO FINAL ===\");\nconsole.log(\"Nombre:\", finalResult.nombre);\nconsole.log(\"Soluci√≥n:\", finalResult.solucion);\nconsole.log(\"Stack:\", finalResult.stack);\nconsole.log(\"Scoring original:\", parsedResult?.scoring);\nconsole.log(\"Scoring para Airtable (decimal):\", finalResult.scoring);\nconsole.log(\"Scoring mostrado (%):\", (finalResult.scoring * 100) + \"%\");\nconsole.log(\"Errores de validaci√≥n:\", finalResult.debug.validation_errors);\n\n// Retornar resultado estructurado\nreturn [{\n  json: {\n    nombre: finalResult.nombre,\n    solucion: finalResult.solucion,\n    stack: finalResult.stack,\n    scoring: finalResult.scoring, // Enviado como decimal\n    debug: finalResult.debug\n  }\n}];"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[2096,352],"id":"c12e580d-3a28-4c2b-9288-d40beaa2fa96","name":"Code3"},{"parameters":{"content":"## üìÇ MOTOR DE INVESTIGACI√ìN DE PUNTOS DE DOLOR\n\n","height":2192,"width":2272,"color":5},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-2240,-688],"id":"01b77794-d177-4807-bd35-bc4173014d99","name":"Sticky Note1"},{"parameters":{"promptType":"define","text":"=## ENTRADA\n**Topic:** {{ $json.tema_imagen }}\n** Post:** {{ $json.contenido_blog }}","messages":{"messageValues":[{"message":"=# VISUAL PROMPT EXPERT: Digital Marketing Imagery\n\n## ROLE DEFINITION\nYou are a **Visual Prompt Expert** specializing in creating high-impact, viral imagery for digital marketing content. *Your mission is to analyze blog content about digital marketing strategies and generate simple, direct, cinematic prompts in English that create maximum LinkedIn engagement.*\n\n# IMPORTANT - OUTPUT: PLAIN TEXT PROMPT ONLY - NO SPECIAL CHARACTERS OR PUNCTUATION\n\n## ANALYSIS FRAMEWORK\n\n### STEP 1: EXTRACT KEY ELEMENTS\nFrom the blog content, identify:\n- **Main pain point** (specific marketing problem)\n- **Target sector** (restaurants, clinics, e-commerce, agencies, etc.)\n- **Transformation moment** (before/after digital strategy)\n- **Emotional shift** (invisibility ‚Üí visibility, confusion ‚Üí clarity)\n\n### STEP 2: SELECT VISUAL CONCEPT\nChoose the most powerful concept:\n- **VISIBILITY** - From invisible to first page of Google\n- **GROWTH** - Exponential business expansion through digital\n- **CONNECTION** - Building authentic audience relationships\n- **TRANSFORMATION** - Before/after digital presence\n- **DOMINATION** - Commanding digital landscape\n\n## PROMPT STRUCTURE (ALWAYS IN ENGLISH)\n\n### REQUIRED FORMAT:\n[SHOT TYPE] of [MAIN SUBJECT] [ACTION/EMOTION] in [ENVIRONMENT]. [VISUAL METAPHOR/KEY ELEMENTS]. [LIGHTING]. Shot on [LENS] with [DEPTH OF FIELD]. [COLOR PALETTE]. [TECHNICAL SPECS].\n\n### EXAMPLE STRUCTURE:\n\nMedium shot cinematic portrait of Spanish business owner confidently pointing at massive floating Google search results showing their company at number 1 position. Modern office with holographic SEO metrics and rising traffic graphs surrounding. Dramatic key lighting highlighting triumphant expression. Shot on 85mm prime lens with shallow depth of field blurring competitor results below. Digital blue and success green color palette with bright white highlights. 8K hyper detailed photorealistic.\n\nWide angle cinematic shot of restaurant owner standing in bustling dining room while holographic social media engagement metrics float above tables filled with happy customers. Warm ambient lighting mixed with cool digital displays showing increased reservations. Shot on 24mm lens capturing entire transformed space with selective focus on proud owner. Appetite inducing warm yellows and social media blues with golden hour accents. 8K ultra realistic with motion blur of satisfied diners and glowing review notifications.\n\nLow angle cinematic shot of e commerce entrepreneur commanding center stage with arms raised as floating 3D sales charts and customer conversion funnels spiral upward around figure. Dynamic LED lighting creating powerful silhouette against backdrop of rising revenue graphs. Shot on 35mm with dramatic perspective emphasizing dominance over digital marketplace. Electric commerce orange and profit green palette with premium gold accents. 8K photorealistic with particle effects showing exponential growth trajectory.\n\n## VISUAL ELEMENTS LIBRARY\n\n### BUSINESS CONTEXTS:\n- Modern Spanish office with digital displays\n- Bustling restaurant with happy customers\n- Clean clinic reception with patient flow\n- Creative agency workspace with campaign boards\n- Local storefront with increased foot traffic\n\n### EMOTIONAL EXPRESSIONS:\n- Confidence from digital dominance\n- Relief from finally being found online\n- Excitement from growing engagement\n- Pride in brand transformation\n- Determination in competitive landscape\n\n### MARKETING METAPHORS:\n- Google search results floating in 3D\n- Social media engagement rising like smoke\n- Customer journey maps as holographic paths\n- Revenue charts growing exponentially upward\n- Brand visibility expanding as light rays\n\n### TECHNICAL SPECIFICATIONS:\n- Shot on 85mm/50mm/24mm prime lens\n- Shallow depth of field f 1 point 4\n- 8K hyper detailed photorealistic\n- Cinematic lighting key plus fill plus rim\n- Digital marketing color palette blue green orange\n\n## SECTOR-SPECIFIC ELEMENTS\n\n### RESTAURANTS/HOSPITALITY:\n- Busy dining rooms satisfied customers reservation systems\n- Food photography social media reviews local SEO\n- Online ordering platforms delivery integration\n\n### CLINICS/HEALTHCARE:\n- Patient consultations appointment booking systems\n- Medical expertise content trust building\n- Online reputation management testimonials\n\n### E-COMMERCE/RETAIL:\n- Product catalogs shopping carts conversion funnels\n- Abandoned cart recovery email marketing\n- Inventory management customer lifecycle\n\n### AGENCIES/SERVICES:\n- Client presentations campaign dashboards\n- Creative workflows project management\n- Performance metrics ROI demonstrations\n\n## OUTPUT REQUIREMENTS\n- DELIVER ONLY THE ENGLISH PROMPT IN PLAIN TEXT\n- NO quotes brackets commas periods or JSON structure\n- Single paragraph format with spaces between words only\n- All technical and emotional elements included\n- Maximum impact for LinkedIn engagement\n- NO special characters punctuation marks or symbols\n\n## VALIDATION CHECKLIST\nBefore generating:\n- Marketing pain point clearly identified from blog\n- Target sector correctly mapped\n- Digital transformation captured\n- All technical elements included\n- Prompt in English only\n- Simple direct cinematic style\n- Plain text format with no punctuation\n\n## FINAL INSTRUCTION\nAnalyze the blog content extract the core digital marketing transformation and generate a single powerful English prompt in plain text format that will create a viral LinkedIn image. Focus on the emotional journey from marketing invisibility to digital dominance and business growth.\n\n# IMPORTANT - OUTPUT: PLAIN TEXT ENGLISH PROMPT ONLY WITH NO PUNCTUATION MARKS COMMAS PERIODS OR SPECIAL CHARACTERS"}]},"batching":{}},"type":"@n8n/n8n-nodes-langchain.chainLlm","typeVersion":1.7,"position":[960,1408],"id":"4205ff06-046f-42f6-ae04-3aeef63baba3","name":"prompt_imagen","notesInFlow":false,"notes":"AVERIS TECH"},{"parameters":{"model":"google/gemini-2.5-pro","options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenRouter","typeVersion":1,"position":[2176,1680],"id":"fccfe321-ab5d-477a-b2a7-83563ce8541b","name":"Gemini 2.5 Pro"},{"parameters":{"options":{"temperature":0}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenRouter","typeVersion":1,"position":[1856,608],"id":"17ad8864-ee65-4fd8-9a53-a7f0f3934784","name":"OpenAI 4.1 Mini"},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenRouter","typeVersion":1,"position":[1216,1216],"id":"f0a8e807-0ed5-4e50-8531-46b490fb3c62","name":"OpenAi 4.1 Mini"},{"parameters":{"content":"## üìÇ MOTOR AUTOMATIZADO DE DESCUBRIMIENTO DE PUNTOS DE DOLOR\n","height":976,"width":1360,"color":5},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[144,-256],"id":"b622f058-8405-4239-8a6c-036b18c38a65","name":"Sticky Note5"},{"parameters":{"content":"## üèÜ ARQUITECTO DE SOLUCIONES CON IA\n\n","height":720,"width":1008,"color":6},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[1552,16],"id":"e6415953-e689-4f4b-97b0-5d6af51c6242","name":"Sticky Note8"},{"parameters":{"promptType":"define","text":"=### Nicho: {{ $json.nicho }}\n### Pain point: {{ $json.pain_point }}","messages":{"messageValues":[{"message":"=# DETECTOR EXPERTO DE PAIN POINTS DE MARKETING DIGITAL\n\n## IDENTIDAD\nEres un detector experto de pain points de marketing digital que analiza posts de Reddit. Tu objetivo es identificar problemas de marketing reales que se puedan resolver con estrategias digitales, publicidad online, SEO, redes sociales y herramientas de marketing.\n\n## INSTRUCCI√ìN PRINCIPAL\nAnaliza el texto y detecta pain points de marketing digital solucionables. Traduce los problemas a un lenguaje claro y empresarial, a√±adiendo contexto realista cuando sea necesario para que cualquier due√±o de negocio entienda el problema.\n\n## FORMATO DE RESPUESTA\nResponde **SOLO** con este JSON exacto (sin explicaciones adicionales):\n\n```json\n{\n    \"tiene_pain_point\": true,\n    \"nicho\": \"Dentist|Beauty|Accounting|Real Estate|Lawyer|Ecommerce|HR|Online_Education|Online_Coach|Interior_Design\",\n    \"pain_point\": \"descripci√≥n clara del problema con contexto realista que cualquier empresario entienda\"\n}\nSi no hay pain point de marketing solucionable:\n\nJSON\n\n{\n    \"tiene_pain_point\": false,\n    \"nicho\": null,\n    \"pain_point\": null\n}\nNICHOS ESPEC√çFICOS PERMITIDOS (ELEGIR UNO EXACTO):\nDentist\n\nBeauty\n\nAccounting\n\nReal Estate\n\nLawyer\n\nEcommerce\n\nHR\n\nOnline_Education\n\nOnline_Coach\n\nInterior_Design\n\nPAIN POINTS DE MARKETING QUE S√ç DETECTAMOS:\n‚úÖ Falta de visibilidad online (no aparece en Google, competencia dominando)\n‚úÖ Bajo ROI en publicidad digital (Facebook Ads, Google Ads sin resultados)\n‚úÖ Gesti√≥n deficiente de redes sociales (falta de engagement, contenido inconsistente)\n‚úÖ Ausencia de estrategia SEO local (clientes locales no encuentran el negocio)\n‚úÖ Problemas de captaci√≥n de leads (web sin conversiones, formularios que no funcionan)\n‚úÖ Falta de seguimiento de clientes potenciales (leads que se pierden, no hay nurturing)\n‚úÖ Ausencia de marketing de contenidos (no educan a su audiencia, falta autoridad)\n‚úÖ Problemas de reputaci√≥n online (malas rese√±as, falta de testimonios)\n‚úÖ Email marketing inexistente o ineficaz (no retienen clientes, comunicaci√≥n espor√°dica)\n‚úÖ M√©tricas y anal√≠tica confusa (no saben qu√© marketing funciona)\n‚úÖ Competencia digital superior (otros negocios dominando su mercado online)\n‚úÖ Conversi√≥n web baja (mucho tr√°fico pero pocas ventas)\n‚úÖ Falta de presencia en plataformas clave (Google My Business, directorios)\n‚úÖ Problemas con el embudo de ventas digital (leads no se convierten en clientes)\n‚úÖ Marketing tradicional sin resultados (volantes, radio sin ROI medible)\n‚úÖ Falta de automatizaci√≥n en marketing (mensajes manuales, seguimientos perdidos)\n‚úÖ Targeting incorrecto en publicidad (anuncios a audiencia equivocada)\n‚úÖ Branding d√©bil o inconsistente (confusi√≥n de marca en diferentes canales)\n\nPAIN POINTS QUE NO SON NUESTRO FOCO:\n‚ùå Problemas operativos internos sin componente de marketing\n‚ùå Issues t√©cnicos de desarrollo web complejos\n‚ùå Problemas de producto o servicio (calidad, precio)\n‚ùå Conflictos legales o regulatorios\n‚ùå Problemas financieros generales no relacionados con marketing\n‚ùå Issues interpersonales entre empleados\n\nCRITERIOS PARA PAIN POINTS CLAROS:\nTraducir jerga t√©cnica: Convertir t√©rminos de marketing en lenguaje empresarial\n\nA√±adir contexto realista: Explicar por qu√© es un problema para el crecimiento del negocio\n\nCuantificar cuando sea posible: Mencionar clientes perdidos, ventas no realizadas\n\nSer espec√≠fico: Evitar descripciones vagas, ir al problema concreto de marketing\n\nEJEMPLOS DE TRANSFORMACI√ìN:\nANTES (t√©cnico/vago): \"Mi CTR est√° muy bajo\"\nDESPU√âS (claro/empresarial): \"Los anuncios de Facebook apenas generan clics, gastando 500‚Ç¨ mensuales en publicidad que solo trae 2-3 clientes potenciales\"\n\nANTES (t√©cnico/vago): \"No tengo organic reach\"\nDESPU√âS (claro/empresarial): \"Las publicaciones en redes sociales solo las ven 20-30 personas cuando tengo 1,000 seguidores, perdiendo oportunidades de generar ventas sin pagar publicidad\"\n\nANTES (t√©cnico/vago): \"SEO problems\"\nDESPU√âS (claro/empresarial): \"Los clientes no encuentran mi negocio en Google cuando buscan servicios dentales en mi zona, mientras la competencia aparece en las primeras posiciones\"\n\nANTES (t√©cnico/vago): \"Bad conversion funnel\"\nDESPU√âS (claro/empresarial): \"Los visitantes llegan a mi web pero no se convierten en clientes: de 1,000 visitas mensuales solo consigo 5-10 consultas reales\"\n\nIDENTIFICACI√ìN DE NICHOS:\nDebe ser uno de los 10 nichos exactos listados arriba\n\nSi el problema no encaja claramente en ning√∫n nicho espec√≠fico, evaluar cu√°l es el m√°s cercano\n\nSi es demasiado gen√©rico o no aplica a ninguno de los nichos, marcar como sin pain point\n\nREGLAS IMPORTANTES:\nSOLO usar los nichos exactos listados\n\nNO crear variaciones de los nichos permitidos\n\nSi no encaja en ning√∫n nicho espec√≠fico, marcar tiene_pain_point: false\n\nResponder √öNICAMENTE con el JSON, sin explicaciones adicionales\n"}]},"batching":{}},"type":"@n8n/n8n-nodes-langchain.chainLlm","typeVersion":1.7,"position":[1792,352],"id":"58c43684-46ce-4a49-9f8f-716546558670","name":"asistente_soluciones"},{"parameters":{"promptType":"define","text":"=### T√≠tulo: {{ $json.title }}\n### Contenido: {{ $json.selftext }}","messages":{"messageValues":[{"message":"=# DETECTOR EXPERTO DE PAIN POINTS DE MARKETING DIGITAL\n\n## IDENTIDAD\nEres un detector experto de pain points de marketing digital que analiza posts de Reddit. Tu objetivo es identificar problemas de marketing reales que se puedan resolver con estrategias digitales, publicidad online, SEO, redes sociales y herramientas de marketing.\n\n## INSTRUCCI√ìN PRINCIPAL\nAnaliza el texto y detecta pain points de marketing digital solucionables. Traduce los problemas a un lenguaje claro y empresarial, a√±adiendo contexto realista cuando sea necesario para que cualquier due√±o de negocio entienda el problema.\n\n## FORMATO DE RESPUESTA\nResponde **SOLO** con este JSON exacto (sin explicaciones adicionales):\n\n```json\n{\n    \"tiene_pain_point\": true,\n    \"nicho\": \"Dentist|Beauty|Accounting|Real Estate|Lawyer|Ecommerce|HR|Online_Education|Online_Coach|Interior_Design\",\n    \"pain_point\": \"descripci√≥n clara del problema con contexto realista que cualquier empresario entienda\"\n}\nSi no hay pain point de marketing solucionable:\n\nJSON\n\n{\n    \"tiene_pain_point\": false,\n    \"nicho\": null,\n    \"pain_point\": null\n}\nNICHOS ESPEC√çFICOS PERMITIDOS (ELEGIR UNO EXACTO):\nDentist\n\nBeauty\n\nAccounting\n\nReal Estate\n\nLawyer\n\nEcommerce\n\nHR\n\nOnline_Education\n\nOnline_Coach\n\nInterior_Design\n\nPAIN POINTS DE MARKETING QUE S√ç DETECTAMOS:\n‚úÖ Falta de visibilidad online (no aparece en Google, competencia dominando)\n‚úÖ Bajo ROI en publicidad digital (Facebook Ads, Google Ads sin resultados)\n‚úÖ Gesti√≥n deficiente de redes sociales (falta de engagement, contenido inconsistente)\n‚úÖ Ausencia de estrategia SEO local (clientes locales no encuentran el negocio)\n‚úÖ Problemas de captaci√≥n de leads (web sin conversiones, formularios que no funcionan)\n‚úÖ Falta de seguimiento de clientes potenciales (leads que se pierden, no hay nurturing)\n‚úÖ Ausencia de marketing de contenidos (no educan a su audiencia, falta autoridad)\n‚úÖ Problemas de reputaci√≥n online (malas rese√±as, falta de testimonios)\n‚úÖ Email marketing inexistente o ineficaz (no retienen clientes, comunicaci√≥n espor√°dica)\n‚úÖ M√©tricas y anal√≠tica confusa (no saben qu√© marketing funciona)\n‚úÖ Competencia digital superior (otros negocios dominando su mercado online)\n‚úÖ Conversi√≥n web baja (mucho tr√°fico pero pocas ventas)\n‚úÖ Falta de presencia en plataformas clave (Google My Business, directorios)\n‚úÖ Problemas con el embudo de ventas digital (leads no se convierten en clientes)\n‚úÖ Marketing tradicional sin resultados (volantes, radio sin ROI medible)\n‚úÖ Falta de automatizaci√≥n en marketing (mensajes manuales, seguimientos perdidos)\n‚úÖ Targeting incorrecto en publicidad (anuncios a audiencia equivocada)\n‚úÖ Branding d√©bil o inconsistente (confusi√≥n de marca en diferentes canales)\n\nPAIN POINTS QUE NO SON NUESTRO FOCO:\n‚ùå Problemas operativos internos sin componente de marketing\n‚ùå Issues t√©cnicos de desarrollo web complejos\n‚ùå Problemas de producto o servicio (calidad, precio)\n‚ùå Conflictos legales o regulatorios\n‚ùå Problemas financieros generales no relacionados con marketing\n‚ùå Issues interpersonales entre empleados\n\nCRITERIOS PARA PAIN POINTS CLAROS:\nTraducir jerga t√©cnica: Convertir t√©rminos de marketing en lenguaje empresarial\n\nA√±adir contexto realista: Explicar por qu√© es un problema para el crecimiento del negocio\n\nCuantificar cuando sea posible: Mencionar clientes perdidos, ventas no realizadas\n\nSer espec√≠fico: Evitar descripciones vagas, ir al problema concreto de marketing\n\nEJEMPLOS DE TRANSFORMACI√ìN:\nANTES (t√©cnico/vago): \"Mi CTR est√° muy bajo\"\nDESPU√âS (claro/empresarial): \"Los anuncios de Facebook apenas generan clics, gastando 500‚Ç¨ mensuales en publicidad que solo trae 2-3 clientes potenciales\"\n\nANTES (t√©cnico/vago): \"No tengo organic reach\"\nDESPU√âS (claro/empresarial): \"Las publicaciones en redes sociales solo las ven 20-30 personas cuando tengo 1,000 seguidores, perdiendo oportunidades de generar ventas sin pagar publicidad\"\n\nANTES (t√©cnico/vago): \"SEO problems\"\nDESPU√âS (claro/empresarial): \"Los clientes no encuentran mi negocio en Google cuando buscan servicios dentales en mi zona, mientras la competencia aparece en las primeras posiciones\"\n\nANTES (t√©cnico/vago): \"Bad conversion funnel\"\nDESPU√âS (claro/empresarial): \"Los visitantes llegan a mi web pero no se convierten en clientes: de 1,000 visitas mensuales solo consigo 5-10 consultas reales\"\n\nIDENTIFICACI√ìN DE NICHOS:\nDebe ser uno de los 10 nichos exactos listados arriba\n\nSi el problema no encaja claramente en ning√∫n nicho espec√≠fico, evaluar cu√°l es el m√°s cercano\n\nSi es demasiado gen√©rico o no aplica a ninguno de los nichos, marcar como sin pain point\n\nREGLAS IMPORTANTES:\nSOLO usar los nichos exactos listados\n\nNO crear variaciones de los nichos permitidos\n\nSi no encaja en ning√∫n nicho espec√≠fico, marcar tiene_pain_point: false\n\nResponder √öNICAMENTE con el JSON, sin explicaciones adicionales"}]},"batching":{}},"type":"@n8n/n8n-nodes-langchain.chainLlm","typeVersion":1.7,"position":[672,336],"id":"bc12b179-a354-49f3-870e-5f12acfcee77","name":"asistente_pain_points"}],"connections":{"Edit Fields":{"main":[[{"node":"agente_post","type":"main","index":0}]]},"Crear Imagen":{"main":[[{"node":"Wait","type":"main","index":0}]]},"Wait":{"main":[[{"node":"Get_freepik","type":"main","index":0}]]},"Aggregate":{"main":[[{"node":"Edit Fields","type":"main","index":0}]]},"SerpAPI":{"ai_tool":[[{"node":"agente_post","type":"ai_tool","index":0}]]},"Extraer_pain_points":{"main":[[{"node":"Aggregate","type":"main","index":0}]]},"Get_freepik":{"main":[[{"node":"Descargar_imagen1","type":"main","index":0}]]},"agente_post":{"main":[[{"node":"Code","type":"main","index":0}]]},"Schedule Trigger1":{"main":[[{"node":"nicho_aleatorio","type":"main","index":0}]]},"nicho_aleatorio":{"main":[[{"node":"Code1","type":"main","index":0}]]},"Code1":{"main":[[{"node":"Extraer_pain_points","type":"main","index":0}]]},"Descargar_imagen1":{"main":[[{"node":"Create a post1","type":"main","index":0}]]},"Code":{"main":[[{"node":"prompt_imagen","type":"main","index":0}]]},"Schedule Trigger":{"main":[[{"node":"Get many posts Dentist","type":"main","index":0},{"node":"Get many posts Beauty ","type":"main","index":0},{"node":"Get many posts Accounting","type":"main","index":0},{"node":"Get many posts Real Estate","type":"main","index":0},{"node":"Get many posts lawyer","type":"main","index":0},{"node":"Get many posts Ecommerce","type":"main","index":0},{"node":"Get many posts HR","type":"main","index":0},{"node":"Get many posts Online_Education","type":"main","index":0},{"node":"Get many posts Online Coach","type":"main","index":0},{"node":"Get many posts interior_design","type":"main","index":0}]]},"Merger":{"main":[[{"node":"+5 UPS","type":"main","index":0}]]},"+5 UPS":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]},"Get many posts Dentist":{"main":[[{"node":"Merger","type":"main","index":0}]]},"Get many posts Accounting":{"main":[[{"node":"Merger","type":"main","index":2}]]},"Get many posts Beauty ":{"main":[[{"node":"Merger","type":"main","index":1}]]},"Get many posts Real Estate":{"main":[[{"node":"Merger","type":"main","index":3}]]},"Get many posts Ecommerce":{"main":[[{"node":"Merger","type":"main","index":5}]]},"Get many posts Online Coach":{"main":[[{"node":"Merger","type":"main","index":8}]]},"Get many posts Online_Education":{"main":[[{"node":"Merger","type":"main","index":7}]]},"Get many posts interior_design":{"main":[[{"node":"Merger","type":"main","index":9}]]},"Get many posts lawyer":{"main":[[{"node":"Merger","type":"main","index":4}]]},"Get many posts HR":{"main":[[{"node":"Merger","type":"main","index":6}]]},"Loop Over Items":{"main":[[{"node":"No Operation, do nothing","type":"main","index":0}],[{"node":"asistente_pain_points","type":"main","index":0}]]},"If":{"main":[[{"node":"Loop Over Items","type":"main","index":0}],[{"node":"Edit Fields1","type":"main","index":0}]]},"Append row in sheet":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]},"Code2":{"main":[[{"node":"If","type":"main","index":0}]]},"Edit Fields1":{"main":[[{"node":"asistente_soluciones","type":"main","index":0}]]},"Code3":{"main":[[{"node":"Append row in sheet","type":"main","index":0}]]},"prompt_imagen":{"main":[[{"node":"Crear Imagen","type":"main","index":0}]]},"Gemini 2.5 Pro":{"ai_languageModel":[[{"node":"agente_post","type":"ai_languageModel","index":0},{"node":"prompt_imagen","type":"ai_languageModel","index":0}]]},"OpenAI 4.1 Mini":{"ai_languageModel":[[{"node":"asistente_pain_points","type":"ai_languageModel","index":0},{"node":"asistente_soluciones","type":"ai_languageModel","index":0}]]},"OpenAi 4.1 Mini":{"ai_languageModel":[[{"node":"nicho_aleatorio","type":"ai_languageModel","index":0}]]},"asistente_soluciones":{"main":[[{"node":"Code3","type":"main","index":0}]]},"asistente_pain_points":{"main":[[{"node":"Code2","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{"Schedule Trigger1":[{"json":{"timestamp":"2025-09-22T09:30:29.038+02:00","Readable date":"September 22nd 2025, 9:30:29 am","Readable time":"9:30:29 am","Day of week":"Monday","Year":"2025","Month":"September","Day of month":"22","Hour":"09","Minute":"30","Second":"29","Timezone":"Europe/Madrid (UTC+02:00)"}}]},"versionId":"dca43532-f2d8-42a6-ab37-44d5995414c7","triggerCount":0,"shared":[{"createdAt":"2025-08-18T21:20:01.588Z","updatedAt":"2025-08-18T21:20:01.588Z","role":"workflow:owner","workflowId":"gYjglItFN5iwWemj","projectId":"JP23SHf2OXqUP0Za"}],"tags":[]}