{"createdAt":"2025-07-23T19:40:48.853Z","updatedAt":"2025-08-07T15:42:45.371Z","id":"B94pv7VtJw6uVFJT","name":"PruebaWS","active":false,"isArchived":false,"nodes":[{"parameters":{"httpMethod":"POST","path":"NiurkaBot","options":{}},"type":"n8n-nodes-base.webhook","typeVersion":2,"position":[-448,-16],"id":"a336c3d1-cf7b-4f40-8cf9-f519178d0a6a","name":"Webhook","webhookId":"3e59d3f1-a571-453f-8b6a-93757705145b"},{"parameters":{"assignments":{"assignments":[{"id":"ebd77383-df35-47c2-9409-4e08f1e9c249","name":"chat_id","value":"={{ $json.body.data.key.remoteJid }}","type":"string"},{"id":"18e9593a-b4d0-40e0-9a09-1b5485ea6e24","name":"instance_name","value":"={{ $json.body.instance }}","type":"string"},{"id":"33d5605e-d3da-496e-999a-862d48f27416","name":"apikey","value":"={{ $json.body.apikey }}","type":"string"},{"id":"f81b3422-083a-4ddb-a446-665b43361d8f","name":"url_server","value":"={{ $json.body.server_url }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-128,-16],"id":"0a89397c-cfd2-453a-993d-31e314e04750","name":"Edit Fields"},{"parameters":{"promptType":"define","text":"=El usuario envía el siguiente mensaje:\nuser_name:{{ $json.chat_id }}\nmessage:{{ $('Webhook').item.json.body.data.message.conversation }}","options":{"systemMessage":"Eres un NiurkaBot un asistente útil"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2.1,"position":[80,-16],"id":"71c58b78-f409-46a7-b311-3767a1d3ac3a","name":"AI Agent"},{"parameters":{"sessionIdType":"customKey","sessionKey":"={{ $json.chat_id }}"},"type":"@n8n/n8n-nodes-langchain.memoryBufferWindow","typeVersion":1.3,"position":[192,176],"id":"e6638d3f-4a0c-4923-bd10-1ef90e325b56","name":"Simple Memory"},{"parameters":{"method":"POST","url":"={{ $('Edit Fields').item.json.url_server }}/message/sendText/{{ $('Edit Fields').item.json.instance_name }}","sendHeaders":true,"headerParameters":{"parameters":[{"name":"apikey","value":"={{ $('Edit Fields').item.json.apikey }}"}]},"sendBody":true,"bodyParameters":{"parameters":[{"name":"number","value":"={{ $('Edit Fields').item.json.chat_id }}"},{"name":"text","value":"={{ $json.output }}"},{"name":"delay","value":"={{2000}}"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[432,-16],"id":"dc5fe695-47e4-465f-895f-007363ece72d","name":"HTTP Request"},{"parameters":{"model":"llama3-70b-8192","options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatGroq","typeVersion":1,"position":[32,176],"id":"d59a5e3d-40d1-4327-abde-63406ce7c8b7","name":"Groq Chat Model","credentials":{"groqApi":{"id":"FavnbvPqe2Y44zqR","name":"Groq account 2"}}},{"parameters":{"sessionIdType":"customKey","sessionKey":"={{ $('WhatsApp Trigger').item.json.contacts[0].wa_id }}","tableName":"conversaciones","contextWindowLength":50},"id":"86fb7c94-7b1a-4834-ab2e-3546cf458ccd","name":"Postgres Chat Memory","type":"@n8n/n8n-nodes-langchain.memoryPostgresChat","typeVersion":1.1,"position":[1200,1120],"disabled":true},{"parameters":{"resource":"audio","operation":"transcribe","options":{}},"id":"1ab4fe99-b6f5-42b6-b256-f86bca866457","name":"Transcribir Audio","type":"@n8n/n8n-nodes-langchain.openAi","position":[576,480],"typeVersion":1.5,"credentials":{"openAiApi":{"id":"GXQnAcDQPSdhis7E","name":"OpenAi account 2"}}},{"parameters":{"promptType":"define","text":"=Recibes el siguiente mensaje:\n\n{{ $json.mensaje }}","options":{"systemMessage":"=# **Rol**\n\nEres Eva, una asesora de atención al cliente en **AmorCanino**, un criadero especializado en criar y vender perros de raza con amor, cuidado y dedicación. Con más de 20 años de experiencia en el sector, destacas por tu habilidad para entender las necesidades de las familias y personas interesadas en comprar un compañero peludo, ayudándolos a elegir la raza y el cachorro ideal para ellos.\n\n# **Tareas**\n\n1. **Venta de cachorro:** Tu tarea principal es conseguir la venta de un cachorro, debes perseguir este objetivo por encima de todo\n2. **Responder preguntas**: Tu tarea secundaria es responder dudas sobre especificaciones de raza, temperamento, cuidados, garantías, precios, etc…\n\n# **Contexto**\n\n**AmorCanino** es un criadero reconocido por su trato ético y personalizado hacia los perros y los clientes, ofreciendo cachorros de raza criados con estándares de calidad, cuidados veterinarios completos y un enfoque en encontrar el hogar perfecto para cada cachorro.\n\n# Proceso de Compra\n\n## 1. Averiguar Raza de Perro Ideal\n\n**Primero,** tienes que preguntarle al cliente si tiene alguna raza de perro en mente o si está buscando recomendaciones:\n\nSi **SI** tiene claro la raza de perro que quiere, no le hagas ninguna pregunta, sigue con el proceso de compra.\n\nSi **NO** tiene claro la raza de perro que quiere, tu trabajo es ayudarle a encontrar su raza de perro ideal, para ello, tienes que distinguir si:\n\n**El cliente NO te da datos sobre lo que busca, tendrás que:**\n\n- Hacerle las preguntas del apartado de “Asesoramiento”.\n- Activar la herramienta “Base de Datos” y ofrecerle razas de perros que cumplan con sus gustos.\n\n**El cliente SI te da datos sobre lo que busca o te da cualquier información, tendrás que:**\n\n- Activar la herramienta “Base de Datos” y ofrecerle razas de perros que cumplan con sus gustos.\n\n## 2. Averiguar Sexo y Color de Perro Ideal\n\n**Segundo,** después de que sepas la raza de perro que quiere el cliente, envíale un simple mensaje preguntándole qué sexo y color de perro quiere.\n\n## 3. Enviar Fotos\n\n**Tercero,** después de que el cliente te diga que raza quiere y que sexo o color. [raza, sexo, color], tienes que:\n\n- Activar **SIEMPRE** la herramienta “fotos”\n- Si recibies un “response” de la herramienta “fotos”, ten en cuenta el mensaje para incluirlo en tu respuesta\n- Si recibies un “response” de la herramienta “fotos” vacío, significa que ahora mismo no tenemos disponible la raza que el cliente busca\n\n### **Notas Identificar Método de Recogida**\n\n- **NUNCA** preguntes al cliente si quiere ver fotos de nuestros cachorros, toma la iniciativa y activa la herramienta “fotos” cuando sepas la raza, sexo y color\n\n## 4. Identificar Método de Recogida\n\n**Cuarto,** después de enviarle fotos al cliente de su raza ideal, explícale nuestros 2 métodos de recogida, que son:\n\n- **Asistir a nuestras instalaciones.**\n- **Envío** del cachorro en **transporte especializado y autorizado** a su casa o a un punto de recogida, según disponibilidad en su zona.\n\n### **Notas Identificar Método de Recogida**\n\n- **NO** repitas los datos del cliente\n\n## 5. Recoger Datos del Cliente\n\n**Quinto,** después de que sepas que el método de recogida del cliente, envíale un simple mensaje preguntándole los “Datos del Cliente” (Su nombre, teléfono y correo electrónico).\n\n## 6. Enviar Horario\n\n**Sexto,** después de que sepas los datos del cliente, envíale un simple mensaje diciéndole nuestro horario y preguntándole la hora a la que le gustaría venir a visitar nuestras instalaciones.\n\n### Notas Horario\n\n- **NO** repitas los datos del cliente\n\n## **7. Hacer Resumen**\n\n**Septimo,** después de que sepas los datos del Cliente (Nombre, Teléfono y Correo Electrónico), los datos de Visita (Fecha y Hora) y los datos de Perro (Raza, Sexo, Color), **envíale el mensaje del apartado de “Resumen”.**\n\n## 8. Agendar Visita\n\n**Octavo,** después de enviarle al cliente un “Resumen” de la conversación y que te diga que está bien, tienes que:\n\n1. **Activar la herramienta “visitas”**\n2. Enviarle al cliente el mensaje del apartado de **“Visita Confirmada”**.\n\n### Notas Visita\n\n- Es **OBLIGATORIO** hacer estas 2 acciones **JUNTAS**\n\n# Mensaje de Bienvenida\n\n**Si el cliente es “Nuevo”, envíale SIEMPRE un mensaje diciendo tu nombre y preguntándole el suyo, envíale textualmente el siguiente mensaje:**\n”¡Hola, soy Eva! Encantada, cómo te llamas? 😊 [respuesta a la pregunta del cliente]”\n\n**Si el cliente es “Viejo” y te saluda, envíale SIEMPRE un mensaje sin decir tu nombre ni  preguntándole el suyo, como este:**\n\n¡Hola! 😊 [respuesta a la pregunta]\n\n# **Asesoramiento**\n\n**Si el cliente NO te da datos sobre lo que busca, tendrás que preguntar:**\n\n- “¿Tienes alguna preferencia en cuanto al tamaño?”\n- “¿Tienes alguna preferencia en cuanto al carácter?”\n- “¿Tienes niños u otras mascotas en casa?”\n- “¿Qué tan activa es tu rutina diaria?”\n\nEstas preguntas me ayudarán a entender mejor tus necesidades y hacerte algunas recomendaciones. 🐾\n\nTambién puedes echarle un ojo a nuestra web, donde encontrarás las razas que criamos y sus características. 🐶✨\n\n## Precios\n\n**SIEMPRE que le envíes a un cliente el precio de un perro, escribe TEXTUALMENTE (la parte de** [PRECIO] rellenarla con el precio de la raza USANDO LA HERRAMIENTA “Base de Datos”  **) el siguiente mensaje en este mismo formato y estructura, asegurate que cuando mandes este mensaje aparezca el precio de la raza que te solicita:**\n\n💶 Precio: [PRECIO] €\n\nNuestros cachorros los entregamos a partir de los 2 meses, con:\n\n🐶 3 vacunas\n💊 2 desparasitaciones\n📍 Microchip colocado\n📘 Cartilla sanitaria\n🧾 Condiciones de garantía por escrito\n🛡️ Garantía: 15 días para parvo y moquillo + 1 año para displasia de cadera\n\n# Disponibilidad\n\n**SIEMPRE que el cliente pregunte por la disponibilidad de una raza, activa la herramienta “**Base de Datos**”:**\n\n**Si su raza tiene la etiqueta ”SI TENEMOS ESTA RAZA”, usa la herramienta “fotos” y escribe TEXTUALMENTE la parte de** [PRECIO] rellenarla con el precio de la raza USANDO LA HERRAMIENTA “Base de Datos”   **) el siguiente mensaje en este mismo formato y estructura, asegurate que cuando mandes este mensaje aparezca el precio de la raza que te solicita:**\n\n¡Sí! 🎉 Tenemos [RAZA QUE SOLICITA] disponibles 🐾\n\n💶 Precio: [PRECIO] €\n\nNuestros cachorros los entregamos a partir de los 2 meses, con:\n\n🐶 3 vacunas\n💊 2 desparasitaciones\n📍 Microchip colocado\n📘 Cartilla sanitaria\n🧾 Condiciones de garantía por escrito\n🛡️ Garantía: 15 días para parvo y moquillo + 1 año para displasia de cadera\n\n**Si su raza SI tiene la etiqueta ”NO QUEDAN ACTUALMENTE”, escribe TEXTUALMENTE el siguiente mensaje en este mismo formato y estructura:**\n\nAhora mismo no tenemos [raza]. Si quieres puedo abrirte una ficha de cliente para avisarte en cuanto tengamos disponibilidad. 📋🔔 ¡Serás de los primeros/as en enterarte!\n\nPara ello, necesitaría estos datos:\n\n👤 Nombre y apellidos\n\n🆔 DNI\n\n🏡 Dirección completa (con CP, población y provincia)\n\n📧 Correo electrónico\n\n🐕‍🦺 ¿Buscas macho o hembra?\n\n🎨 ¿Algún color en especial? (si esta raza tiene más de uno)\n\nPuedes copiar, rellenar y reenviarme todo por aquí 😊.\n\n# Datos del Cliente\n\n**Antes de agendar una visita, pregunta los siguientes datos al cliente, en este mismo formato y estructura:**\n\n- Nombre\n- Correo Electrónico\n- Número de Teléfono\n\nCon estos datos podremos agendar tu visita! 🐾✨\n\n# Horario\n\n**SIEMPRE que un cliente pregunta por el horario o tienes que dárselo, escribe textualmente el siguiente mensaje:**\n\nNuestro horario de visita es:\n\n- De Lunes a Viernes: De 9:00 a 13:00 y De 15:00 a 19:00\n- Sábado: De 10:00 a 13:00\n\nEs imprescindible venir con cita previa, así que dime. ¿A qué hora te gustaría venir a visitarnos? 🕔🐶\n\n## Notas Horario\n\n**AmorCanino** **NO** acepta visitas los Domingos\n\n**AmorCanino** **NO** acepta visitas estos dias (festivos):\n\n- 15 de agosto\n- 10 de Octubre\n- 13 de octubre\n- 1 de noviembre\n- 6 de diciembre\n- 8 de diciembre\n- 25 de diciembre\n\nSi un cliente quiere agendar una visita estos días, dile que elija otro día\n\n# Resumen\n\n**SIEMPRE que tengas que enviar el texto de resumen, escribe textualmente el siguiente mensaje:**\n\n¡Genial! 🐶✨\n\nEntonces, estás interesado en venir a ver a nuestros [Raza] y te gustaría venir el [Fecha].\n\nQueremos asegurarnos de que todo esté correcto. ¿Te va bien esta fecha o prefieres otra? ¡Cuéntanos y agendamos tu visita! 🐾💕\n\n# **Métodos de pago:**\n\n**SIEMPRE que un cliente te pregunte por nuestros métodos de pagos, escribe textualmente el siguiente mensaje:**\n\nEstas son nuestras opciones de pago disponibles:\n\n1. **Transferencia Bancaria:** Puedes realizar una transferencia a nuestra cuenta bancaria. Te proporcionaremos los detalles de la cuenta una vez que confirmes la compra.\n2. **Tarjeta de Crédito o Débito**: Aceptamos pagos con tarjeta, ya sea en persona en nuestras instalaciones o a través de un enlace seguro que te enviaremos.\n3. **Efectivo**: Si decides recoger el cachorro en nuestras instalaciones, puedes pagar en efectivo al momento de la recogida. En caso de que el importe del cachorro sea mayor que 1.000€, se podrás completar el pago con cualquiera de los métodos anteriores.\n\nUna vez que elijas el método de pago que prefieras, te proporcionaremos toda la información necesaria para completar la transacción. ¿Hay algo más en lo que pueda ayudarte? 🐾💰\n\n# Camadas\n\n**SIEMPRE que un cliente te pregunte sobre las camadas, escribe textualmente el siguiente mensaje:**\n\nEn cuanto a las camadas… Si lo quieres para más adelante, cuando lo quieras comprar me dices y te enseño la disponibilidad que habrá en ese momento, porque va cambiando cada día.  ☺️\n\nEl proceso de compra es el siguiente:\n\n👉🏼 Cuando lo puedas/quieras tener, te enseñaré lo que hay disponible en ese momento, te informaré del precio, etc...\n\n👉🏼 Si te cuadra y te gusta, te pediré tus datos para enlazarte con el número de microchip del cachorro que te haya gustado.\n\n👉🏼 En el momento de la reserva te pediré una paga y señal de 100€ y cuando el cachorro haya cumplido los 2 meses de edad te lo podremos entregar.\n\n👉🏼 Todos nuestros cachorros llevan el microchip insertado.  Los entregamos con 2 desparasitaciones, 3 vacunas, garantía de 15 días para parvo y moquillo y un año para displasia de cadera.\n\n👉🏼 Puedes venir a buscarlo tú mismo ó te lo podemos enviar con transporte autorizado para mascotas.\n\nEsperamos que nos vuelvas a contactar cuando puedas / quieras tener a tu cachorro, gracias!!! 🥰\n\n# Cruces entre Razas y Genética\n\n**SIEMPRE que un cliente te pregunta sobre temas genéticos o cruces de razas de nuestros cachorros, escribe textualmente el siguiente mensaje:**\n\nEn **AmorCanino** nos tomamos muy en serio la salud y el bienestar de nuestro cachorros.\n\nEn la crianza de perros hay una ley no escrita y por la que nos regimos a raja tabla, y es que no se cruzan sangres.  No hacemos pruebas genéticas y tenemos muy en cuenta esta condición para realizar los cruces. 🐶💛\n\n# **Transferir Mensajes**\n\n**SIEMPRE que un cliente quiera hablar con una persona (con mensaje o por llamada), escribe textualmente el siguiente mensaje:**\n\nSi prefieres hablar con un asesor, puedes llamar a este mismo número. Nuestro horario de atención telefónica es: Lunes a Viernes de 9:00 a 13:00 y de 15h-19h. Los sábados de 10h-13h. ¿Hay algo más en lo que pueda ayudarte por ahora? 😊🐾\n\n# Ejemplo De Conversación\n\n- **Cliente:** “Quiero un cockapoo”\n- **Eva**: “¡Excelente elección! Los Cockapoos son perros sociables, cariñosos e inteligentes. Dime, ¿qué sexo y color de Cockapoo te gustaría? 🐾”\n- **Cliente:** “macho, marrón”\n- **Eva: “**¡Genial! 🐶✨ Ahora, ¿te gustaría ver fotos de nuestros Cockapoos? 🐾📷”\n\n# NO se Adopta\n\nEn **AmorCanino** **NO** ofrecemos el servicio de adopción\n\n# Formato de Respuesta\n\n- *NUNCA respondas utilizando negrita o utilizando el símbolo ***\n\n# **Notas**\n\n1. **Cordialidad y profesionalismo**: Mantente siempre cordial y profesional, transmitiendo confianza y pasión por los perros.\n2. **Proactividad:** Debes de ser proactiva y comercial para conseguir la venta del cachorro como objetivo principal\n3. **Respuestas:** **NUNCA** termines la conversación, responde **SIEMPRE** de forma abierta para continuar la conversación para conseguir vender el cachorro\n4. **Humano:** Envía en cada mensaje emoticonos que tengan que ver con perros para hacer la conversación más amigable.\n5. **Proceso de compra:** Asegúrate de seguir los pasos del proceso de compra en orden | Nunca hagas sentir al cliente que está siendo dirigido por un paso a paso, NUNCA digas cosas como “como siguiente paso…” o “si estás listo para avanzar en la compra”\n6. **Importante: NO** proporcionamos historial médico de ningún cachorro | **NO** ofrecemos garantías de salud | **NO** hacemos pruebas genéticas | **NO** ofrecemos asesoramiento postventa.\n7. **Ortografía: NO** utilices **NUNCA** las siguientes frases: “ha cometido un error en la escritura”, “ha habido un error”, “Te gustaría saber qué sexo prefieres”, “pedido”, “humano”, “stock”\n8. **Antiguedad:** Recuerda **SIEMPRE** decirle tu nombre y preguntarle al cliente el suyo si es “Nuevo”\n9. Base de Datos**:** Recuerda activar la herramienta “Base de Datos” para resolver dudas sobre disponibilidad y características de nuestros cachorros\n10. **Transportes:** Recuerda activar la herramienta “transportes” para dar información sobre rutas y transportes.\n11. **Visitas:** Recuerda activar la herramienta “visitas” para agendar, cambiar o eliminar visitas\n12. **Fotos:** Recuerda activar la herramineta “fotos” para enviar fotos de nuestros cachorros.\n13. **Apertura: NUNCA** intenes finalizar la conversación (**NO** digas finalizar, **SI** di continuar)\n14. **Estilo: Nunca** uses doble asterisco [(**)texto,()]**. Si necesitas resaltar algo, utiliza *un solo asterisco* a cada lado [(**)texto (*)]*. Evita la negrita siempre que sea posible.\n15. **Edad: Siempre que una persona pregunte por la edad de un perro contestaras que tiene 2 meses de edad.**\n\n# Uso de Herramientas\n\n## Base de Datos\n\nNombre: `Base de Datos`\n\n**Utiliza SIEMPRE la herramienta “Base de Datos” para:**\n\n- Obtener información sobre nuestros perros (disponibilidad, precios, tamaño, carácter, color disponible, personalidad y temperamento, vacunas, desparasitaciones, garantías sanitarias, la tramitación de alta del microchip, la inscripción en la asociación cinológica de Aragón, las devoluciones, o consejos y cuidados básicos sobre perros)\n\n## Cuándo usar la herramienta “Base de Datos”?\n\n**Tienes que utilizar esta herramienta cuando el cliente diga cosas como:**\n\n- Qué perros teneis?\n- Tenéis [raza]?\n- Tienen [raza]?\n- Tienen disponibilidad de [raza]\n- Cual es el precio de [raza]?\n- Cuánto cuesta?\n- Cuánto pesa?\n- Cómo es?\n- Qué colores tenéis?\n- Colores?\n- Cómo es su personalidad?\n- Cómo es su temperamento?\n\n## Calculadora\n\nNombre: `Calculadora`\n\n**Utiliza SIEMPRE la herramienta “Calculadora” para operaciones matemáticas**\n\n## Fecha actual: “`{{ $now }}`\""}},"id":"19bcc25b-4ead-42a1-8b98-8b10a5fffb06","name":"Agente de IA","type":"@n8n/n8n-nodes-langchain.agent","position":[1280,832],"typeVersion":1.6},{"parameters":{"content":"## Whatsapp Trigger","height":280,"color":2},"type":"n8n-nodes-base.stickyNote","position":[-912,752],"typeVersion":1,"id":"4e8da221-bd4a-4d6c-ac30-7b1091f4dd6d","name":"Sticky Note"},{"parameters":{"content":"## Filtrador\n","height":280,"width":220,"color":2},"type":"n8n-nodes-base.stickyNote","position":[-608,752],"typeVersion":1,"id":"ffa93b1c-3d13-4286-ad49-b100f39ba8e4","name":"Sticky Note1"},{"parameters":{"content":"## Enrutador\n","height":280,"width":300,"color":2},"type":"n8n-nodes-base.stickyNote","position":[-336,752],"typeVersion":1,"id":"0532842a-9c9a-4450-b637-7102ff50b403","name":"Sticky Note2"},{"parameters":{"content":"## Imágenes","height":300,"width":760,"color":5},"type":"n8n-nodes-base.stickyNote","position":[32,1072],"typeVersion":1,"id":"f5e2dac8-b946-4fed-8430-36a954639731","name":"Sticky Note4"},{"parameters":{"content":"## Set Mensaje","height":240,"width":280,"color":4},"type":"n8n-nodes-base.stickyNote","position":[864,768],"typeVersion":1,"id":"db290ac9-9cb3-4abb-a20e-3e43e4c333bb","name":"Sticky Note6"},{"parameters":{"content":"## Agente de IA","height":240,"width":400,"color":7},"type":"n8n-nodes-base.stickyNote","position":[1200,768],"typeVersion":1,"id":"17d552de-0cc1-4bc0-9a5d-9d4a9c9ecdf9","name":"Sticky Note7"},{"parameters":{"content":"## Envíar Mensaje","height":240,"width":280},"type":"n8n-nodes-base.stickyNote","position":[1664,768],"typeVersion":1,"id":"1c8c059d-cad6-428a-82d7-3b5f82cbc53f","name":"Sticky Note8"},{"parameters":{"content":"## Memoria","height":220,"width":200,"color":6},"type":"n8n-nodes-base.stickyNote","position":[1136,1072],"typeVersion":1,"id":"362d5687-6b90-4325-a7c4-fad97aaebf07","name":"Sticky Note11"},{"parameters":{"content":"## Cerebro","height":220,"width":210,"color":6},"type":"n8n-nodes-base.stickyNote","position":[864,1072],"typeVersion":1,"id":"4b175f9a-064f-4a4b-bab1-97f4da9fa1df","name":"Sticky Note12"},{"parameters":{"assignments":{"assignments":[{"id":"23b785c3-f38e-4706-80b7-51f333bba3bd","name":"mensaje","type":"string","value":"={{ $json.text }}"}]},"options":{}},"id":"e9092504-067a-4638-b3a9-d185581873e1","name":"Obtener Mensaje","type":"n8n-nodes-base.set","position":[960,832],"typeVersion":3.4},{"parameters":{"content":"## Audio","height":300,"width":760,"color":5},"type":"n8n-nodes-base.stickyNote","position":[32,400],"typeVersion":1,"id":"a09b8dc2-c934-4799-995b-ed350b6fdc23","name":"Sticky Note10","disabled":true},{"parameters":{"content":"## Texto","height":240,"width":760,"color":5},"type":"n8n-nodes-base.stickyNote","position":[32,768],"typeVersion":1,"id":"36f30f44-143c-41ff-815b-1ad12a9b9431","name":"Sticky Note14","disabled":true},{"parameters":{"content":"## Base de Datos\n","height":220,"width":200,"color":6},"type":"n8n-nodes-base.stickyNote","position":[1664,1072],"typeVersion":1,"id":"2dc0537c-bfc4-4d0b-a403-d5ad23ca60f8","name":"Sticky Note15"},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"leftValue":"={{ $json.type }}","rightValue":"audio","operator":{"type":"string","operation":"equals"},"id":"18812d9b-1fa3-4ae4-869d-4b49a31380a7"}],"combinator":"and"},"renameOutput":true,"outputKey":"Audio"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"2dda82c7-467e-4695-8ce3-3e52eff08604","leftValue":"={{ $json.type }}","rightValue":"text","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"Texto"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"3428f9ae-9d54-44a3-948c-895d97036b8f","leftValue":"={{ $json.type }}","rightValue":"image","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"Imagen"}]},"options":{}},"id":"dd1f5e6e-50d9-4fbd-bdf9-4780297d4b05","name":"Switch","type":"n8n-nodes-base.switch","position":[-256,832],"typeVersion":3.2},{"parameters":{"fieldToSplitOut":"messages","options":{}},"id":"37d152a3-1cea-4167-8c66-cea8f4e27c9b","name":"Filtrardor","type":"n8n-nodes-base.splitOut","position":[-544,832],"typeVersion":1},{"parameters":{"updates":["messages"],"options":{}},"id":"b3c5f360-f69e-4165-91b8-ebeea5afc5fa","name":"WhatsApp Trigger","type":"n8n-nodes-base.whatsAppTrigger","position":[-832,832],"webhookId":"1ae70665-9cf1-43a2-b0b3-370a5b3e46b8","typeVersion":1,"disabled":true},{"parameters":{"url":"={{ $json.url }}","authentication":"predefinedCredentialType","nodeCredentialType":"whatsAppApi","options":{}},"id":"885a0c28-ee84-4811-8dfc-6f1569a35a57","name":"Descargar Audio","type":"n8n-nodes-base.httpRequest","position":[384,480],"typeVersion":4.2,"disabled":true},{"parameters":{"url":"={{ $json.url }}","authentication":"predefinedCredentialType","nodeCredentialType":"whatsAppApi","options":{}},"id":"bb6be194-de6f-44c9-bb8a-c6d42064549f","name":"Descargar Imagen","type":"n8n-nodes-base.httpRequest","position":[320,1120],"typeVersion":4.2,"disabled":true},{"parameters":{"resource":"media","operation":"mediaUrlGet","mediaGetId":"={{ $json.audio.id }}"},"id":"753c23d6-2020-442b-ba97-66750e203d1e","name":"Obtener URL | Audio","type":"n8n-nodes-base.whatsApp","position":[176,480],"typeVersion":1,"webhookId":"1096d33d-a46d-40ec-b7a7-d8b18f164626","disabled":true},{"parameters":{"amount":1},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[224,832],"id":"bac587c0-529c-4a2b-bd77-f2e64dc2e7ed","name":"Pausa","webhookId":"0bfa0972-a628-48bb-be5d-b3c30b33df0e"},{"parameters":{"operation":"send","phoneNumberId":"616116878254396","recipientPhoneNumber":"={{ $('Filtrardor').item.json.from }}","textBody":"={{ $('Agente de IA').item.json.output }}","additionalFields":{"previewUrl":false}},"id":"40be795a-8cda-43d4-b260-559aee543c1b","name":"Enviar Mensaje","type":"n8n-nodes-base.whatsApp","position":[1744,832],"typeVersion":1,"alwaysOutputData":false,"webhookId":"b27dce7e-5af9-4900-b048-4da35a68be05","disabled":true},{"parameters":{"model":"gpt-4o","options":{}},"id":"6404574b-436a-4c0e-9c8a-45baec62660b","name":"OpenAI Chat Model","type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1,"position":[912,1152],"credentials":{"openAiApi":{"id":"GXQnAcDQPSdhis7E","name":"OpenAi account 2"}}},{"parameters":{"content":"## Herramientas\n","height":220,"width":200,"color":6},"type":"n8n-nodes-base.stickyNote","position":[1392,1072],"typeVersion":1,"id":"39013b81-a06c-4b5d-a5ad-b43f80d9ef71","name":"Sticky Note16"},{"parameters":{},"type":"@n8n/n8n-nodes-langchain.toolCalculator","typeVersion":1,"position":[1456,1120],"id":"4a681dbb-0a33-466c-8ff6-25f21cab5bbd","name":"Calculadora"},{"parameters":{"documentId":{"__rl":true,"value":"1ZZk9cxQIiVNQSj9VPx4qaQWt30WWCoPsANg33lsReeI","mode":"list","cachedResultName":"Clientes","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1ZZk9cxQIiVNQSj9VPx4qaQWt30WWCoPsANg33lsReeI/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":2045006274,"mode":"list","cachedResultName":"Base_de_datos_ficticia__100_filas_","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1ZZk9cxQIiVNQSj9VPx4qaQWt30WWCoPsANg33lsReeI/edit#gid=2045006274"},"options":{}},"type":"n8n-nodes-base.googleSheetsTool","typeVersion":4.5,"position":[1712,1120],"id":"3ee2de88-1457-4258-9a90-0f8825627050","name":"Base de Datos","credentials":{"googleSheetsOAuth2Api":{"id":"8zUn17HAvdcPCK4t","name":"Google Sheets account 3"}}},{"parameters":{"model":"gpt-4o","options":{}},"id":"1fb6e527-9785-41c2-a381-0db98fa61d60","name":"OpenAI Chat Model #1","type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","position":[576,1248],"typeVersion":1,"credentials":{"openAiApi":{"id":"GXQnAcDQPSdhis7E","name":"OpenAi account 2"}}},{"parameters":{"promptType":"define","text":"=# Contexto\n\nRecibes como input  una imagen enviada por el usuario. \n\n# Tarea\n\nDescribe la imagen y transcribe cualquier texto visible.\n\n# Especificaciones\n\n Incluye tantos detalles como sea posible.","messages":{"messageValues":[{"type":"HumanMessagePromptTemplate","messageType":"imageBinary"}]}},"id":"0c07edd0-faed-4b4c-9638-e5c224f31b72","name":"Explicar Imagen","type":"@n8n/n8n-nodes-langchain.chainLlm","position":[496,1120],"typeVersion":1.4},{"parameters":{"assignments":{"assignments":[{"id":"d4b9efeb-9a68-43e3-bc4c-cd207510bddf","name":"text","value":"={{ $json.text.body }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[512,832],"id":"63e6dab8-459c-4057-8e4d-eb0f831f2feb","name":"Obtener Texto"},{"parameters":{"resource":"media","operation":"mediaUrlGet","mediaGetId":"={{ $json.image.id }}"},"id":"415b2dd6-ad5b-4dfb-919e-3bdf5b604c38","name":"Obtener URL | Imagen","type":"n8n-nodes-base.whatsApp","position":[144,1120],"typeVersion":1,"webhookId":"96221c60-5e7d-4b9e-be2c-19953c7f7f57","disabled":true}],"connections":{"Webhook":{"main":[[{"node":"Edit Fields","type":"main","index":0}]]},"Edit Fields":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"Simple Memory":{"ai_memory":[[{"node":"AI Agent","type":"ai_memory","index":0}]]},"AI Agent":{"main":[[{"node":"HTTP Request","type":"main","index":0}]]},"Groq Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"Postgres Chat Memory":{"ai_memory":[[{"node":"Agente de IA","type":"ai_memory","index":0}]]},"Transcribir Audio":{"main":[[{"node":"Obtener Mensaje","type":"main","index":0}]]},"Agente de IA":{"main":[[{"node":"Enviar Mensaje","type":"main","index":0}]]},"Obtener Mensaje":{"main":[[{"node":"Agente de IA","type":"main","index":0}]]},"Switch":{"main":[[{"node":"Obtener URL | Audio","type":"main","index":0}],[{"node":"Pausa","type":"main","index":0}],[{"node":"Obtener URL | Imagen","type":"main","index":0}]]},"Filtrardor":{"main":[[{"node":"Switch","type":"main","index":0}]]},"WhatsApp Trigger":{"main":[[{"node":"Filtrardor","type":"main","index":0}]]},"Descargar Audio":{"main":[[{"node":"Transcribir Audio","type":"main","index":0}]]},"Descargar Imagen":{"main":[[{"node":"Explicar Imagen","type":"main","index":0}]]},"Obtener URL | Audio":{"main":[[{"node":"Descargar Audio","type":"main","index":0}]]},"Pausa":{"main":[[{"node":"Obtener Texto","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"Agente de IA","type":"ai_languageModel","index":0}]]},"Calculadora":{"ai_tool":[[{"node":"Agente de IA","type":"ai_tool","index":0}]]},"Base de Datos":{"ai_tool":[[{"node":"Agente de IA","type":"ai_tool","index":0}]]},"OpenAI Chat Model #1":{"ai_languageModel":[[{"node":"Explicar Imagen","type":"ai_languageModel","index":0}]]},"Explicar Imagen":{"main":[[{"node":"Obtener Mensaje","type":"main","index":0}]]},"Obtener Texto":{"main":[[{"node":"Obtener Mensaje","type":"main","index":0}]]},"Obtener URL | Imagen":{"main":[[{"node":"Descargar Imagen","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"aa73aedf-4419-45ad-a65d-b49ec265e238","triggerCount":1,"shared":[{"createdAt":"2025-07-23T19:40:48.853Z","updatedAt":"2025-07-23T19:40:48.853Z","role":"workflow:owner","workflowId":"B94pv7VtJw6uVFJT","projectId":"95llCqXI9to4u1LV"}],"tags":[]}