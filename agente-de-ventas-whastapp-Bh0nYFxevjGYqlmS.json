{"createdAt":"2025-08-06T13:40:38.310Z","updatedAt":"2025-08-18T01:44:28.545Z","id":"Bh0nYFxevjGYqlmS","name":"Agente de Ventas WhastApp","active":false,"isArchived":false,"nodes":[{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"leftValue":"={{ $json.body.messages[0].text.body }}","rightValue":"={{ $json.body.messages[0].text }}","operator":{"type":"string","operation":"exists","singleValue":true},"id":"2b435080-f3be-45bd-9ee2-461289d81771"}],"combinator":"and"},"renameOutput":true,"outputKey":"Texto"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"ce02913f-6854-4bc5-915f-b6073adb64ab","leftValue":"={{ $json.body.messages[0].voice.id }}","rightValue":"={{ $json.body.messages[0].voice }}","operator":{"type":"string","operation":"exists","singleValue":true}}],"combinator":"and"},"renameOutput":true,"outputKey":"Audio"}]},"options":{}},"type":"n8n-nodes-base.switch","typeVersion":3.2,"position":[560,80],"id":"c8e5bf85-86b4-4ef1-b39b-537a81cb4faa","name":"Switch"},{"parameters":{"assignments":{"assignments":[{"id":"28b24f3b-4510-46f6-b1a6-89cdf9e64858","name":"Texto","value":"={{ $json.body.messages[0].text.body }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[1024,80],"id":"efef6dc5-b503-4574-a600-3aaa9d143bc4","name":"Captura Texto"},{"parameters":{"assignments":{"assignments":[{"id":"e9956d73-5ef2-4ebc-8037-bbe5c51ba5eb","name":"nombre_producto","value":"={{ $json.output }}","type":"string"},{"id":"6ad01576-7555-472d-b02d-f8b3690e6ca2","name":"CHAT_ID","value":"={\n  \"chatId\": \"{{ $json.text }}\"\n}\n","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[992,560],"id":"a6482096-ff0c-4f2e-b60f-be09a4aaf66d","name":"Edit Fields"},{"parameters":{"method":"POST","url":"https://evolution.dployxperts.com/message/sendText","sendHeaders":true,"specifyHeaders":"json","jsonHeaders":"={\n  \"Authorization\": \"AA43DB55DCA9-40CF-8303-323E0C1A859F\",  \n  \"Content-Type\": \"application/json\",\n  \"Accept\": \"application/json\"\n}\n","sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"to\": \"{{ $('WHATSAPP').item.json.body.messages[0].chat_id }}\",\n  \"body\": \"{{ $json.output }}\",\n  \"typing_time\": 2.5\n}\n\n","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[1680,560],"id":"bb8fe003-f8da-4362-90f2-c9017ffe5767","name":"Saludo Whatsapp"},{"parameters":{"method":"POST","url":"https://evolution.dployxperts.com/message/image","sendHeaders":true,"specifyHeaders":"json","jsonHeaders":"{\n  \"Authorization\": \"Bearer AA43DB55DCA9-40CF-8303-323E0C1A859F\",\n  \"Content-Type\": \"application/json\",\n  \"Accept\": \"application/json\"\n}\n","sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"to\": \"{{ $('WHATSAPP').item.json.body.messages[0].chat_id }}\",\n \"media\": \"{{ $('Code1').item.json.media }}\"\n}\n","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[1872,560],"id":"b3e6e23c-a5cd-45bc-8efd-4020c5baa6fb","name":"Env√≠o Imagen Producto"},{"parameters":{"model":{"__rl":true,"value":"gpt-4o-mini","mode":"list","cachedResultName":"gpt-4o-mini"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[208,848],"id":"04fc8edb-feb6-4205-a33e-0c1ebb519fd4","name":"OpenAI Chat Model","credentials":{"openAiApi":{"id":"GXQnAcDQPSdhis7E","name":"OpenAi account 2"}}},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"c15efbaa-3769-4b3b-852a-c9a1af203b39","leftValue":"={{ $('IA INTENCI√ìN CLIENTE').item.json.output }}","rightValue":"crema_antiarrugas.jpg","operator":{"type":"string","operation":"contains"}}],"combinator":"and"},"renameOutput":true,"outputKey":"SOLICITUD_CREMA"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"02888f76-de43-438a-a12e-7f54c4f977ee","leftValue":"={{ $('IA INTENCI√ìN CLIENTE').item.json.output }}","rightValue":"gotas_ansiedad.jpg","operator":{"type":"string","operation":"contains"}}],"combinator":"and"},"renameOutput":true,"outputKey":"SOLICITUD_GOTAS"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"leftValue":"={{ $('IA INTENCI√ìN CLIENTE').item.json.output }}","rightValue":"=CONVERSACION","operator":{"type":"string","operation":"contains"},"id":"bd5d8ce2-56c9-40e2-9994-469a412f6549"}],"combinator":"and"},"renameOutput":true,"outputKey":"CONTINUAR CONVERSACI√ìN"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"ca803938-7b1c-49a4-8c0e-b9eb3e92ba9b","leftValue":"={{ $json.output }}","rightValue":"=PRECIO","operator":{"type":"string","operation":"contains"}}],"combinator":"and"},"renameOutput":true,"outputKey":"PRECIO"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"a640729a-001d-4f55-a10a-5b5cb3a793a4","leftValue":"={{ $json.output }}","rightValue":"=COMPRAR","operator":{"type":"string","operation":"contains"}}],"combinator":"and"},"renameOutput":true,"outputKey":"COMPRA"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"47435f1c-e0b0-4420-ac7c-7d6f36529017","leftValue":"={{ $json.output }}","rightValue":"=SERVICIOS","operator":{"type":"string","operation":"contains"}}],"combinator":"and"},"renameOutput":true,"outputKey":"SERVICIOS"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"795bcd84-45b1-4d60-be9a-df04eb83ca63","leftValue":"={{ $json.output }}","rightValue":"=NO DISPONIBLE","operator":{"type":"string","operation":"contains"}}],"combinator":"and"},"renameOutput":true,"outputKey":"NO DISPONIBLE"}]},"options":{}},"type":"n8n-nodes-base.switch","typeVersion":3.2,"position":[640,560],"id":"5f538814-c432-4caa-b3b2-3ae92e886ab6","name":"Switch1"},{"parameters":{"promptType":"define","text":"={{ $json.output }}","options":{"systemMessage":"=Eres el asistente virtual de Spa Niurka Vital, un spa que ofrece productos y servicios de bienestar.\nRespondes por WhatsApp como si fueras una persona real del equipo: cercana, c√°lida, humana y profesional.\nTus respuestas deben ser cortas, amables, sin rodeos, en una sola l√≠nea y con m√°ximo 1 emoji. Evita frases robotizadas o largas.\n\nüì• CONTEXTO DEL CLIENTE\nMensaje del cliente: {{ $('Code').item.json.text }}\nEtiqueta detectada: {{ $json.output }}\n\nüîÅ MEMORIA Y SALUDO INICIAL\nAntes de responder, verifica la memoria:\n\nSi hola = true, no saludes.\n\nSi hola no existe, significa que es el primer mensaje del cliente.\nüëâ En ese caso, elige aleatoriamente uno de estos saludos c√°lidos y agradables:\n\n\"¬°Hola! Qu√© alegr√≠a tenerte por aqu√≠ üòä ¬øEn qu√© te puedo ayudar hoy?\"\n\n\"¬°Hola! Bienvenid@ a Spa Niurka Vitalüåø Cu√©ntame, ¬øqu√© est√°s buscando?\"\n\n\"¬°Hola! ¬øC√≥mo est√°s? Gracias por escribirnos a Spa Niurka Vital üíñ\"\n\nDespu√©s de saludar por primera vez, guarda esto en la memoria:\nhola = true\n\nüß¥ PRODUCTOS Y PRECIOS\n\ngotas_ansiedad.jpg ‚Üí Gotas para la ansiedad: $32\n\ncrema_antiarrugas.jpg ‚Üí Crema antiarrugas: $45\n\nüéØ RESPUESTAS SEG√öN LA ETIQUETA (si coincide con el texto):\n\nEtiqueta: crema_antiarrugas.jpg\n\"Me encanta esta crema, deja la piel s√∫per suave y rejuvenecida ‚ú®\"\n\nEtiqueta: gotas_ansiedad.jpg\n\"Estas gotas me ayudaron mucho en d√≠as de estr√©s. Son naturales y efectivas üçÉ\"\n\nEtiqueta: PRECIO\n\"Vale $32. Yo las prob√© y me ayudaron a dormir mejor üåø\"\n\nEtiqueta: COMPRAR\n\"Perfecto. Pago M√≥vil Banco Mercantil, V.- 00.000.000, 0412-000-0000. M√°ndame el comprobante y ya con eso seguimos üìù\"\n\nEtiqueta: NO DISPONIBLE\n\"Por ahora no contamos con eso, pero puedo ayudarte a elegir algo que te guste.\"\n\nEtiqueta: SERVICIOS\n\"Tenemos masajes relajantes de 30 y 60 minutos. Son una delicia.\"\n\nEtiqueta: CONVERSACION\nSi hola = true, responde con amabilidad sin saludar.\nSi hola no existe, usa uno de los saludos c√°lidos definidos arriba y guarda hola = true.\n\n‚ö†Ô∏è SI LA ETIQUETA NO COINCIDE CON EL TEXTO\nIgnora la etiqueta y responde solo seg√∫n el contenido del mensaje.\n\nüö´ REGLAS FINALES\n\nNo repitas saludos.\n\nNo inventes productos.\n\nNo uses m√°s de 1 emoji por mensaje.\n\nSolo responde una l√≠nea por turno.\n\nNo escribas explicaciones t√©cnicas ni menciones internas de etiquetas o flujos."}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2,"position":[1120,1008],"id":"4a014804-5912-44a5-ab76-d81fc96911e3","name":"AI CONVERSACI√ìN"},{"parameters":{"model":{"__rl":true,"mode":"list","value":"gpt-4.1-mini"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[1104,1200],"id":"789cd1f9-a413-446f-8410-cb44cd560e1a","name":"OpenAI Chat Model1","credentials":{"openAiApi":{"id":"GXQnAcDQPSdhis7E","name":"OpenAi account 2"}}},{"parameters":{"jsCode":"let extractedText = '';\n\nfor (const item of items) {\n  if (item.json.text && item.json.text.trim() !== '') {\n    extractedText = item.json.text.trim();\n    break;\n  }\n  if (item.json.Texto && item.json.Texto.trim() !== '') {\n    extractedText = item.json.Texto.trim();\n    break;\n  }\n}\n\nreturn [{ json: { text: extractedText } }];\n\n\n\n\n\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[1424,256],"id":"80902177-6324-494c-87bc-8429be30692a","name":"Code"},{"parameters":{"method":"POST","url":"https://evolution.dployxperts.com/message/sendText","sendHeaders":true,"specifyHeaders":"json","jsonHeaders":"={\n  \"Authorization\": \"AA43DB55DCA9-40CF-8303-323E0C1A859F\",  \n  \"Content-Type\": \"application/json\",\n  \"Accept\": \"application/json\"\n}\n","sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"to\": \"{{ $('WHATSAPP').item.json.body.messages[0].chat_id }}\",\n  \"body\": \"{{ $('AI CONVERSACI√ìN').item.json.output }}\",\n  \"typing_time\": {{ ($json.delay * 3) / 1000 }}\n}\n","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[1600,1008],"id":"a1775b61-b0ce-4a4c-aec7-37106dfe1d95","name":"Continuar Conversaci√≥n"},{"parameters":{"resource":"audio","operation":"transcribe","options":{}},"type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":1.8,"position":[1168,256],"id":"36d81e10-4127-4dae-94b1-2c4aab8ed844","name":"Transcribe Audio","credentials":{"openAiApi":{"id":"GXQnAcDQPSdhis7E","name":"OpenAi account 2"}}},{"parameters":{"promptType":"define","text":"={{ $json.text }}","hasOutputParser":true,"options":{"systemMessage":"=Eres un asistente que clasifica mensajes de clientes en una de estas intenciones claras, usando palabras clave y contexto. Tu tarea es identificar la intenci√≥n principal del mensaje, sin adivinar ni extenderte.\n\n---\n\nüîπ CATEGOR√çAS POSIBLES:\n\n1. **crema_antiarrugas.jpg** ‚Üí Si el mensaje menciona exactamente ‚Äúcrema‚Äù y ‚Äúantiarrugas‚Äù juntos.\n\n2. **gotas_ansiedad.jpg** ‚Üí Si el mensaje menciona exactamente ‚Äúgotas‚Äù y ‚Äúansiedad‚Äù juntos.\n\n3. **COMPRAR** ‚Üí El cliente expresa intenci√≥n clara de adquirir algo.\nPalabras clave t√≠picas: ‚Äúquiero comprar‚Äù, ‚Äúme interesa‚Äù, ‚Äúc√≥mo pago‚Äù, ‚Äúcompra‚Äù, ‚Äúordenar‚Äù.\n\n4. **PRECIO** ‚Üí Pregunta exclusivamente por el valor o costo.\nPalabras clave t√≠picas: ‚Äúcu√°nto cuesta‚Äù, ‚Äúprecio‚Äù, ‚Äúcosto‚Äù, ‚Äúvalor‚Äù, ‚Äútarifa‚Äù.\n\n5. **SERVICIOS** ‚Üí Pregunta por servicios que ofrece el spa.\nPalabras clave t√≠picas: ‚Äúqu√© servicios‚Äù, ‚Äúmasajes‚Äù, ‚Äútratamientos‚Äù, ‚Äúaromaterapia‚Äù, ‚Äúu√±as‚Äù.\n\n6. **CONVERSACION** ‚Üí Mensajes cortos, saludos o sin intenci√≥n clara de compra.\nEjemplos: ‚Äúhola‚Äù, ‚Äúbuenos d√≠as‚Äù, ‚Äúgracias‚Äù, ‚Äúqu√© tal‚Äù, ‚Äúc√≥mo est√°s‚Äù, ‚Äúhey‚Äù.\n\n7. **NO DISPONIBLE** ‚Üí Menciones de productos que no est√°n en el cat√°logo (por ejemplo, ‚Äúcrema piel grasa‚Äù, ‚Äúsuero facial‚Äù, etc.).\n\n---\n\nüéØ REGLAS CLAVE:\n\n- Solo responde con una **etiqueta exacta** de esta lista:  \n  `crema_antiarrugas.jpg`, `gotas_ansiedad.jpg`, `COMPRAR`, `PRECIO`, `SERVICIOS`, `CONVERSACION`, `NO DISPONIBLE`.\n\n- **No escribas saludos, comentarios ni explicaciones. Solo la etiqueta exacta.**\n\n---\n\nüìå EJEMPLOS:\n\n‚Äú¬øTienen crema antiarrugas?‚Äù ‚Üí crema_antiarrugas.jpg  \n‚ÄúQuiero comprar gotas para la ansiedad‚Äù ‚Üí COMPRAR  \n‚Äú¬øCu√°nto cuesta la crema antiarrugas?‚Äù ‚Üí PRECIO  \n‚Äú¬øQu√© servicios ofrecen?‚Äù ‚Üí SERVICIOS  \n‚ÄúHola, ¬øc√≥mo est√°s?‚Äù ‚Üí CONVERSACION  \n‚ÄúBusco crema para piel grasa‚Äù ‚Üí NO DISPONIBLE\n\n---\n\nüß† CONTEXTO:\n\nEste es el mensaje del cliente:  \n**{{ $json.text }}**\n\nAhora clasif√≠calo con precisi√≥n, siguiendo las reglas anteriores.  \nSolo responde una de las 7 etiquetas exactas.\n"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2,"position":[272,640],"id":"8b44ab51-b3f3-488e-b0e7-818a107df253","name":"IA INTENCI√ìN CLIENTE"},{"parameters":{"assignments":{"assignments":[{"id":"311ec3ab-22f8-458b-a2b5-caa1c9b5b725","name":"delay","value":"={{ ($json.output.length + 40) * 5 }}\n\n\n\n\n","type":"number"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[1440,1008],"id":"703dce51-afe5-4a8a-a171-3d70bba0332a","name":"Edit Fields1"},{"parameters":{"model":{"__rl":true,"mode":"list","value":"gpt-4.1-mini"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[1344,752],"id":"30149242-5492-4fde-8070-7e72ed8be5bc","name":"OpenAI Chat Model2","credentials":{"openAiApi":{"id":"GXQnAcDQPSdhis7E","name":"OpenAi account 2"}}},{"parameters":{"jsCode":"const producto = ($json[\"nombre_producto\"] || \"\").toLowerCase().replace(\".jpg\", \"\").trim();\n\nconst chatId = $json[\"to\"] || $('WHATSAPP').item.json.body.messages[0].chat_id;\n\nlet urlImagen = \"\";\n\nif (producto.includes(\"gotas\")) {\n  urlImagen = \"https://i.ibb.co/5g1Tztny/gotas-ansiedad.jpg\";\n} else if (producto.includes(\"crema\")) {\n  urlImagen = \"https://i.ibb.co/5WXZHfRT/crema-antiarrugas.jpg\";\n} else {\n  urlImagen = \"https://i.ibb.co/5WXZHfRT/crema-antiarrugas.jpg\"; // fallback\n}\n\nreturn [{\n  json: {\n    to: chatId,\n    media: urlImagen,\n    productoRecibido: producto\n  }\n}];\n\n\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[1184,560],"id":"5156b9d5-4326-4ab6-a150-2c593b6dd7f3","name":"Code1"},{"parameters":{"sessionIdType":"customKey","sessionKey":"={{ $('WHATSAPP').item.json.body.messages[0].chat_id }}","contextWindowLength":10},"type":"@n8n/n8n-nodes-langchain.memoryBufferWindow","typeVersion":1.3,"position":[1264,1200],"id":"035334e5-8540-4db8-91c3-ed841a384a36","name":"Simple Memory"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"dac10c31-9f63-43c2-891c-98a363fcba1f","leftValue":"={{ $json.body.messages[0].from_me }}","rightValue":"","operator":{"type":"boolean","operation":"false","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[288,112],"id":"b81072b5-7e2c-484b-bdcb-bf8171aa3096","name":"If","onError":"continueRegularOutput"},{"parameters":{},"type":"n8n-nodes-base.noOp","typeVersion":1,"position":[464,288],"id":"4cdc87ae-254f-4c4a-b118-b178b202dcbc","name":"No Operation, do nothing"},{"parameters":{"sessionIdType":"customKey","sessionKey":"={{ $json.text }}","contextWindowLength":10},"type":"@n8n/n8n-nodes-langchain.memoryBufferWindow","typeVersion":1.3,"position":[368,848],"id":"08eb6b99-6e2d-4fed-8579-cb4b11e93a2d","name":"Simple Memory1"},{"parameters":{"sessionIdType":"customKey","sessionKey":"={{ $('WHATSAPP').item.json.body.messages[0].chat_id }}","contextWindowLength":10},"type":"@n8n/n8n-nodes-langchain.memoryBufferWindow","typeVersion":1.3,"position":[1504,752],"id":"ce9d65e9-5bc9-460e-b706-895a1af3def9","name":"Simple Memory2","notesInFlow":false},{"parameters":{"promptType":"define","text":"={{ $('Code').item.json.text }}","options":{"systemMessage":"=Eres el asistente virtual de Spa Niurka Vital, un spa que ofrece productos y servicios de bienestar.\nRespondes por WhatsApp como si fueras parte del equipo humano: de forma c√°lida, profesional y natural.\nUsa frases cortas, amables, confiables y sin rodeos. Nunca parezcas un robot.\n\nüß† L√ìGICA DE SALUDO (usa solo la memoria, no el JSON)\nAntes de responder, revisa si en la memoria existe la variable hola.\n\nSi hola es igual a true, significa que ya saludaste antes. üëâ En ese caso, responde directo, sin decir \"Hola\".\n\nSi hola no existe en la memoria, significa que es la primera vez que hablas con el cliente. üëâ Entonces, elige aleatoriamente uno de estos tres saludos y √∫salo tal cual, sin cambiarlo:\n\n¬°Hola! ¬øC√≥mo est√°s? Gracias por escribirnos a Spa Aura üíñ\n\n¬°Hola! Qu√© alegr√≠a tenerte por aqu√≠ üòä\n\n¬°Hola! Bienvenid@ a Spa Niurka Vital, ¬øc√≥mo te podemos ayudar? üåø\n\nDespu√©s del saludo, responde directamente seg√∫n la etiqueta, en la misma l√≠nea.\nAl terminar, guarda esto en memoria:\n\n{\"hola\": true}\n\n‚ö†Ô∏è Si el mensaje del cliente contiene tanto un saludo como una pregunta sobre un producto o servicio (por ejemplo: ‚ÄúHola, ¬øtienes gotas para la ansiedad?‚Äù), haz ambas cosas en una sola l√≠nea: saluda (si es la primera vez) y responde inmediatamente sobre el producto. No repitas el saludo.\n\n‚ö†Ô∏è Nunca adivines si ya saludaste o no. Decide solo con base en la memoria hola.\n\nüì• CONTEXTO DEL MENSAJE DEL CLIENTE\nTexto recibido:\n{{ $json.text }}\n\nEtiqueta detectada:\n{{ $json.output }}\n\nID de conversaci√≥n:\n{{ $('Code').item.json.chatId }}\n\nüéØ RESPUESTAS SEG√öN LA ETIQUETA\nüß¥ Etiqueta: crema_antiarrugas.jpg\nFrase c√°lida y natural describiendo la crema. M√°ximo un emoji.\n\nEjemplos:\n\nEsta crema me la aplico para firmeza y textura. Te va a encantar ‚ú®\n\nEsta es de las favoritas para arrugas. Te deja la piel suavecita üëå\n\nüíß Etiqueta: gotas_ansiedad.jpg\nFrase personal sobre las gotas. M√°ximo un emoji.\n\nEjemplos:\n\nEstas goticas me han servido mucho en d√≠as de estr√©s. Mira üëá\n\nEstas son las m√°s pedidas para relajarse. Te van a caer buen√≠simo üòå\n\nüí∞ Etiqueta: PRECIO\nSolo el precio + comentario personal. Nunca saludes.\n\nüõí Etiqueta: COMPRAR\nSolo datos de pago. Nunca saludes.\n\n‚ùå Etiqueta: NO DISPONIBLE\nMensaje c√°lido, sin saludo, ofreciendo alternativas.\n\nüíÜ‚Äç‚ôÄÔ∏è Etiqueta: SERVICIOS\nFrase corta sobre servicios. No saludes si ya lo hiciste.\n\nüí¨ Etiqueta: CONVERSACION\nSaludo breve solo si no se ha saludado antes. Si ya saludaste, responde con amabilidad.\n\n‚ö†Ô∏è REGLAS FINALES\nNunca repitas saludos. Usa solo la memoria.\n\nSolo una frase por turno.\n\nM√°ximo un emoji por mensaje.\n\nTodo en una sola l√≠nea.\n\nNo inventes. Responde solo con base en la etiqueta y la memoria.\n"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2,"position":[1360,560],"id":"d5e5fd73-8f32-4fe3-bf71-4c3793f00a83","name":"SALUDO INICIAL"},{"parameters":{"url":"={{ $('WHATSAPP').item.json.body.messages[0].voice.link }}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[960,256],"id":"eb1fa0c3-7d66-4211-9bc4-724bdb4baa55","name":"Capturar Audio"},{"parameters":{"content":"**RECEPCI√ìN DE MENSAJE WHATSAPP**\n","height":416,"width":736,"color":4},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[0,0],"id":"1b08840a-1436-4f45-9e3f-d3d575018abc","name":"Sticky Note"},{"parameters":{"content":"**PROCESAMIENTO DE MENSAJE**\n\n","height":416,"width":732,"color":5},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[880,0],"id":"b9b19107-3872-4360-a03e-024aa83fa635","name":"Sticky Note1"},{"parameters":{"content":"**AN√ÅLISIS INTENCI√ìN CLIENTE**","height":448,"width":816,"color":6},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[96,528],"id":"a53f79bb-1e5f-4f55-accc-6075b45142bc","name":"Sticky Note2"},{"parameters":{"httpMethod":"POST","path":"whatsapp","options":{}},"type":"n8n-nodes-base.webhook","typeVersion":2,"position":[48,112],"id":"70ad8e1e-ecc8-43df-823a-474b6b53c923","name":"WHATSAPP","webhookId":"be54a501-5cad-4d1f-b835-70ba8c6c0a9c"},{"parameters":{"content":"**SALUDO INICIAL Y ENV√çO IMAGEN**","height":400,"width":1092},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[960,480],"id":"c752b097-88a0-405c-9a0c-5b9ef6679c42","name":"Sticky Note3"},{"parameters":{"content":"**CONVERSACI√ìN Y CIERRE DE VENTA**","height":448,"width":776,"color":3},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[1040,928],"id":"a5a0845f-f191-496e-96f8-717fb8ebfcfc","name":"Sticky Note4"},{"parameters":{"promptType":"define","text":"=Nombre del usuario al que te diriges: {{ $('Webhook').item.json.body.data.pushName }}\n\nContenido del mensaje del usuario: {{ $json.concat_message }}","options":{"systemMessage":"=# Descripci√≥n General:\nEres un asistente virtual amigable y cordial tu nombre es  \"Ana\". Tu funci√≥n es ayudar respondiendo √∫nicamente preguntas e inquietudes. Siempre debes responder con un tono humano, c√°lido, respetuoso y claro, como si fueras una persona muy atenta.\n\nCuando inicies una conversaci√≥n nueva con un usuario, comienza present√°ndote con tu nombre. \n\nvalida el id del chat para garantizar que no vuelvas a presentarte con tu nombre si ya has interactuado con el usuario. \n\nEn todo momento usa un lenguaje profesional, cordial y accesible.\n\nCuando el usuario escriba la palabra \"humano\" ejecuta la tool \"Humano\".\n\nVerifica tu memoria para mantener la continuidad del tema.\n\nDebes responder en un contexto de 400 caracteres como m√°ximo."}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2.1,"position":[2816,1936],"id":"24fb1a07-7dfe-4da9-89b4-88aafb96a55d","name":"AI Agent"},{"parameters":{"method":"POST","url":"=https://evolution.dployxperts.com/message/sendText/{{ $('Webhook').item.json.body.instance }}","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Content-Type","value":"application/json"},{"name":"apikey","value":"odnDxZwWPEwo1vjKStths8X7MqNMyIa1"}]},"sendBody":true,"bodyParameters":{"parameters":[{"name":"number","value":"={{ $('data message extraction').item.json.session_id }}\n"},{"name":"text","value":"={{ $json.output }}   "}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[3136,1936],"id":"dfd021a3-516b-4b0d-8752-afc4a1eec0c8","name":"HTTP Request"},{"parameters":{"operation":"toBinary","sourceProperty":"voice_message","options":{"mimeType":"=audio/ogg"}},"type":"n8n-nodes-base.convertToFile","typeVersion":1.1,"position":[928,2160],"id":"c883af7a-f140-4f53-b808-b03d56a03260","name":"Convertir a audio/ogg1"},{"parameters":{"sessionIdType":"customKey","sessionKey":"={{ $json.session_id }}","tableName":"chat_histories","contextWindowLength":10},"type":"@n8n/n8n-nodes-langchain.memoryPostgresChat","typeVersion":1.3,"position":[2912,2208],"id":"2efc137e-e88c-427d-9032-6b14edcaf463","name":"Memory1"},{"parameters":{"assignments":{"assignments":[{"id":"4da0c911-2775-4c65-b050-bbe819fa4db4","name":"sender","value":"={{ $('Verificar quien Escribe').item.json.body.data.key.senderLid }}","type":"string"},{"id":"43fdfc41-155a-4318-b06b-5089f5377513","name":"message_type","value":"={{ $('Webhook').item.json.body.data.messageType }}","type":"string"},{"id":"4ef29d6d-9a23-4aab-b777-ac4f2d9861cb","name":"text_message","value":"={{ $('Webhook').item.json.body.data.message.conversation }}","type":"string"},{"id":"81ae8ddc-f3d4-4f7b-b5d6-4bfebd02adbd","name":"voice_message","value":"={{ $('Webhook').item.json.body.data.message.base64 }}","type":"string"},{"id":"5a9a7ae9-ce91-4634-ad5c-fb0d446aabac","name":"session_id","value":"={{ $('Webhook').item.json.body.data.key.remoteJid.split('@')[0] }}","type":"string"},{"id":"cf8e5bf6-5c0e-4308-9ed4-a47fffadbb36","name":"date_time","value":"={{ $('Webhook').item.json.body.date_time }}","type":"string"},{"id":"2acddf8f-dca4-410f-b444-5e8d922a9fcf","name":"name","value":"={{ $('Webhook').item.json.body.data.pushName }}\n\n","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[656,2128],"id":"3a162b81-4cd5-430d-b06c-3925aa9aa5d2","name":"data message extraction"},{"parameters":{"assignments":{"assignments":[{"id":"a386845c-a9a6-4cad-b816-5e8fd5a49779","name":"final_message_voice","value":"={{ $json.text }}","type":"string"},{"id":"fa5968d2-69af-4068-b921-05e39a112aa9","name":"session_id","value":"={{ $('data message extraction').item.json.session_id }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[1520,2160],"id":"d57f4ff6-5d93-4948-98c4-f0f1dc1e8184","name":"final_message_voice"},{"parameters":{"assignments":{"assignments":[{"id":"5231578b-a0b5-4dfc-962c-35efbc97ce15","name":"final_message_text","value":"={{ $json.text_message }}","type":"string"},{"id":"dab6d3ca-8bf8-4c25-9c08-6c0fc5f9ebcf","name":"session_id","value":"={{ $('data message extraction').item.json.session_id }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[1200,1920],"id":"963ac3a2-17c6-48a6-90b0-1438640e9725","name":"final_message_text"},{"parameters":{"assignments":{"assignments":[{"id":"5231578b-a0b5-4dfc-962c-35efbc97ce15","name":"final_message","value":"={{ $json.final_message_text }} {{ $json.final_message_voice }}","type":"string"},{"id":"dab6d3ca-8bf8-4c25-9c08-6c0fc5f9ebcf","name":"session_id","value":"={{ $('data message extraction').item.json.session_id }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[1520,1920],"id":"cb395a95-d18f-44e1-9d97-415457d685be","name":"final_message"},{"parameters":{"operation":"push","list":"={{ $('data message extraction').item.json.sender }}","messageData":"={{ JSON.stringify({\n  message: $json.final_message,\n  session_id: $('data message extraction').item.json.session_id,\n  date_time: $('data message extraction').item.json.date_time\n}) }}\n","tail":true},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[1872,1920],"id":"876d8cbb-d2b3-4903-8ab7-645fcd2f17a9","name":"buffer"},{"parameters":{"operation":"get","propertyName":"message","key":"={{ $('data message extraction').item.json.sender }}","options":{}},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[2176,1920],"id":"a677b24a-b89b-47b8-9d14-18eaa03ad71b","name":"get_buffer_data"},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"leftValue":"={{ JSON.parse($json.message.last()).session_id  }}","rightValue":"={{ $('data message extraction').item.json.session_id }}","operator":{"type":"string","operation":"notEquals"},"id":"a30f0c20-2d06-4917-93bf-2cb7c6ff983e"}],"combinator":"and"},"renameOutput":true,"outputKey":"Ignorar"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"f188df3b-dea6-4ce2-a53e-ddc1b1f02e1d","leftValue":"={{ JSON.parse($json.message.last()).date_time  }}","rightValue":"={{ $now.minus(20,'seconds').toLocal() }}","operator":{"type":"dateTime","operation":"before"}}],"combinator":"and"},"renameOutput":true,"outputKey":"Continuar"}]},"options":{"fallbackOutput":"extra","renameFallbackOutput":"Esperar"}},"type":"n8n-nodes-base.switch","typeVersion":3.2,"position":[2320,1904],"id":"e0a5edf5-567a-4732-8590-aef54a64301e","name":"Switch2"},{"parameters":{"amount":20},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[2336,2176],"id":"0f22f667-6212-4950-9d3e-80755955d6b0","name":"Wait","webhookId":"56271429-b6c3-493a-8bfe-f3a2be62c7a3"},{"parameters":{"operation":"delete","key":"={{ $('data message extraction').item.json.sender }}"},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[2544,1920],"id":"12c4f55c-a71f-4f7b-b82d-87d302702a67","name":"Delete_buffer"},{"parameters":{"assignments":{"assignments":[{"id":"fdaaa5c7-a1a8-4f0f-b775-dbb1df5f754e","name":"concat_message","value":"={{ $json.message.map(m=> JSON.parse(m).message).join('\\n') }}","type":"string"},{"id":"dbb5014c-ccc9-4aed-bdee-a2e90092c775","name":"session_id","value":"={{ $('data message extraction').item.json.sender }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[2560,2224],"id":"89dfab59-7f18-4f2c-8b06-90e52f097f70","name":"Un_solo_message"},{"parameters":{},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[2016,1920],"id":"a13ac665-7bc2-441d-9c52-c42531389e39","name":"Wait1","webhookId":"dd4c5ad2-cf80-47d8-aad8-cd4e61cd7d24"},{"parameters":{"sseEndpoint":"https://n8n.dployxperts.com/mcp/27dd4208-4407-4413-a270-1302d812e60e/sse"},"type":"@n8n/n8n-nodes-langchain.mcpClientTool","typeVersion":1,"position":[3552,2192],"id":"6d841cbe-72f9-400e-9af9-0f8d9bc744ab","name":"MCP Gmail","disabled":true},{"parameters":{"sseEndpoint":"https://n8n.dployxperts.com/mcp/336d6b12-6aaf-4ebc-bd5b-c682313cd94f/sse"},"type":"@n8n/n8n-nodes-langchain.mcpClientTool","typeVersion":1,"position":[3264,2192],"id":"716daff2-1bfe-4f94-92d9-6671f05d8c16","name":"MCP Calendario","disabled":true},{"parameters":{"sseEndpoint":"https://n8n.dployxperts.com/mcp/33322373-5080-4e97-b468-f0f40f6686d9/sse"},"type":"@n8n/n8n-nodes-langchain.mcpClientTool","typeVersion":1,"position":[3408,2192],"id":"f0062d4d-0432-4c7e-99c1-a144bb9560b3","name":"MCP Contactos","disabled":true},{"parameters":{"resource":"audio","operation":"transcribe","options":{}},"type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":1.8,"position":[1200,2160],"id":"7d2ee3b3-8133-4780-b3ca-fd12d5aeefe3","name":"Transcribir Audio","credentials":{"openAiApi":{"id":"GXQnAcDQPSdhis7E","name":"OpenAi account 2"}}},{"parameters":{},"type":"n8n-nodes-base.noOp","typeVersion":1,"position":[560,1824],"id":"d749dde7-b8cb-4dc9-aea5-164c5a832c8a","name":"No Operation, do nothing1"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"064bc845-5c7d-4c02-9d20-57d780823da9","leftValue":"={{ $json['bot-state'] }}","rightValue":"blocked-bot","operator":{"type":"string","operation":"equals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[416,2272],"id":"0fa30fde-07ad-4d6f-bb21-510dde1c1cb6","name":"If3"},{"parameters":{"operation":"delete","key":"={{ $('Webhook').item.json.body.data.key.remoteJid }}"},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[224,1808],"id":"f967c335-83e9-40c7-97af-fa1a1c28eda8","name":"Activar Bot"},{"parameters":{"operation":"set","key":"={{ $('Webhook').item.json.body.data.key.remoteJid }}","value":"blocked-bot","expire":true,"ttl":300},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[224,2032],"id":"aa8a34a6-69cc-478e-aab5-202c20d7d8bb","name":"Bloquea al Agente"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"4b226403-e859-4d73-b14a-5cdc22e85e3c","leftValue":"={{ $('Webhook').item.json.body.data.message.conversation }}","rightValue":".","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-112,1936],"id":"b6dd4471-58a6-42a1-b487-62dec60652da","name":"Verificar palabra Clave"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"c8b64fab-0278-4873-94b1-665efa5c4f76","leftValue":"={{ $('Webhook').item.json.body.data.key.fromMe }}","rightValue":"","operator":{"type":"boolean","operation":"true","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-320,2064],"id":"ceb44dec-79dd-4d7d-a8df-4d6254f2b30a","name":"Verificar quien Escribe"},{"parameters":{"operation":"get","propertyName":"bot-state","key":"={{ $('Webhook').item.json.body.data.key.remoteJid }}","options":{}},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[208,2272],"id":"7ca6eebe-c6d5-4dd3-a242-663a5549f047","name":"verificar bloqueo"},{"parameters":{"httpMethod":"POST","path":"7a2c2a2a-8f5d-4a77-b916-5fa8d2174815","options":{}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[-656,2064],"id":"c8269526-e605-46dc-95c1-1588af2f4e58","name":"Webhook","webhookId":"7a2c2a2a-8f5d-4a77-b916-5fa8d2174815"},{"parameters":{"descriptionType":"manual","toolDescription":"Cuando el usuario escriba la palabra \"humano\" ejecuta esta tool","operation":"set","key":"={{ $('Webhook').item.json.body.data.key.remoteJid }}","value":"blocked-bot","expire":true,"ttl":300},"type":"n8n-nodes-base.redisTool","typeVersion":1,"position":[3056,2208],"id":"0faa90d3-3ccd-480d-b328-a08f9696212f","name":"Humano"},{"parameters":{"model":{"__rl":true,"value":"gpt-4o-mini","mode":"list","cachedResultName":"gpt-4o-mini"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[2768,2208],"id":"242654dd-0c8a-45dc-8795-a08abec648c1","name":"OpenAI Chat Model3"},{"parameters":{},"type":"n8n-nodes-base.noOp","typeVersion":1,"position":[2048,2144],"id":"d97b6147-e447-486e-8ac7-bc779bd4979e","name":"No Operation, do nothing2"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"7a6a2789-9ff6-4ab3-95da-65c7f99af9ef","leftValue":"={{ $json.message_type }}","rightValue":"conversation","operator":{"type":"string","operation":"equals"}}],"combinator":"or"},"looseTypeValidation":"={{ false }}","options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[912,1936],"id":"f19d3c8e-25e2-4a6a-95d0-aed995910940","name":"If1"},{"parameters":{"content":"## I'm para tu evaluacion \n**Double click** to edit me. [Guide](https://docs.n8n.io/workflows/sticky-notes/)","height":1040,"width":4768},"type":"n8n-nodes-base.stickyNote","position":[-736,1488],"typeVersion":1,"id":"fe1112d0-f16c-478c-b8e0-47acce15c678","name":"Sticky Note5"}],"connections":{"Switch":{"main":[[{"node":"Captura Texto","type":"main","index":0}],[{"node":"Capturar Audio","type":"main","index":0}]]},"Captura Texto":{"main":[[{"node":"Code","type":"main","index":0}]]},"Edit Fields":{"main":[[{"node":"Code1","type":"main","index":0}]]},"Saludo Whatsapp":{"main":[[{"node":"Env√≠o Imagen Producto","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"IA INTENCI√ìN CLIENTE","type":"ai_languageModel","index":0}]]},"Switch1":{"main":[[{"node":"Edit Fields","type":"main","index":0}],[{"node":"Edit Fields","type":"main","index":0}],[{"node":"AI CONVERSACI√ìN","type":"main","index":0}],[{"node":"AI CONVERSACI√ìN","type":"main","index":0}],[{"node":"AI CONVERSACI√ìN","type":"main","index":0}],[{"node":"AI CONVERSACI√ìN","type":"main","index":0}],[{"node":"AI CONVERSACI√ìN","type":"main","index":0}]]},"AI CONVERSACI√ìN":{"main":[[{"node":"Edit Fields1","type":"main","index":0}]]},"OpenAI Chat Model1":{"ai_languageModel":[[{"node":"AI CONVERSACI√ìN","type":"ai_languageModel","index":0}]]},"Code":{"main":[[{"node":"IA INTENCI√ìN CLIENTE","type":"main","index":0}]]},"Transcribe Audio":{"main":[[{"node":"Code","type":"main","index":0}]]},"IA INTENCI√ìN CLIENTE":{"main":[[{"node":"Switch1","type":"main","index":0}]]},"Edit Fields1":{"main":[[{"node":"Continuar Conversaci√≥n","type":"main","index":0}]]},"OpenAI Chat Model2":{"ai_languageModel":[[{"node":"SALUDO INICIAL","type":"ai_languageModel","index":0}]]},"Code1":{"main":[[{"node":"SALUDO INICIAL","type":"main","index":0}]]},"Simple Memory":{"ai_memory":[[{"node":"AI CONVERSACI√ìN","type":"ai_memory","index":0}]]},"If":{"main":[[{"node":"Switch","type":"main","index":0}],[{"node":"No Operation, do nothing","type":"main","index":0}]]},"Simple Memory1":{"ai_memory":[[{"node":"IA INTENCI√ìN CLIENTE","type":"ai_memory","index":0}]]},"Simple Memory2":{"ai_memory":[[{"node":"SALUDO INICIAL","type":"ai_memory","index":0}]]},"SALUDO INICIAL":{"main":[[{"node":"Saludo Whatsapp","type":"main","index":0}]]},"Capturar Audio":{"main":[[{"node":"Transcribe Audio","type":"main","index":0}]]},"WHATSAPP":{"main":[[{"node":"If","type":"main","index":0}]]},"AI Agent":{"main":[[{"node":"HTTP Request","type":"main","index":0}]]},"Convertir a audio/ogg1":{"main":[[{"node":"Transcribir Audio","type":"main","index":0}]]},"Memory1":{"ai_memory":[[{"node":"AI Agent","type":"ai_memory","index":0}]]},"data message extraction":{"main":[[{"node":"If1","type":"main","index":0}]]},"final_message_voice":{"main":[[{"node":"final_message","type":"main","index":0}]]},"final_message_text":{"main":[[{"node":"final_message","type":"main","index":0}]]},"final_message":{"main":[[{"node":"buffer","type":"main","index":0}]]},"buffer":{"main":[[{"node":"Wait1","type":"main","index":0}]]},"get_buffer_data":{"main":[[{"node":"Switch2","type":"main","index":0}]]},"Switch2":{"main":[[{"node":"No Operation, do nothing2","type":"main","index":0}],[{"node":"Delete_buffer","type":"main","index":0}],[{"node":"Wait","type":"main","index":0}]]},"Wait":{"main":[[{"node":"buffer","type":"main","index":0}]]},"Delete_buffer":{"main":[[{"node":"Un_solo_message","type":"main","index":0}]]},"Un_solo_message":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"Wait1":{"main":[[{"node":"get_buffer_data","type":"main","index":0}]]},"MCP Gmail":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"MCP Calendario":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"MCP Contactos":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"Transcribir Audio":{"main":[[{"node":"final_message_voice","type":"main","index":0}]]},"If3":{"main":[[{"node":"No Operation, do nothing1","type":"main","index":0}],[{"node":"data message extraction","type":"main","index":0}]]},"Bloquea al Agente":{"main":[[{"node":"No Operation, do nothing1","type":"main","index":0}]]},"Verificar palabra Clave":{"main":[[{"node":"Activar Bot","type":"main","index":0}],[{"node":"Bloquea al Agente","type":"main","index":0}]]},"Verificar quien Escribe":{"main":[[{"node":"Verificar palabra Clave","type":"main","index":0}],[{"node":"verificar bloqueo","type":"main","index":0}]]},"verificar bloqueo":{"main":[[{"node":"If3","type":"main","index":0}]]},"Webhook":{"main":[[{"node":"Verificar quien Escribe","type":"main","index":0}]]},"Humano":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"OpenAI Chat Model3":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"If1":{"main":[[{"node":"final_message_text","type":"main","index":0}],[{"node":"Convertir a audio/ogg1","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"e5301eb2-7415-4b16-8b91-b977abba36f4","triggerCount":1,"shared":[{"createdAt":"2025-08-06T13:40:38.310Z","updatedAt":"2025-08-06T13:40:38.310Z","role":"workflow:owner","workflowId":"Bh0nYFxevjGYqlmS","projectId":"95llCqXI9to4u1LV"}],"tags":[{"createdAt":"2025-07-23T15:02:22.499Z","updatedAt":"2025-07-23T15:02:22.499Z","id":"BvBGzIXeUTBdOQdV","name":"Niurka Oropeza"}]}